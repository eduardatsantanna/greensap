(this["webpackJsonpgreen-sap"]=this["webpackJsonpgreen-sap"]||[]).push([[54,6],{1077:function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return Xe}));var r=i(29),a=i(20),n=i(13),s=i(8),o=i.n(s),l=i(14),h=i(2),c=i(4),u=i(46),f=i(42),y=i(6),d=i(7),v=i(0),p=i(96),_=i(22),b=i(69),g=i(23),m=i(15),O=i(11),x=i(25),k=i(31),j=i(1),w=(i(18),i(16)),P=i(10),S=i(436),C=i(94),M=i(12),I=i(62),T=i(458),L=i(336),R=i(648),A=(i(649),i(647),i(646),i(653),i(651),i(645)),D=i(650),V=i(685),z=function(){function e(t,i){Object(h.a)(this,e),this._width=0,this._height=0,this._free=[],this._width=t,this._height=i,this._free.push(new V.a(0,0,t,i))}return Object(c.a)(e,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"allocate",value:function(e,t){if(e>this._width||t>this._height)return new V.a;for(var i=null,r=-1,a=0;a<this._free.length;++a){var n=this._free[a];e<=n.width&&t<=n.height&&(null===i||n.y<=i.y&&n.x<=i.x)&&(i=n,r=a)}return null===i?new V.a:(this._free.splice(r,1),i.width<i.height?(i.width>e&&this._free.push(new V.a(i.x+e,i.y,i.width-e,t)),i.height>t&&this._free.push(new V.a(i.x,i.y+t,i.width,i.height-t))):(i.width>e&&this._free.push(new V.a(i.x+e,i.y,i.width-e,i.height)),i.height>t&&this._free.push(new V.a(i.x,i.y+t,e,i.height-t))),new V.a(i.x,i.y,e,t))}},{key:"release",value:function(e){for(var t=0;t<this._free.length;++t){var i=this._free[t];if(i.y===e.y&&i.height===e.height&&i.x+i.width===e.x)i.width+=e.width;else if(i.x===e.x&&i.width===e.width&&i.y+i.height===e.y)i.height+=e.height;else if(e.y===i.y&&e.height===i.height&&e.x+e.width===i.x)i.x=e.x,i.width+=e.width;else{if(e.x!==i.x||e.width!==i.width||e.y+e.height!==i.y)continue;i.y=e.y,i.height+=e.height}this._free.splice(t,1),this.release(e)}this._free.push(e)}}]),e}(),B=function(){function e(t,i,r){Object(h.a)(this,e),this.width=0,this.height=0,this._dirties=[],this._glyphData=[],this._currentPage=0,this._glyphIndex={},this._textures=[],this._rangePromises=new Map,this.width=t,this.height=i,this._glyphSource=r,this._binPack=new z(t-4,i-4),this._glyphData.push(new Uint8Array(t*i)),this._dirties.push(!0),this._textures.push(void 0)}return Object(c.a)(e,[{key:"getGlyphItems",value:function(e,t){var i,r=this,a=[],s=this._glyphSource,o=new Set,l=Object(n.a)(t);try{for(l.s();!(i=l.n()).done;){var h=i.value,c=Math.floor(.00390625*h);o.add(c)}}catch(f){l.e(f)}finally{l.f()}var u=[];return o.forEach((function(t){if(t<=256){var i=e+t;if(r._rangePromises.has(i))u.push(r._rangePromises.get(i));else{var a=s.getRange(e,t).then((function(){r._rangePromises.delete(i)}),(function(){r._rangePromises.delete(i)}));r._rangePromises.set(i,a),u.push(a)}}})),Promise.all(u).then((function(){var i=r._glyphIndex[e];i||(i={},r._glyphIndex[e]=i);var o,l=Object(n.a)(t);try{for(l.s();!(o=l.n()).done;){var h=o.value,c=i[h];if(c)a[h]={sdf:!0,rect:c.rect,metrics:c.metrics,page:c.page,code:h};else{var u=s.getGlyph(e,h);if(u&&u.metrics){var y=u.metrics,d=void 0;if(0===y.width)d=new V.a(0,0,0,0);else{var v=y.width+6,p=y.height+6,_=v%4?4-v%4:4,b=p%4?4-p%4:4;1===_&&(_=5),1===b&&(b=5),(d=r._binPack.allocate(v+_,p+b)).isEmpty&&(r._dirties[r._currentPage]||(r._glyphData[r._currentPage]=null),r._currentPage=r._glyphData.length,r._glyphData.push(new Uint8Array(r.width*r.height)),r._dirties.push(!0),r._textures.push(void 0),r._binPack=new z(r.width-4,r.height-4),d=r._binPack.allocate(v+_,p+b));var g=r._glyphData[r._currentPage],m=u.bitmap,O=void 0,x=void 0;if(m)for(var k=0;k<p;k++){O=v*k,x=r.width*(d.y+k+1)+d.x;for(var j=0;j<v;j++)g[x+j+1]=m[O+j]}}i[h]={rect:d,metrics:y,tileIDs:null,page:r._currentPage},a[h]={sdf:!0,rect:d,metrics:y,page:r._currentPage,code:h},r._dirties[r._currentPage]=!0}}}}catch(f){l.e(f)}finally{l.f()}return a}))}},{key:"removeGlyphs",value:function(e){for(var t in this._glyphIndex){var i=this._glyphIndex[t];if(i){var r=void 0;for(var a in i)if((r=i[a]).tileIDs.delete(e),0===r.tileIDs.size){for(var n=this._glyphData[r.page],s=r.rect,o=void 0,l=void 0,h=0;h<s.height;h++)for(o=this.width*(s.y+h)+s.x,l=0;l<s.width;l++)n[o+l]=0;delete i[a],this._dirties[r.page]=!0}}}}},{key:"bind",value:function(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this._textures[i]||(this._textures[i]=new A.a(e,{pixelFormat:6406,dataType:5121,width:this.width,height:this.height},new Uint8Array(this.width*this.height)));var a=this._textures[i];a.setSamplingMode(t),this._dirties[i]&&a.setData(this._glyphData[i]),e.bindTexture(a,r),this._dirties[i]=!1}},{key:"dispose",value:function(){this._binPack=null;var e,t=Object(n.a)(this._textures);try{for(t.s();!(e=t.n()).done;){var i=e.value;i&&i.dispose()}}catch(r){t.e(r)}finally{t.f()}this._textures.length=0}}]),e}(),F=i(450),E=function(){function e(t){if(Object(h.a)(this,e),this._metrics=[],this._bitmaps=[],t)for(;t.next();)if(1===t.tag()){for(var i=t.getMessage();i.next();)if(3===i.tag()){for(var r=i.getMessage(),a=void 0,n=void 0,s=void 0,o=void 0,l=void 0,c=void 0,u=void 0;r.next();)switch(r.tag()){case 1:a=r.getUInt32();break;case 2:n=r.getBytes();break;case 3:s=r.getUInt32();break;case 4:o=r.getUInt32();break;case 5:l=r.getSInt32();break;case 6:c=r.getSInt32();break;case 7:u=r.getUInt32();break;default:r.skip()}r.release(),a&&(this._metrics[a]={width:s,height:o,left:l,top:c,advance:u},this._bitmaps[a]=n)}else i.skip();i.release()}else t.skip()}return Object(c.a)(e,[{key:"getMetrics",value:function(e){return this._metrics[e]}},{key:"getBitmap",value:function(e){return this._bitmaps[e]}}]),e}(),U=function(){function e(){Object(h.a)(this,e),this._ranges=[]}return Object(c.a)(e,[{key:"getRange",value:function(e){return this._ranges[e]}},{key:"addRange",value:function(e,t){this._ranges[e]=t}}]),e}(),H=function(){function e(t){Object(h.a)(this,e),this._glyphInfo={},this._baseURL=t}return Object(c.a)(e,[{key:"getRange",value:function(e,t){var i=this._getFontStack(e);if(i.getRange(t))return Promise.resolve();var r=256*t,a=r+255,n=this._baseURL.replace("{fontstack}",e).replace("{range}",r+"-"+a);return Object(I.default)(n,{responseType:"array-buffer"}).then((function(e){i.addRange(t,new E(new F.a(new Uint8Array(e.data),new DataView(e.data))))})).catch((function(){i.addRange(t,new E)}))}},{key:"getGlyph",value:function(e,t){var i=this._getFontStack(e);if(i){var r=Math.floor(t/256);if(!(r>256)){var a=i.getRange(r);return a?{metrics:a.getMetrics(t),bitmap:a.getBitmap(t)}:void 0}}}},{key:"_getFontStack",value:function(e){var t=this._glyphInfo[e];return t||(t=this._glyphInfo[e]=new U),t}}]),e}(),q=i(662),G="dasharray-",N=function(){function e(t,i){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(h.a)(this,e),this._size=[],this._mosaicsData=[],this._textures=[],this._dirties=[],this._maxItemSize=0,this._currentPage=0,this._pageWidth=0,this._pageHeight=0,this._mosaicRects={},this.pixelRatio=1,(t<=0||i<=0)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!"),this._pageWidth=t,this._pageHeight=i,r>0&&(this._maxItemSize=r),this._binPack=new z(t-4,i-4)}return Object(c.a)(e,[{key:"dispose",value:function(){this._binPack=null,this._mosaicRects={};var e,t=Object(n.a)(this._textures);try{for(t.s();!(e=t.n()).done;){var i=e.value;i&&i.dispose()}}catch(r){t.e(r)}finally{t.f()}this._textures.length=0}},{key:"getWidth",value:function(e){return e>=this._size.length?-1:this._size[e][0]}},{key:"getHeight",value:function(e){return e>=this._size.length?-1:this._size[e][1]}},{key:"getPageSize",value:function(e){return e>=this._size.length?null:this._size[e]}},{key:"setSpriteSource",value:function(e){if(this.dispose(),this.pixelRatio=e.devicePixelRatio,0===this._mosaicsData.length){this._binPack=new z(this._pageWidth-4,this._pageHeight-4);var t=Math.floor(this._pageWidth),i=Math.floor(this._pageHeight),r=new Uint32Array(t*i);this._mosaicsData[0]=r,this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0)}this._sprites=e}},{key:"getSpriteItem",value:function(e){var t,i,r,n,s=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=this._mosaicRects[e];if(o)return o;if(!this._sprites||"loaded"!==this._sprites.loadStatus)return null;if(e&&e.startsWith(G)?(t=this._rasterizeDash(e),r=(i=Object(a.a)(t,2))[0],n=i[1],s=!0):r=this._sprites.getSpriteInfo(e),!r||!r.width||!r.height||r.width<0||r.height<0)return null;var l=r.width,h=r.height,c=this._allocateImage(l,h),u=Object(a.a)(c,3),f=u[0],y=u[1],d=u[2];return f.width<=0?null:(this._copy(f,r,y,d,s,n),o={rect:f,width:l,height:h,sdf:r.sdf,simplePattern:!1,pixelRatio:r.pixelRatio,page:y},this._mosaicRects[e]=o,o)}},{key:"getSpriteItems",value:function(e){var t,i={},r=Object(n.a)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;i[a.name]=this.getSpriteItem(a.name,a.repeat)}}catch(s){r.e(s)}finally{r.f()}return i}},{key:"getMosaicItemPosition",value:function(e,t){var i=this.getSpriteItem(e,t),r=i&&i.rect;if(!r)return null;r.width=i.width,r.height=i.height;var a=i.width,n=i.height;return{tl:[r.x+2,r.y+2],br:[r.x+2+a,r.y+2+n],page:i.page}}},{key:"bind",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this._textures[i]||(this._textures[i]=new A.a(e,{pixelFormat:6408,dataType:5121,wrapMode:33071,width:this._size[i][0],height:this._size[i][1]},new Uint8Array(this._mosaicsData[i].buffer)));var a=this._textures[i];a.setSamplingMode(t),this._dirties[i]&&a.setData(new Uint8Array(this._mosaicsData[i].buffer)),e.bindTexture(a,r),this._dirties[i]=!1}},{key:"_copy",value:function(t,i,r,a,n,s){if(this._sprites&&"loaded"===this._sprites.loadStatus&&!(r>=this._mosaicsData.length)){var o=new Uint32Array(s?s.buffer:this._sprites.image.buffer),l=this._mosaicsData[r];l&&o||console.error("Source or target images are uninitialized!");var h=s?i.width:this._sprites.width;e._copyBits(o,h,i.x,i.y,l,a[0],t.x+2,t.y+2,i.width,i.height,n),this._dirties[r]=!0}}},{key:"_allocateImage",value:function(e,t){e+=2,t+=2;var i=Math.max(e,t);if(this._maxItemSize&&this._maxItemSize<i){var r=new V.a(0,0,e,t);return this._mosaicsData.push(new Uint32Array(e*t)),this._dirties.push(!0),this._size.push([e,t]),this._textures.push(void 0),[r,this._mosaicsData.length-1,[e,t]]}var a=e%4?4-e%4:4,n=t%4?4-t%4:4;1===a&&(a=5),1===n&&(n=5);var s=this._binPack.allocate(e+a,t+n);return s.width<=0?(this._dirties[this._currentPage]||(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,this._mosaicsData.push(new Uint32Array(this._pageWidth*this._pageHeight)),this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0),this._binPack=new z(this._pageWidth-4,this._pageHeight-4),this._allocateImage(e,t)):[s,this._currentPage,[this._pageWidth,this._pageHeight]]}},{key:"_rasterizeDash",value:function(e){var t=e.match(/\[(.*?)\]/);if(!t)return null;var i=t[1].split(",").map(Number),r=e.slice(e.lastIndexOf("-")+1),n=q.c.rasterizeDash(i,r),s=Object(a.a)(n,3),o=s[0];return[{x:0,y:0,width:s[1],height:s[2],sdf:!0,pixelRatio:1},new Uint8Array(o.buffer)]}}],[{key:"_copyBits",value:function(e,t,i,r,a,n,s,o,l,h,c){var u=r*t+i,f=o*n+s;if(c){f-=n;for(var y=-1;y<=h;u=((++y+h)%h+r)*t+i,f+=n)for(var d=-1;d<=l;d++)a[f+d]=e[u+(d+l)%l]}else for(var v=0;v<h;v++){for(var p=0;p<l;p++)a[f+p]=e[u+p];u+=t,f+=n}}}]),e}(),X=i(487);function Y(e,t,i,r,a,n){e.fillStyle=t,e.fillRect(i,r,a,n)}function W(e,t,i,r,a,n){e.strokeStyle=t,e.strokeRect(i,r,a,n)}function J(e,t){for(var i=window.COLLISION_XRAY,r=0;r<t.length;++r){var a=!t[r].unique.show;if(i||!a){var s,o=Object(n.a)(t[r].colliders);try{for(o.s();!(s=o.n()).done;){var l=s.value;if(l.enabled){var h=!t[r].unique.parts[l.partIndex].show;if(i||!h){var c=l.xScreen,u=l.yScreen,f=l.dxScreen,y=l.dyScreen;e.globalAlpha=a||h?.2:1,Y(e,"green",c-1,u-1,3,3),W(e,"red",c+f,u+y,l.width,l.height),Y(e,"blue",c+f-1,u+y-1,3,3),e.globalAlpha=1}}}}catch(d){o.e(d)}finally{o.f()}}}}var Q=i(138),K=new T.a(10),Z=new Map,$=function(){function e(t,i,r){Object(h.a)(this,e),this._vectorTileLayer=t,this._styleRepository=i,this.devicePixelRatio=r,this._spriteMosaic=null,this._glyphMosaic=null,this._connection=null}return Object(c.a)(e,[{key:"destroy",value:function(){this._connection&&(this._connection.close(),this._connection=null),this._styleRepository=null,this._vectorTileLayer=null,this._spriteMosaic&&(this._spriteMosaic=null),this._glyphMosaic&&(this._glyphMosaic=null)}},{key:"spriteMosaic",get:function(){var e=this;return this._spriteSourcePromise.then((function(){return e._spriteMosaic}))}},{key:"glyphMosaic",get:function(){return this._glyphMosaic}},{key:"start",value:function(){var e=Object(l.a)(o.a.mark((function e(t){var i,r,a,n,s,l,h=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n in i=this._vectorTileLayer,r=i.sourceNameToSource,a=[],r)a.push(this._fetchTileMap(r[n],t));return this._spriteSourcePromise=this._vectorTileLayer.loadSpriteSource(this.devicePixelRatio,t),this._spriteSourcePromise.then((function(e){h._spriteMosaic=new N(1024,1024,250),h._spriteMosaic.setSpriteSource(e)})),s=this._styleRepository,l=new H(s.glyphs),e.abrupt("return",(this._glyphMosaic=new B(1024,1024,l),this._broadcastPromise=Object(L.b)("WorkerTileHandler",{client:this,schedule:t.schedule,signal:t.signal}).then((function(e){return h._connection=e,Promise.all(h._connection.broadcast("setStyle",{style:i.currentStyleInfo.style,vectorTileLayerMaxBuffers:Object(w.a)("vectortilelayer-max-buffers")},t))})),Promise.all(a)));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateStyle",value:function(){var e=Object(l.a)(o.a.mark((function e(t){var i=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._broadcastPromise;case 2:return this._broadcastPromise=new Promise((function(e,r){Promise.all(i._connection.broadcast("updateStyle",t)).then(e,r)})),e.abrupt("return",this._broadcastPromise);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setStyle",value:function(){var e=Object(l.a)(o.a.mark((function e(t,i){var r,a,n,s,l=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._broadcastPromise;case 2:for(n in this._styleRepository=t,r=this._vectorTileLayer.sourceNameToSource,a=[],r)a.push(this._fetchTileMap(r[n],null));return this._spriteSourcePromise=this._vectorTileLayer.loadSpriteSource(this.devicePixelRatio,null),this._spriteSourcePromise.then((function(e){l._spriteMosaic=new N(1024,1024,250),l._spriteMosaic.setSpriteSource(e)})),s=new H(t.glyphs),e.abrupt("return",(this._glyphMosaic=new B(1024,1024,s),this._broadcastPromise=new Promise((function(e,t){Promise.all(l._connection.broadcast("setStyle",{style:i,vectorTileLayerMaxBuffers:Object(w.a)("vectortilelayer-max-buffers")})).then(e,t)})),a.push(this._broadcastPromise),Promise.all(a)));case 8:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"fetchTileData",value:function(e,t){var i=this;return this._getRefKeys(e,t).then((function(e){var r=i._vectorTileLayer.sourceNameToSource,a=[];for(var n in r)a.push(n);return i._getSourcesData(a,e,t)}))}},{key:"parseTileData",value:function(e,t){var i=this,r=e&&e.data;if(!r)return Promise.resolve(null);var a=r.sourceName2DataAndRefKey,n=r.transferList;return 0===Object.keys(a).length?Promise.resolve(null):this._broadcastPromise.then((function(){return i._connection.getAvailableClient().then((function(i){return i.invoke("createTileAndParse",{key:e.key.id,sourceName2DataAndRefKey:a,styleLayerUIDs:e.styleLayerUIDs},Object(M.a)(Object(M.a)({},t),{},{transferList:n})).then((function(e){return{tileData:e}}))}))}))}},{key:"getSprites",value:function(){var e=Object(l.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._spriteSourcePromise;case 2:return e.abrupt("return",this._spriteMosaic.getSpriteItems(t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getGlyphs",value:function(e){return this._glyphMosaic.getGlyphItems(e.font,e.codePoints)}},{key:"perfReport",value:function(e){!function(e,t,i){if(window.PERFORMANCE_RECORDING_STORAGE){var r=window.PERFORMANCE_RECORDING_STORAGE;r.perf=r.perf||{};var a=r.perf;a[e]=a[e]||{start:null,time:0,min:void 0,max:void 0,samples:[],unit:i},a[e].time+=t,a[e].samples.push(t),(null==a[e].min||t<a[e].min)&&(a[e].min=t),(null==a[e].max||t>a[e].max)&&(a[e].max=t)}}(e.key,e.milliseconds,"ms")}},{key:"_getTilePayload",value:function(){var e=Object(l.a)(o.a.mark((function e(t,i,r){var a,n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Q.a.pool.acquire(t.id),n=this._vectorTileLayer.sourceNameToSource[i].getSourceTileUrl(a.level,a.row,a.col),Q.a.pool.release(a),e.prev=2,e.next=5,this.request(n,r);case 5:return e.t0=e.sent,e.t1=i,e.abrupt("return",{protobuff:e.t0,sourceName:e.t1});case 10:if(e.prev=10,e.t2=e.catch(2),!Object(x.m)(e.t2)){e.next=14;break}throw e.t2;case 14:return e.abrupt("return",{protobuff:null,sourceName:i});case 15:case"end":return e.stop()}}),e,this,[[2,10]])})));return function(t,i,r){return e.apply(this,arguments)}}()},{key:"request",value:function(e,t){return Object(I.default)(e,Object(M.a)({responseType:"array-buffer"},t)).then((function(e){return e.data}))}},{key:"_fetchTileMap",value:function(){var e=Object(l.a)(o.a.mark((function e(t,i){var r,a,n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.capabilities.operations.supportsTileMap||!t.tileIndex){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:if(t.tileMapURL){e.next=4;break}return e.abrupt("return");case 4:if(!(r=K.get(t.tileMapURL))){e.next=7;break}return e.abrupt("return",void(t.tileIndex=r));case 7:if(!Z.has(t.tileMapURL)){e.next=20;break}return e.prev=8,e.next=11,Z.get(t.tileMapURL);case 11:a=e.sent,t.tileIndex=new X.a(a.data),e.next=19;break;case 15:if(e.prev=15,e.t0=e.catch(8),!Object(x.m)(e.t0)){e.next=19;break}throw e.t0;case 19:return e.abrupt("return");case 20:return n=Object(I.default)(t.tileMapURL,i),Z.set(t.tileMapURL,n),e.prev=22,e.next=25,n;case 25:a=e.sent,Z.delete(t.tileMapURL),K.put(t.tileMapURL,t.tileIndex),t.tileIndex=new X.a(a.data),e.next=35;break;case 31:if(e.prev=31,e.t1=e.catch(22),Z.delete(t.tileMapURL),!Object(x.m)(e.t1)){e.next=35;break}throw e.t1;case 35:case"end":return e.stop()}}),e,null,[[8,15],[22,31]])})));return function(t,i){return e.apply(this,arguments)}}()},{key:"_getRefKeys",value:function(e,t){var i=this._vectorTileLayer.sourceNameToSource,r=new Array;for(var a in i){var n=i[a].getRefKey(e,t);r.push(n)}return Object(x.j)(r)}},{key:"_getSourcesData",value:function(e,t,i){for(var r=[],a=0;a<t.length;a++)if(null==t[a].value||null==e[a])r.push(null);else{var n=this._getTilePayload(t[a].value,e[a],i);r.push(n)}return Object(x.j)(r).then((function(e){for(var i={},r=[],a=0;a<e.length;a++)if(e[a].value&&e[a].value&&e[a].value.protobuff&&e[a].value.protobuff.byteLength>0){var n=t[a].value.id;i[e[a].value.sourceName]={refKey:n,protobuff:e[a].value.protobuff},r.push(e[a].value.protobuff)}return{sourceName2DataAndRefKey:i,transferList:r}}))}}]),e}(),ee=i(334),te=i(244),ie=function(e,t){return e+1/(1<<2*t)},re=function(){function e(t,i){Object(h.a)(this,e),this._tiles=new Map,this._tileCache=new ee.a(40,(function(e){return e.dispose()})),this._viewSize=[0,0],this._visibleTiles=new Map,this.acquireTile=t.acquireTile,this.releaseTile=t.releaseTile,this.tileInfoView=t.tileInfoView,this._container=i}return Object(c.a)(e,[{key:"destroy",value:function(){var e,t=Object(n.a)(this._tiles);try{for(t.s();!(e=t.n()).done;){var i=Object(a.a)(e.value,2);i[0];i[1].dispose()}}catch(r){t.e(r)}finally{t.f()}this._tiles=null,this._tileCache.clear(),this._tileCache=null}},{key:"update",value:function(e){this._updateCacheSize(e);var t,i=this.tileInfoView,r=i.getTileCoverage(e.state,0,"smallest"),s=r.spans,o=r.lodInfo,l=o.level,h=this._tiles,c=new Set,u=new Set,f=Object(n.a)(s);try{for(f.s();!(t=f.n()).done;)for(var y=t.value,d=y.row,v=y.colFrom,p=y.colTo,_=v;_<=p;_++){var b=Q.a.getId(l,d,o.normalizeCol(_),o.getWorldForColumn(_)),g=this._getOrAcquireTile(b);c.add(b),g.processed()?this._addToContainer(g):u.add(new Q.a(b))}}catch(z){f.e(z)}finally{f.f()}var m,O=Object(n.a)(h);try{for(O.s();!(m=O.n()).done;){var x=Object(a.a)(m.value,2),k=x[0];x[1].isCoverage=c.has(k)}}catch(z){O.e(z)}finally{O.f()}var j,w=Object(n.a)(u);try{for(w.s();!(j=w.n()).done;){var P=j.value;this._findPlaceholdersForMissingTiles(P,c)}}catch(z){w.e(z)}finally{w.f()}var S,C=!1,M=Object(n.a)(h);try{for(M.s();!(S=M.n()).done;){var I=Object(a.a)(S.value,2),T=I[0],L=I[1];L.neededForCoverage=c.has(T),L.neededForCoverage||L.isHoldingForFade&&i.intersects(r,L.key)&&c.add(T),L.isFading&&(C=!0)}}catch(z){M.e(z)}finally{M.f()}var R,A=Object(n.a)(this._tiles);try{for(A.s();!(R=A.n()).done;){var D=Object(a.a)(R.value,2),V=D[0];D[1];c.has(V)||this._releaseTile(V)}}catch(z){A.e(z)}finally{A.f()}return te.a.pool.release(r),!C}},{key:"clear",value:function(){this._tiles.clear(),this._tileCache.clear(),this._visibleTiles.clear()}},{key:"clearCache",value:function(){this._tileCache.clear()}},{key:"_findPlaceholdersForMissingTiles",value:function(e,t){var i,r=[],s=Object(n.a)(this._tiles);try{for(s.s();!(i=s.n()).done;){var o=Object(a.a)(i.value,2),l=(o[0],o[1]);this._addPlaceholderChild(r,l,e,t)}}catch(c){s.e(c)}finally{s.f()}var h=r.reduce(ie,0);Math.abs(1-h)<1e-6||this._addPlaceholderParent(e.id,t)}},{key:"_addPlaceholderChild",value:function(e,t,i,r){t.key.level<=i.level||!t.hasData()||function(e,t){var i=t.level-e.level;return e.row===t.row>>i&&e.col===t.col>>i&&e.world===t.world}(i,t.key)&&(this._addToContainer(t),r.add(t.id),e.push(t.key.level-i.level))}},{key:"_addPlaceholderParent",value:function(e,t){for(var i=this._tiles,r=e;;){if(!(r=ae(r))||t.has(r))return;var a=i.get(r);if(a&&a.hasData())return this._addToContainer(a),void t.add(a.id)}}},{key:"_getOrAcquireTile",value:function(e){var t=this._tiles.get(e);return t||((t=this._tileCache.pop(e))||(t=this.acquireTile(new Q.a(e))),this._tiles.set(e,t),t)}},{key:"_releaseTile",value:function(e){var t=this._tiles.get(e);this.releaseTile(t),this._removeFromContainer(t),this._tiles.delete(e),t.hasData()?this._tileCache.put(e,t,1):t.dispose()}},{key:"_addToContainer",value:function(e){var t,i=[],r=this._container;if(!r.contains(e)){var s,o=this._visibleTiles,l=Object(n.a)(o);try{for(l.s();!(s=l.n()).done;){var h=Object(a.a)(s.value,2),c=(h[0],h[1]);this._canConnectDirectly(e,c)&&i.push(c),Object(O.i)(t)&&this._canConnectDirectly(c,e)&&(t=c)}}catch(_){l.e(_)}finally{l.f()}if(Object(O.j)(t)){var u,f=Object(n.a)(i);try{for(f.s();!(u=f.n()).done;){var y=u.value;t.childrenTiles.delete(y),e.childrenTiles.add(y),y.parentTile=e}}catch(_){f.e(_)}finally{f.f()}t.childrenTiles.add(e),e.parentTile=t}else{var d,v=Object(n.a)(i);try{for(v.s();!(d=v.n()).done;){var p=d.value;e.childrenTiles.add(p),p.parentTile=e}}catch(_){v.e(_)}finally{v.f()}}o.set(e.id,e),r.addChild(e)}}},{key:"_removeFromContainer",value:function(e){if(this._visibleTiles.delete(e.id),this._container.removeChild(e),Object(O.j)(e.parentTile)){e.parentTile.childrenTiles.delete(e);var t,i=Object(n.a)(e.childrenTiles);try{for(i.s();!(t=i.n()).done;){var r=t.value;Object(O.j)(e.parentTile)&&e.parentTile.childrenTiles.add(r)}}catch(o){i.e(o)}finally{i.f()}}var a,s=Object(n.a)(e.childrenTiles);try{for(s.s();!(a=s.n()).done;){a.value.parentTile=e.parentTile}}catch(o){s.e(o)}finally{s.f()}e.parentTile=null,e.childrenTiles.clear()}},{key:"_canConnectDirectly",value:function(e,t){for(var i=e.key,r=t.key,a=r.level,n=r.row,s=r.col,o=r.world,l=this._visibleTiles;a>0;){if(a--,n>>=1,s>>=1,i.level===a&&i.row===n&&i.col===s&&i.world===o)return!0;if(l.has("".concat(a,"/").concat(n,"/").concat(s,"/").concat(o)))return!1}return!1}},{key:"_updateCacheSize",value:function(e){var t=e.state.size;if(t[0]!==this._viewSize[0]||t[1]!==this._viewSize[1]){var i=Math.ceil(t[0]/512)+1,r=Math.ceil(t[1]/512)+1;this._viewSize[0]=t[0],this._viewSize[1]=t[1],this._tileCache.maxSize=5*i*r}}}]),e}();function ae(e){var t=e.split("/"),i=Object(a.a)(t,4),r=i[0],n=i[1],s=i[2],o=i[3],l=parseInt(r,10);return 0===l?null:"".concat(l-1,"/").concat(parseInt(n,10)>>1,"/").concat(parseInt(s,10)>>1,"/").concat(parseInt(o,10))}var ne=i(240),se=i(321),oe=function e(t){Object(h.a)(this,e),this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=t},le=function e(){Object(h.a)(this,e),this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1};function he(e,t,i,r,a,n){var s=i-a;if(s>=0)return(t>>s)+(r-(n<<s))*(e>>s);var o=-s;return t-(n-(r<<o))*(e>>o)<<o}var ce=function(){function e(t,i,r){Object(h.a)(this,e),this._rows=Math.ceil(i/r),this._columns=Math.ceil(t/r),this._cellSize=r,this.cells=new Array(this._rows);for(var a=0;a<this._rows;a++){this.cells[a]=new Array(this._columns);for(var n=0;n<this._columns;n++)this.cells[a][n]=[]}}return Object(c.a)(e,[{key:"getCell",value:function(e,t){var i=Math.min(Math.max(Math.floor(t/this._cellSize),0),this._rows-1),r=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._columns-1);return this.cells[i]&&this.cells[i][r]||null}},{key:"getCellSpan",value:function(e,t,i,r){return[Math.min(Math.max(Math.floor(e/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(t/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.rows-1)]}},{key:"cellSize",get:function(){return this._cellSize}},{key:"columns",get:function(){return this._columns}},{key:"rows",get:function(){return this._rows}}]),e}();function ue(e,t,i,r,s){var o=e.layerData.get(s);if(3===o.type){var l,h=Object(n.a)(r);try{for(h.s();!(l=h.n()).done;){var c=l.value,u=c.unique,f=void 0;if(c.selectedForRendering){var y=u.parts[0],d=y.startOpacity,v=y.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&0===v;var p=i?Math.floor(127*d)|v<<7:v?255:0;f=p<<24|p<<16|p<<8|p}else f=0;var _,b=Object(n.a)(c.iconVertexRanges);try{for(b.s();!(_=b.n()).done;)for(var g=Object(a.a)(_.value,2),m=g[0],O=g[1],x=m;x<m+O;x+=4)o.iconOpacity[x/4]=f}catch(R){b.e(R)}finally{b.f()}if(c.selectedForRendering){var k=u.parts[1],j=k.startOpacity,w=k.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&0===w;var P=i?Math.floor(127*j)|w<<7:w?255:0;f=P<<24|P<<16|P<<8|P}else f=0;var S,C=Object(n.a)(c.textVertexRanges);try{for(C.s();!(S=C.n()).done;)for(var M=Object(a.a)(S.value,2),I=M[0],T=M[1],L=I;L<I+T;L+=4)o.textOpacity[L/4]=f}catch(R){C.e(R)}finally{C.f()}}}catch(R){h.e(R)}finally{h.f()}o.lastOpacityUpdate=t,o.opacityChanged=!0}}var fe=function(){function e(t,i){Object(h.a)(this,e),this.layerUIDs=[],this.isDestroyed=!1,this.data=t,this.memoryUsed=t.byteLength;var r=1,a=new Uint32Array(t);this.layerUIDs=[];for(var n=a[r++],s=0;s<n;s++)this.layerUIDs[s]=a[r++];this.bufferDataOffset=r,i&&(this.layer=i.getStyleLayerByUID(this.layerUIDs[0]))}return Object(c.a)(e,[{key:"isPreparedForRendering",get:function(){return Object(O.i)(this.data)}},{key:"offset",get:function(){return this.bufferDataOffset}},{key:"destroy",value:function(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)}},{key:"prepareForRendering",value:function(e){Object(O.i)(this.data)||(this.doPrepareForRendering(e,this.data,this.bufferDataOffset),this.data=null)}}]),e}(),ye=function(e){Object(y.a)(i,e);var t=Object(d.a)(i);function i(e,r){var a;Object(h.a)(this,i),(a=t.call(this,e,r)).type=2,a.lineIndexStart=0,a.lineIndexCount=0;var n=new Uint32Array(e),s=a.bufferDataOffset;a.lineIndexStart=n[s++],a.lineIndexCount=n[s++];var o=n[s++];if(o>0){for(var l=new Map,c=0;c<o;c++){var u=n[s++],f=n[s++],y=n[s++];l.set(u,[f,y])}a.patternMap=l}return a.bufferDataOffset=s,a}return Object(c.a)(i,[{key:"hasData",value:function(){return this.lineIndexCount>0}},{key:"triangleCount",value:function(){return this.lineIndexCount/3}},{key:"doDestroy",value:function(){Object(O.j)(this.lineVertexArrayObject)&&this.lineVertexArrayObject.dispose(),Object(O.j)(this.lineVertexBuffer)&&this.lineVertexBuffer.dispose(),Object(O.j)(this.lineIndexBuffer)&&this.lineIndexBuffer.dispose(),this.lineVertexArrayObject=null,this.lineVertexBuffer=null,this.lineIndexBuffer=null,this.memoryUsed=0}},{key:"doPrepareForRendering",value:function(e,t,i){var r=new Uint32Array(t),a=new Int32Array(r.buffer),n=r[i++];this.lineVertexBuffer=R.a.createVertex(e,35044,new Int32Array(a.buffer,4*i,n)),i+=n;var s=r[i++];this.lineIndexBuffer=R.a.createIndex(e,35044,new Uint32Array(r.buffer,4*i,s)),i+=s;var o=this.layer.lineMaterial;this.lineVertexArrayObject=new D.a(e,o.getAttributeLocations(),o.getLayoutInfo(),{geometry:this.lineVertexBuffer},this.lineIndexBuffer)}}]),i}(fe),de=function(e){Object(y.a)(i,e);var t=Object(d.a)(i);function i(e,r){var a;Object(h.a)(this,i),(a=t.call(this,e,r)).type=1,a.fillIndexStart=0,a.fillIndexCount=0,a.outlineIndexStart=0,a.outlineIndexCount=0;var n=new Uint32Array(e),s=a.bufferDataOffset;a.fillIndexStart=n[s++],a.fillIndexCount=n[s++],a.outlineIndexStart=n[s++],a.outlineIndexCount=n[s++];var o=n[s++];if(o>0){for(var l=new Map,c=0;c<o;c++){var u=n[s++],f=n[s++],y=n[s++];l.set(u,[f,y])}a.patternMap=l}return a.bufferDataOffset=s,a}return Object(c.a)(i,[{key:"hasData",value:function(){return this.fillIndexCount>0||this.outlineIndexCount>0}},{key:"triangleCount",value:function(){return(this.fillIndexCount+this.outlineIndexCount)/3}},{key:"doDestroy",value:function(){Object(O.j)(this.fillVertexArrayObject)&&this.fillVertexArrayObject.dispose(),Object(O.j)(this.fillVertexBuffer)&&this.fillVertexBuffer.dispose(),Object(O.j)(this.fillIndexBuffer)&&this.fillIndexBuffer.dispose(),this.fillVertexArrayObject=null,this.fillVertexBuffer=null,this.fillIndexBuffer=null,Object(O.j)(this.outlineVertexArrayObject)&&this.outlineVertexArrayObject.dispose(),Object(O.j)(this.outlineVertexBuffer)&&this.outlineVertexBuffer.dispose(),Object(O.j)(this.outlineIndexBuffer)&&this.outlineIndexBuffer.dispose(),this.outlineVertexArrayObject=null,this.outlineVertexBuffer=null,this.outlineIndexBuffer=null,this.memoryUsed=0}},{key:"doPrepareForRendering",value:function(e,t,i){var r=new Uint32Array(t),a=new Int32Array(r.buffer),n=r[i++];this.fillVertexBuffer=R.a.createVertex(e,35044,new Int32Array(a.buffer,4*i,n)),i+=n;var s=r[i++];this.fillIndexBuffer=R.a.createIndex(e,35044,new Uint32Array(r.buffer,4*i,s)),i+=s;var o=r[i++];this.outlineVertexBuffer=R.a.createVertex(e,35044,new Int32Array(a.buffer,4*i,o)),i+=o;var l=r[i++];this.outlineIndexBuffer=R.a.createIndex(e,35044,new Uint32Array(r.buffer,4*i,l)),i+=l;var h=this.layer,c=h.fillMaterial,u=h.outlineMaterial;this.fillVertexArrayObject=new D.a(e,c.getAttributeLocations(),c.getLayoutInfo(),{geometry:this.fillVertexBuffer},this.fillIndexBuffer),this.outlineVertexArrayObject=new D.a(e,u.getAttributeLocations(),u.getLayoutInfo(),{geometry:this.outlineVertexBuffer},this.outlineIndexBuffer)}}]),i}(fe),ve=function(e){Object(y.a)(i,e);var t=Object(d.a)(i);function i(e,r,a){var n;Object(h.a)(this,i),(n=t.call(this,e,r)).type=3,n.iconPerPageElementsMap=new Map,n.glyphPerPageElementsMap=new Map,n.symbolInstances=[],n.isIconSDF=!1,n.opacityChanged=!1,n.lastOpacityUpdate=0,n.symbols=[];var s=new Uint32Array(e),o=new Int32Array(e),l=new Float32Array(e),c=n.bufferDataOffset;n.isIconSDF=!!s[c++];for(var u=s[c++],f=0;f<u;f++){var y=s[c++],d=s[c++],v=s[c++];n.iconPerPageElementsMap.set(y,[d,v])}for(var p=s[c++],_=0;_<p;_++){var b=s[c++],g=s[c++],m=s[c++];n.glyphPerPageElementsMap.set(b,[g,m])}var O=s[c++],x=s[c++];return n.iconOpacity=new Int32Array(O),n.textOpacity=new Int32Array(x),c=function(e,t,i,r,a,n){for(var s=t[r++],o=0;o<s;o++){var l=new oe(n);l.xTile=t[r++],l.yTile=t[r++],l.hash=t[r++],l.priority=t[r++];for(var h=t[r++],c=0;c<h;c++){var u=t[r++],f=t[r++],y=t[r++],d=t[r++],v=!!t[r++],p=t[r++],_=i[r++],b=i[r++],g=t[r++],m=t[r++];l.colliders.push({xTile:u,yTile:f,dxPixels:y,dyPixels:d,hard:v,partIndex:p,width:g,height:m,minLod:_,maxLod:b})}for(var O=e[r++],x=0;x<O;x++)l.textVertexRanges.push([e[r++],e[r++]]);for(var k=e[r++],j=0;j<k;j++)l.iconVertexRanges.push([e[r++],e[r++]]);a.push(l)}return r}(s,o,l,c,n.symbols,a),n.bufferDataOffset=c,n}return Object(c.a)(i,[{key:"hasData",value:function(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}},{key:"triangleCount",value:function(){var e,t=0,i=Object(n.a)(this.iconPerPageElementsMap);try{for(i.s();!(e=i.n()).done;){var r=Object(a.a)(e.value,2);r[0];t+=r[1][1]}}catch(h){i.e(h)}finally{i.f()}var s,o=Object(n.a)(this.glyphPerPageElementsMap);try{for(o.s();!(s=o.n()).done;){var l=Object(a.a)(s.value,2);l[0];t+=l[1][1]}}catch(h){o.e(h)}finally{o.f()}return t/3}},{key:"doDestroy",value:function(){Object(O.j)(this.iconVertexArrayObject)&&this.iconVertexArrayObject.dispose(),Object(O.j)(this.iconVertexBuffer)&&this.iconVertexBuffer.dispose(),Object(O.j)(this.iconOpacityBuffer)&&this.iconOpacityBuffer.dispose(),Object(O.j)(this.iconIndexBuffer)&&this.iconIndexBuffer.dispose(),this.iconVertexArrayObject=null,this.iconVertexBuffer=null,this.iconOpacityBuffer=null,this.iconIndexBuffer=null,Object(O.j)(this.textVertexArrayObject)&&this.textVertexArrayObject.dispose(),Object(O.j)(this.textVertexBuffer)&&this.textVertexBuffer.dispose(),Object(O.j)(this.textOpacityBuffer)&&this.textOpacityBuffer.dispose(),Object(O.j)(this.textIndexBuffer)&&this.textIndexBuffer.dispose(),this.textVertexArrayObject=null,this.textVertexBuffer=null,this.textOpacityBuffer=null,this.textIndexBuffer=null,this.memoryUsed=0}},{key:"updateOpacityInfo",value:function(){if(this.opacityChanged){this.opacityChanged=!1;var e=Object(O.q)(this.iconOpacity),t=Object(O.q)(this.iconOpacityBuffer);e.length>0&&e.byteLength===t.size&&t.setSubData(e);var i=Object(O.q)(this.textOpacity),r=Object(O.q)(this.textOpacityBuffer);i.length>0&&i.byteLength===r.size&&r.setSubData(i)}}},{key:"doPrepareForRendering",value:function(e,t,i){var r=new Uint32Array(t),a=new Int32Array(r.buffer),n=r[i++];this.iconVertexBuffer=R.a.createVertex(e,35044,new Int32Array(a.buffer,4*i,n)),i+=n;var s=r[i++];this.iconIndexBuffer=R.a.createIndex(e,35044,new Uint32Array(r.buffer,4*i,s)),i+=s;var o=r[i++];this.textVertexBuffer=R.a.createVertex(e,35044,new Int32Array(a.buffer,4*i,o)),i+=o;var l=r[i++];this.textIndexBuffer=R.a.createIndex(e,35044,new Uint32Array(r.buffer,4*i,l)),i+=l,this.iconOpacityBuffer=R.a.createVertex(e,35044,Object(O.q)(this.iconOpacity).buffer),this.textOpacityBuffer=R.a.createVertex(e,35044,Object(O.q)(this.textOpacity).buffer);var h=this.layer,c=h.iconMaterial,u=h.textMaterial;this.iconVertexArrayObject=new D.a(e,c.getAttributeLocations(),c.getLayoutInfo(),{geometry:this.iconVertexBuffer,opacity:this.iconOpacityBuffer},this.iconIndexBuffer),this.textVertexArrayObject=new D.a(e,u.getAttributeLocations(),u.getLayoutInfo(),{geometry:this.textVertexBuffer,opacity:this.textOpacityBuffer},this.textIndexBuffer)}}]),i}(fe),pe=function(e){Object(y.a)(i,e);var t=Object(d.a)(i);function i(e,r){var a;Object(h.a)(this,i),(a=t.call(this,e,r)).type=4,a.circleIndexStart=0,a.circleIndexCount=0;var n=new Uint32Array(e),s=a.bufferDataOffset;return a.circleIndexStart=n[s++],a.circleIndexCount=n[s++],a.bufferDataOffset=s,a}return Object(c.a)(i,[{key:"hasData",value:function(){return this.circleIndexCount>0}},{key:"triangleCount",value:function(){return this.circleIndexCount/3}},{key:"doDestroy",value:function(){Object(O.j)(this.circleVertexArrayObject)&&this.circleVertexArrayObject.dispose(),Object(O.j)(this.circleVertexBuffer)&&this.circleVertexBuffer.dispose(),Object(O.j)(this.circleIndexBuffer)&&this.circleIndexBuffer.dispose(),this.circleVertexArrayObject=null,this.circleVertexBuffer=null,this.circleIndexBuffer=null,this.memoryUsed=0}},{key:"doPrepareForRendering",value:function(e,t,i){var r=new Uint32Array(t),a=new Int32Array(r.buffer),n=r[i++];this.circleVertexBuffer=R.a.createVertex(e,35044,new Int32Array(a.buffer,4*i,n)),i+=n;var s=r[i++];this.circleIndexBuffer=R.a.createIndex(e,35044,new Uint32Array(r.buffer,4*i,s)),i+=s;var o=this.layer.circleMaterial;this.circleVertexArrayObject=new D.a(e,o.getAttributeLocations(),o.getLayoutInfo(),{geometry:this.circleVertexBuffer},this.circleIndexBuffer)}}]),i}(fe),_e=i(771),be=i(671),ge=function(e){Object(y.a)(i,e);var t=Object(d.a)(i);function i(e,r,a,n,s,o){var l,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;return Object(h.a)(this,i),(l=t.call(this,e,r,a,n,s,4096,4096))._memCache=c,l.type="vector-tile",l._referenced=0,l._hasSymbolBuckets=!1,l._memoryUsedByLayerData=0,l.layerData=new Map,l.layerCount=0,l.status="loading",l.allSymbolsFadingOut=!1,l.lastOpacityUpdate=0,l.symbols=new Map,l.isCoverage=!1,l.neededForCoverage=!1,l.decluttered=!1,l.invalidating=!1,l.parentTile=null,l.childrenTiles=new Set,l._processed=!1,l._referenced=1,l.styleRepository=o,l.id=e.id,l}return Object(c.a)(i,[{key:"hasSymbolBuckets",get:function(){return this._hasSymbolBuckets}},{key:"isFading",get:function(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<_e.d}},{key:"isHoldingForFade",get:function(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<_e.d)}},{key:"wasRequested",get:function(){return"errored"===this.status||"loaded"===this.status||"reloading"===this.status}},{key:"setData",value:function(e){this.changeDataImpl(e),this.requestRender(),this.ready(),this.invalidating=!1,this._processed=!0}},{key:"deleteLayerData",value:function(e){var t,i=!1,r=Object(n.a)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;if(this.layerData.has(a)){var s=this.layerData.get(a);this._memoryUsedByLayerData-=s.memoryUsed,3===s.type&&this.symbols.has(a)&&(this.symbols.delete(a),i=!0),s.destroy(),this.layerData.delete(a),this.layerCount--}}}catch(o){r.e(o)}finally{r.f()}Object(O.j)(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData),i&&this.emit("symbols-changed"),this.requestRender()}},{key:"processed",value:function(){return this._processed}},{key:"hasData",value:function(){return this.layerCount>0}},{key:"dispose",value:function(){"unloaded"!==this.status&&(me.delete(this),i._destroyRenderBuckets(this.layerData),this.layerData=null,this.layerCount=0,this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}},{key:"release",value:function(){return 0==--this._referenced&&(this.dispose(),this.stage=null,!0)}},{key:"retain",value:function(){++this._referenced}},{key:"referenced",get:function(){return this._referenced}},{key:"memoryUsage",get:function(){return(this._memoryUsedByLayerData+256)/(this._referenced||1)}},{key:"changeDataImpl",value:function(e){var t=!1;if(e){var i,r=this._createRenderBuckets(e),s=Object(n.a)(r);try{for(s.s();!(i=s.n()).done;){var o=Object(a.a)(i.value,2),l=o[0],h=o[1];if(this.layerData.has(l)){var c=this.layerData.get(l);this._memoryUsedByLayerData-=h.memoryUsed,c.destroy(),this.layerData.delete(l),this.layerCount--}3===h.type&&(this.symbols.set(l,h.symbols),t=!0),this._memoryUsedByLayerData+=h.memoryUsed,this.layerData.set(l,h),this.layerCount++}}catch(d){s.e(d)}finally{s.f()}Object(O.j)(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData)}this._hasSymbolBuckets=!1;var u,f=Object(n.a)(this.layerData);try{for(f.s();!(u=f.n()).done;){var y=Object(a.a)(u.value,2);y[0];3===y[1].type&&(this._hasSymbolBuckets=!0)}}catch(d){f.e(d)}finally{f.f()}t&&this.emit("symbols-changed")}},{key:"attachWithContext",value:function(e){this.stage={context:e,trashDisplayObject:function(e){e.processDetach()},untrashDisplayObject:function(){return!1}}}},{key:"setTransform",value:function(e,t){Object(u.a)(Object(f.a)(i.prototype),"setTransform",this).call(this,e,t);var r=t/(e.resolution*e.pixelRatio),a=this.width/this.rangeX*r,n=this.height/this.rangeY*r,s=[0,0];e.toScreen(s,[this.x,this.y]);var o=this.transforms.tileUnitsToPixels;Object(ne.b)(o),Object(ne.c)(o,o,s),Object(ne.j)(o,o,Math.PI*e.rotation/180),Object(ne.d)(o,o,[a,n,1])}},{key:"_createTransforms",value:function(){return{dvs:Object(se.b)(),tileMat3:Object(se.b)(),tileUnitsToPixels:Object(se.b)()}}},{key:"_createRenderBuckets",value:function(e){var t,i=new Map,r=new Map,a=Object(n.a)(e);try{for(a.s();!(t=a.n()).done;){var s,o=t.value,l=this._deserializeBucket(o,r),h=Object(n.a)(l.layerUIDs);try{for(h.s();!(s=h.n()).done;){var c=s.value;i.set(c,l)}}catch(u){h.e(u)}finally{h.f()}}}catch(u){a.e(u)}finally{a.f()}return i}},{key:"_deserializeBucket",value:function(e,t){var i=t.get(e);if(i)return i;switch(new Uint32Array(e)[0]){case 1:i=new de(e,this.styleRepository);break;case 2:i=new ye(e,this.styleRepository);break;case 3:i=new ve(e,this.styleRepository,this);break;case 4:i=new pe(e,this.styleRepository)}return t.set(e,i),i}}],[{key:"_destroyRenderBuckets",value:function(e){if(e){var t=new Set;e.forEach((function(e){t.has(e)||(e.destroy(),t.add(e))})),e.clear()}}}]),i}(be.a),me=new Map;var Oe=i(105);function xe(e,t,i,r,s,o){var l,h=r.iconRotationAlignment,c=r.textRotationAlignment,u=r.iconTranslate,f=r.iconTranslateAnchor,y=r.textTranslate,d=r.textTranslateAnchor,v=0,p=Object(n.a)(e.colliders);try{for(p.s();!(l=p.n()).done;){var _=l.value,b=0===_.partIndex?u:y,g=Object(a.a)(b,2),m=g[0],O=g[1],x=0===_.partIndex?f:d,k=_.minLod<=o&&o<=_.maxLod;v+=k?0:1,_.enabled=k,_.xScreen=_.xTile*s[0]+_.yTile*s[3]+s[6],_.yScreen=_.xTile*s[1]+_.yTile*s[4]+s[7],0===x?(_.xScreen+=i*m-t*O,_.yScreen+=t*m+i*O):(_.xScreen+=m,_.yScreen+=O),1===(0===_.partIndex?h:c)?(_.dxScreen=_.dxPixels,_.dyScreen=_.dyPixels):(_.dxScreen=i*(_.dxPixels+_.width/2)-t*(_.dyPixels+_.height/2)-_.width/2,_.dyScreen=t*(_.dxPixels+_.width/2)+i*(_.dyPixels+_.height/2)-_.height/2)}}catch(j){p.e(j)}finally{p.f()}e.colliders.length>0&&v===e.colliders.length&&(e.unique.show=!1)}var ke=function(){function e(t,i,r,a,s,o){Object(h.a)(this,e),this._symbols=t,this._styleRepository=a,this._zoom=s,this._currentLayerCursor=0,this._currentSymbolCursor=0,this._styleProps=new Map,this._allNeededMatrices=new Map,this._gridIndex=new ce(i,r,_e.a),this._si=Math.sin(Math.PI*o/180),this._co=Math.cos(Math.PI*o/180);var l,c=Object(n.a)(t);try{for(c.s();!(l=c.n()).done;){var u,f=l.value,y=Object(n.a)(f.symbols);try{for(y.s();!(u=y.n()).done;){var d=u.value;this._allNeededMatrices.has(d.tile)||this._allNeededMatrices.set(d.tile,Object(se.a)(d.tile.transforms.tileUnitsToPixels))}}catch(v){y.e(v)}finally{y.f()}}}catch(v){c.e(v)}finally{c.f()}}return Object(c.a)(e,[{key:"work",value:function(e){var t=this._gridIndex;function i(e){for(var i=e.xScreen+e.dxScreen,r=e.yScreen+e.dyScreen,s=i+e.width,o=r+e.height,l=t.getCellSpan(i,r,s,o),h=Object(a.a)(l,4),c=h[0],u=h[1],f=h[2],y=h[3],d=u;d<=y;d++)for(var v=c;v<=f;v++){var p,_=t.cells[d][v],b=Object(n.a)(_);try{for(b.s();!(p=b.n()).done;){var g=p.value,m=g.xScreen+g.dxScreen,O=g.yScreen+g.dyScreen,x=m+g.width,k=O+g.height;if(!(s<m||i>x||o<O||r>k))return!0}}catch(j){b.e(j)}finally{b.f()}}return!1}for(var r=performance.now();this._currentLayerCursor<this._symbols.length;this._currentLayerCursor++,this._currentSymbolCursor=0)for(var s=this._symbols[this._currentLayerCursor],o=this._getProperties(s.styleLayerUID);this._currentSymbolCursor<s.symbols.length;this._currentSymbolCursor++){if(this._currentSymbolCursor%100==99&&performance.now()-r>e)return!1;var l=s.symbols[this._currentSymbolCursor];if(l.unique.show){xe(l,this._si,this._co,o,this._allNeededMatrices.get(l.tile),this._zoom);var h=l.unique;if(h.show){var c,u=o.iconAllowOverlap,f=o.iconIgnorePlacement,y=o.textAllowOverlap,d=o.textIgnorePlacement,v=Object(n.a)(l.colliders);try{for(v.s();!(c=v.n()).done;){var p=c.value;if(p.enabled){var _=h.parts[p.partIndex];_.show&&!(p.partIndex?y:u)&&i(p)&&(p.hard?h.show=!1:_.show=!1)}}}catch(R){v.e(R)}finally{v.f()}if(h.show){var b,g=Object(n.a)(l.colliders);try{for(g.s();!(b=g.n()).done;){var m=b.value;if(m.enabled&&(!(m.partIndex?d:f)&&h.parts[m.partIndex].show))for(var O=m.xScreen+m.dxScreen,x=m.yScreen+m.dyScreen,k=O+m.width,j=x+m.height,w=this._gridIndex.getCellSpan(O,x,k,j),P=Object(a.a)(w,4),S=P[0],C=P[1],M=P[2],I=P[3],T=C;T<=I;T++)for(var L=S;L<=M;L++)this._gridIndex.cells[T][L].push(m)}}catch(R){g.e(R)}finally{g.f()}}}}}return!0}},{key:"_getProperties",value:function(e){var t=this._styleProps.get(e);if(t)return t;var i=this._zoom,r=this._styleRepository.getStyleLayerByUID(e),a=0!==r.getLayoutValue("symbol-placement",i),n=r.getLayoutValue("icon-rotation-alignment",i);2===n&&(n=a?0:1);var s=r.getLayoutValue("text-rotation-alignment",i);2===s&&(s=a?0:1);var o=r.getPaintValue("icon-translate",i),l=r.getPaintValue("icon-translate-anchor",i),h=r.getPaintValue("text-translate",i),c=r.getPaintValue("text-translate-anchor",i),u={iconAllowOverlap:r.getLayoutValue("icon-allow-overlap",i),iconIgnorePlacement:r.getLayoutValue("icon-ignore-placement",i),textAllowOverlap:r.getLayoutValue("text-allow-overlap",i),textIgnorePlacement:r.getLayoutValue("text-ignore-placement",i),iconRotationAlignment:n,textRotationAlignment:s,iconTranslateAnchor:l,iconTranslate:o,textTranslateAnchor:c,textTranslate:h};return this._styleProps.set(e,u),u}}]),e}();function je(e,t){if(e.priority-t.priority)return e.priority-t.priority;var i=e.tile.key,r=t.tile.key;return i.world-r.world?i.world-r.world:i.level-r.level?i.level-r.level:i.row-r.row?i.row-r.row:i.col-r.col?i.col-r.col:e.xTile-t.xTile?e.xTile-t.xTile:e.yTile-t.yTile}var we=function(){function e(t,i,r,a,n,s){Object(h.a)(this,e),this._visibleTiles=t,this._symbolRepository=i,this._createCollisionJob=r,this._assignTileSymbolsOpacity=a,this._symbolLayerSorter=n,this._isLayerVisible=s,this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}return Object(c.a)(e,[{key:"running",get:function(){return this._running}},{key:"setScreenSize",value:function(e,t){this._screenWidth===e&&this._screenHeight===t||this.restart(),this._screenWidth=e,this._screenHeight=t}},{key:"restart",value:function(){this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}},{key:"continue",value:function(e){if(this._selectionJob||(this._selectionJob=this._createSelectionJob()),!this._selectionJobCompleted){var t=performance.now();if(!this._selectionJob.work(e))return!1;if(this._selectionJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-t))))return!1}if(this._collisionJob||(this._collisionJob=this._createCollisionJob(this._selectionJob.sortedSymbols,this._screenWidth,this._screenHeight)),!this._collisionJobCompleted){var i=performance.now();if(!this._collisionJob.work(e))return!1;if(this._collisionJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-i))))return!1}if(this._opacityJob||(this._opacityJob=this._createOpacityJob()),!this._opacityJobCompleted){var r=performance.now();if(!this._opacityJob.work(e))return!1;if(this._opacityJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-r))))return!1}return this._running=!1,!0}},{key:"_createSelectionJob",value:function(){for(var e=this._symbolRepository.uniqueSymbols,t=0;t<e.length;t++)for(var i=e[t],r=0;r<i.uniqueSymbols.length;r++){var a,s=i.uniqueSymbols[r],o=Object(n.a)(s.tileSymbols);try{for(o.s();!(a=o.n()).done;){a.value.selectedForRendering=!1}}catch(y){o.e(y)}finally{o.f()}}var l=[],h=0,c=0,u=this._isLayerVisible;var f=this._symbolLayerSorter;return{work:function(t){for(var i,r=performance.now();c<e.length;c++,h=0){var a=e[c],s=a.styleLayerUID;if(u(s)){l[c]=l[c]||{styleLayerUID:s,symbols:[]};for(var o=l[c];h<a.uniqueSymbols.length;h++){if(i=a.uniqueSymbols[h],h%100==99&&performance.now()-r>t)return!1;var f,d=null,v=!1,p=!1,_=Object(n.a)(i.tileSymbols);try{for(_.s();!(f=_.n()).done;){var b=f.value;if(!p||!v){var g=b.tile;(!d||g.isCoverage||g.neededForCoverage&&!v)&&(d=b,(g.neededForCoverage||g.isCoverage)&&(p=!0),g.isCoverage&&(v=!0))}}}catch(y){_.e(y)}finally{_.f()}if(d.selectedForRendering=!0,p){o.symbols.push(d),i.show=!0;var m,O=Object(n.a)(i.parts);try{for(O.s();!(m=O.n()).done;){m.value.show=!0}}catch(y){O.e(y)}finally{O.f()}}else i.show=!1}}else l[c]||(l[c]={styleLayerUID:s,symbols:[]})}var x,k=Object(n.a)(l);try{for(k.s();!(x=k.n()).done;){x.value.symbols.sort(je)}}catch(y){k.e(y)}finally{k.f()}return!0},get sortedSymbols(){return l.sort(f)}}}},{key:"_createOpacityJob",value:function(){var e=this._assignTileSymbolsOpacity,t=this._visibleTiles,i=0;function r(t,i){var s,o=t.symbols,l=Object(n.a)(o);try{for(l.s();!(s=l.n()).done;){var h=Object(a.a)(s.value,2);h[0];Pe(h[1],i)}}catch(f){l.e(f)}finally{l.f()}e(t,i);var c,u=Object(n.a)(t.childrenTiles);try{for(u.s();!(c=u.n()).done;){r(c.value,i)}}catch(f){u.e(f)}finally{u.f()}}return{work:function(e){for(var a=performance.now();i<t.length;i++){if(performance.now()-a>e)return!1;var n=t[i];Object(O.j)(n.parentTile)||r(n,performance.now())}return!0}}}}]),e}();function Pe(e,t){var i,r=Object(n.a)(e);try{for(r.s();!(i=r.n()).done;){var a,s=i.value.unique,o=Object(n.a)(s.parts);try{for(o.s();!(a=o.n()).done;){var l=a.value,h=l.targetOpacity>.5?1:-1;l.startOpacity+=h*((t-l.startTime)/_e.d),l.startOpacity=Math.min(Math.max(l.startOpacity,0),1),l.startTime=t,l.targetOpacity=s.show&&l.show?1:0}}catch(c){o.e(c)}finally{o.f()}}}catch(c){r.e(c)}finally{r.f()}}var Se=function(){function e(t,i,r){Object(h.a)(this,e),this.tileCoordRange=t,this._visibleTiles=i,this._createUnique=r,this._tiles=new Map,this._uniqueSymbolsReferences=new Map}return Object(c.a)(e,[{key:"uniqueSymbols",get:function(){return Object(O.i)(this._uniqueSymbolLayerArray)&&(this._uniqueSymbolLayerArray=this._createUniqueSymbolLayerArray()),this._uniqueSymbolLayerArray}},{key:"add",value:function(e,t){this._uniqueSymbolLayerArray=null;var i=this._tiles.get(e.id);i||(i={symbols:new Map},this._tiles.set(e.id,i));var r=new Map;if(t){var s,o=Object(n.a)(t);try{for(o.s();!(s=o.n()).done;){var l=s.value;i.symbols.has(l)&&(r.set(l,i.symbols.get(l)),i.symbols.delete(l))}}catch(P){o.e(P)}finally{o.f()}}else{var h,c=Object(n.a)(e.layerData);try{for(c.s();!(h=c.n()).done;){var u=Object(a.a)(h.value,2),f=u[0];u[1];i.symbols.has(f)&&(r.set(f,i.symbols.get(f)),i.symbols.delete(f))}}catch(P){c.e(P)}finally{c.f()}}this._removeSymbols(r);var y,d=e.symbols,v=new Map,p=Object(n.a)(d);try{for(p.s();!(y=p.n()).done;){var _=Object(a.a)(y.value,2),b=_[0],g=_[1],m=g.length;if(m>=32){var O=this.tileCoordRange;do{O/=2,m/=4}while(m>8&&O>64);var x=new ce(this.tileCoordRange,this.tileCoordRange,O);v.set(b,{flat:g,index:x}),i.symbols.set(b,{flat:g,index:x});var k,j=Object(n.a)(g);try{for(j.s();!(k=j.n()).done;){var w=k.value;x.getCell(w.xTile,w.yTile).push(w)}}catch(P){j.e(P)}finally{j.f()}}else v.set(b,{flat:g}),i.symbols.set(b,{flat:g})}}catch(P){p.e(P)}finally{p.f()}this._addSymbols(e.key,d)}},{key:"deleteStyleLayers",value:function(e){this._uniqueSymbolLayerArray=null;var t,i=Object(n.a)(this._tiles);try{for(i.s();!(t=i.n()).done;){var r,s=Object(a.a)(t.value,2),o=s[0],l=s[1],h=new Map,c=Object(n.a)(e);try{for(c.s();!(r=c.n()).done;){var u=r.value;l.symbols.has(u)&&(h.set(u,l.symbols.get(u)),l.symbols.delete(u))}}catch(f){c.e(f)}finally{c.f()}this._removeSymbols(h),0===l.symbols.size&&this._tiles.delete(o)}}catch(f){i.e(f)}finally{i.f()}}},{key:"removeTile",value:function(e){this._uniqueSymbolLayerArray=null;var t=this._tiles.get(e.id);if(t){var i,r=new Map,s=Object(n.a)(e.symbols);try{for(s.s();!(i=s.n()).done;){var o=Object(a.a)(i.value,2),l=o[0];o[1];t.symbols.has(l)&&(r.set(l,t.symbols.get(l)),t.symbols.delete(l))}}catch(h){s.e(h)}finally{s.f()}this._removeSymbols(r),0===t.symbols.size&&this._tiles.delete(e.id)}}},{key:"_removeSymbols",value:function(e){var t,i=Object(n.a)(e);try{for(i.s();!(t=i.n()).done;){var r,s=Object(a.a)(t.value,2),o=s[0],l=s[1].flat,h=Object(n.a)(l);try{for(h.s();!(r=h.n()).done;){for(var c=r.value,u=c.unique,f=u.tileSymbols,y=f.length-1,d=0;d<y;d++)if(f[d]===c){f[d]=f[y];break}if(f.length=y,0===y){var v=this._uniqueSymbolsReferences.get(o);v.delete(u),0===v.size&&this._uniqueSymbolsReferences.delete(o)}c.unique=null}}catch(p){h.e(p)}finally{h.f()}}}catch(p){i.e(p)}finally{i.f()}}},{key:"_addSymbols",value:function(e,t){if(0!==t.size){var i,r=this._visibleTiles,s=Object(n.a)(r);try{for(s.s();!(i=s.n()).done;){var o=i.value;o.parentTile||o.key.world!==e.world||o.key.level===e.level&&!o.key.equals(e)||this._matchSymbols(o,e,t)}}catch(b){s.e(b)}finally{s.f()}var l,h=Object(n.a)(t);try{for(h.s();!(l=h.n()).done;){var c,u=Object(a.a)(l.value,2),f=u[0],y=u[1],d=Object(n.a)(y);try{for(d.s();!(c=d.n()).done;){var v=c.value;if(Object(O.i)(v.unique)){var p=this._createUnique();v.unique=p,p.tileSymbols.push(v);var _=this._uniqueSymbolsReferences.get(f);_||(_=new Set,this._uniqueSymbolsReferences.set(f,_)),_.add(p)}}}catch(b){d.e(b)}finally{d.f()}}}catch(b){h.e(b)}finally{h.f()}}}},{key:"_matchSymbols",value:function(e,t,i){if(e.key.level>t.level){var r=e.key.level-t.level;if(e.key.row>>r!==t.row||e.key.col>>r!==t.col)return}if(t.level>e.key.level){var s=t.level-e.key.level;if(t.row>>s!==e.key.row||t.col>>s!==e.key.col)return}if(t.equals(e.key)){var o,l=Object(n.a)(e.childrenTiles);try{for(l.s();!(o=l.n()).done;){var h=o.value;this._matchSymbols(h,t,i)}}catch(q){l.e(q)}finally{l.f()}}else{var c,u=new Map,f=Object(n.a)(i);try{for(f.s();!(c=f.n()).done;){var y,d=Object(a.a)(c.value,2),v=d[0],p=d[1],_=[],b=Object(n.a)(p);try{for(b.s();!(y=b.n()).done;){var g=y.value,m=he(this.tileCoordRange,g.xTile,t.level,t.col,e.key.level,e.key.col),x=he(this.tileCoordRange,g.yTile,t.level,t.row,e.key.level,e.key.row);m>=0&&m<this.tileCoordRange&&x>=0&&x<this.tileCoordRange&&_.push({symbol:g,xTransformed:m,yTransformed:x})}}catch(q){b.e(q)}finally{b.f()}var k=[],j=e.key.level<t.level?1:1<<e.key.level-t.level,w=this._tiles.get(e.id).symbols.get(v);if(w){var P,S=w.flat,C=Object(n.a)(_);try{for(C.s();!(P=C.n()).done;){var M,I=P.value,T=!1,L=I.xTransformed,R=I.yTransformed;M=Object(O.j)(w.index)?w.index.getCell(L,R):S;var A,D=I.symbol,V=D.hash,z=Object(n.a)(M);try{for(z.s();!(A=z.n()).done;){var B=A.value;if(V===B.hash&&Math.abs(L-B.xTile)<=j&&Math.abs(R-B.yTile)<=j){var F=B.unique;D.unique=F,F.tileSymbols.push(D),T=!0;break}}}catch(q){z.e(q)}finally{z.f()}T||k.push(D)}}catch(q){C.e(q)}finally{C.f()}}k.length>0&&u.set(v,k)}}catch(q){f.e(q)}finally{f.f()}var E,U=Object(n.a)(e.childrenTiles);try{for(U.s();!(E=U.n()).done;){var H=E.value;this._matchSymbols(H,t,u)}}catch(q){U.e(q)}finally{U.f()}}}},{key:"_createUniqueSymbolLayerArray",value:function(){var e,t,i=this._uniqueSymbolsReferences,r=new Array(i.size),s=0,o=Object(n.a)(i);try{for(o.s();!(t=o.n()).done;){var l=Object(a.a)(t.value,2),h=l[0],c=l[1],u=new Array(c.size);e=0;var f,y=Object(n.a)(c);try{for(y.s();!(f=y.n()).done;){var d=f.value;u[e++]=d}}catch(v){y.e(v)}finally{y.f()}r[s]={styleLayerUID:h,uniqueSymbols:u},s++}}catch(v){o.e(v)}finally{o.f()}return r}}]),e}(),Ce=function(e){Object(y.a)(i,e);var t=Object(d.a)(i);function i(e,r){var s;return Object(h.a)(this,i),(s=t.call(this)).styleRepository=e,s._tileToHandle=new Map,s._viewState={scale:0,rotation:0,center:[0,0],size:[0,0]},s._declutterViewState={scale:0,rotation:0,center:[0,0],size:[0,0]},s._completed=!1,s._symbolRepository=new Se(4096,r,(function(){return new le})),s._symbolDeclutterer=new we(r,s._symbolRepository,(function(e,t,i){return new ke(e,t,i,s.styleRepository,s._zoom,s._viewState.rotation)}),(function(e,t){e.allSymbolsFadingOut=!0,e.lastOpacityUpdate=t,function(e,t,i){var r,s=Object(n.a)(e.symbols);try{for(s.s();!(r=s.n()).done;){var o=Object(a.a)(r.value,2),l=o[0];ue(e,t,i,o[1],l)}}catch(h){s.e(h)}finally{s.f()}}(e,t,!0),e.decluttered=!0,e.requestRender()}),(function(e,t){return s.styleRepository.getStyleLayerByUID(e.styleLayerUID).z-s.styleRepository.getStyleLayerByUID(t.styleLayerUID).z}),(function(e){var t=s.styleRepository.getStyleLayerByUID(e);if(s._zoom<t.minzoom||s._zoom>t.maxzoom)return!1;var i=t.getLayoutProperty("visibility");return!i||1!==i.getValue()})),s}return Object(c.a)(i,[{key:"addTile",value:function(e){var t=this;e.decluttered=!1,this._tileToHandle.set(e,e.on("symbols-changed",(function(){t._symbolRepository.add(e),t.restartDeclutter()}))),this._symbolRepository.add(e),this.restartDeclutter()}},{key:"removeTile",value:function(e){var t=this._tileToHandle.get(e);t&&(this._symbolRepository.removeTile(e),this.restartDeclutter(),t.remove(),this._tileToHandle.delete(e))}},{key:"update",value:function(e,t){return this._zoom=e,this._viewState={scale:t.scale,rotation:t.rotation,center:[t.center[0],t.center[1]],size:[t.size[0],t.size[1]]},this._continueDeclutter(),this._completed}},{key:"restartDeclutter",value:function(){this._completed=!1,this._symbolDeclutterer.restart(),this._notifyUnstable()}},{key:"clear",value:function(){this._completed=!1,this._symbolRepository=null,this._symbolDeclutterer.restart(),this._tileToHandle.forEach((function(e){return e.remove()})),this._tileToHandle.clear()}},{key:"stale",get:function(){return this._zoom!==this._declutterZoom||this._viewState.size[0]!==this._declutterViewState.size[0]||this._viewState.size[1]!==this._declutterViewState.size[1]||this._viewState.scale!==this._declutterViewState.scale||this._viewState.rotation!==this._declutterViewState.rotation}},{key:"deleteStyleLayers",value:function(e){this._symbolRepository.deleteStyleLayers(e)}},{key:"_continueDeclutter",value:function(){this._completed&&!this.stale||(this._symbolDeclutterer.running||(this._declutterZoom=this._zoom,this._declutterViewState.center[0]=this._viewState.center[0],this._declutterViewState.center[1]=this._viewState.center[1],this._declutterViewState.rotation=this._viewState.rotation,this._declutterViewState.scale=this._viewState.scale,this._declutterViewState.size[0]=this._viewState.size[0],this._declutterViewState.size[1]=this._viewState.size[1],this._symbolDeclutterer.restart()),this._symbolDeclutterer.setScreenSize(this._viewState.size[0],this._viewState.size[1]),this._completed=this._symbolDeclutterer.continue(_e.b),this._completed&&this._scheduleNotifyStable())}},{key:"_scheduleNotifyStable",value:function(){var e=this;Object(O.j)(this._stableNotificationHandle)&&clearTimeout(this._stableNotificationHandle),this._stableNotificationHandle=setTimeout((function(){e._stableNotificationHandle=null,e.emit("fade-complete")}),1.5*_e.d)}},{key:"_notifyUnstable",value:function(){Object(O.j)(this._stableNotificationHandle)&&(clearTimeout(this._stableNotificationHandle),this._stableNotificationHandle=null),this.emit("fade-start")}}]),i}(Oe.a),Me=i(638),Ie=function(e){Object(y.a)(i,e);var t=Object(d.a)(i);function i(){return Object(h.a)(this,i),t.apply(this,arguments)}return Object(c.a)(i,[{key:"_createTransforms",value:function(){return{dvs:Object(se.b)(),tileMat3:Object(se.b)()}}}]),i}(be.a),Te=i(680),Le=1e-6;function Re(e,t){if(e){var i=e.getLayoutProperty("visibility");if(!i||1!==i.getValue()&&(void 0===e.minzoom||e.minzoom<t+Le)&&(void 0===e.maxzoom||e.maxzoom>=t-Le))return!0}return!1}var Ae=function(e){Object(y.a)(i,e);var t=Object(d.a)(i);function i(e){var r;return Object(h.a)(this,i),(r=t.call(this,e))._backgroundTiles=[],r._pointToCallbacks=new Map,r}return Object(c.a)(i,[{key:"destroy",value:function(){this.removeAllChildren(),this._spriteMosaic&&(this._spriteMosaic.dispose(),this._spriteMosaic=null),this._glyphMosaic&&(this._glyphMosaic.dispose(),this._glyphMosaic=null),Object(O.j)(this._symbolFader)&&(this._symbolFader.clear(),this._symbolFader=null),this._styleRepository=null,this._backgroundTiles=[],this._pointToCallbacks.clear()}},{key:"setStyleResources",value:function(e,t,i){var r=this;if(this._spriteMosaic=e,this._glyphMosaic=t,this._styleRepository=i,Object(O.i)(this._symbolFader)){var a=new Ce(this._styleRepository,this.children);a.on("fade-start",(function(){r.emit("fade-start"),r.requestRender()})),a.on("fade-complete",(function(){r.emit("fade-complete"),r.requestRender()})),this._symbolFader=a}Object(O.q)(this._symbolFader).styleRepository=i}},{key:"deleteStyleLayers",value:function(e){Object(O.j)(this._symbolFader)&&this._symbolFader.deleteStyleLayers(e)}},{key:"hitTest",value:function(){var e=Object(l.a)(o.a.mark((function e(t,i){var r,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=[t,i],a=Object(x.g)(),e.abrupt("return",(this._pointToCallbacks.set(r,a),this.requestRender(),a.promise));case 2:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"enterTileInvalidation",value:function(){var e,t=Object(n.a)(this.children);try{for(t.s();!(e=t.n()).done;){e.value.invalidating=!0}}catch(i){t.e(i)}finally{t.f()}}},{key:"createRenderParams",value:function(e){return Object(M.a)(Object(M.a)({},Object(u.a)(Object(f.a)(i.prototype),"createRenderParams",this).call(this,e)),{},{renderPass:null,styleLayer:null,styleLayerUID:-1,glyphMosaic:this._glyphMosaic,spriteMosaic:this._spriteMosaic,hasClipping:!!this._clippingInfos})}},{key:"doRender",value:function(e){!this.visible||e.drawPhase!==Me.c.MAP&&e.drawPhase!==Me.c.DEBUG||void 0===this._spriteMosaic||Object(u.a)(Object(f.a)(i.prototype),"doRender",this).call(this,e)}},{key:"addChild",value:function(e){return Object(u.a)(Object(f.a)(i.prototype),"addChild",this).call(this,e),Object(O.j)(this._symbolFader)?this._symbolFader.addTile(e):e.decluttered=!0,this.requestRender(),e}},{key:"removeChild",value:function(e){return Object(O.j)(this._symbolFader)&&this._symbolFader.removeTile(e),this.requestRender(),Object(u.a)(Object(f.a)(i.prototype),"removeChild",this).call(this,e)}},{key:"renderChildren",value:function(e){if(e.drawPhase!==Me.c.DEBUG){if(this._doRender(e),this._pointToCallbacks.size>0){var t=e.context,r=t.getBoundFramebufferObject();e.drawPhase=Me.c.HITTEST;var a=e.painter.effects.hittest;a.bind(e),this._doRender(e),a.draw(e,this._pointToCallbacks),t.bindFramebuffer(r)}}else Object(u.a)(Object(f.a)(i.prototype),"renderChildren",this).call(this,e)}},{key:"removeAllChildren",value:function(){for(var e=0;e<this.children.length;e++){var t=this.children[e];Object(O.j)(this._symbolFader)&&this._symbolFader.removeTile(t),t.dispose()}Object(u.a)(Object(f.a)(i.prototype),"removeAllChildren",this).call(this)}},{key:"getStencilTarget",value:function(){return this.children.filter((function(e){return e.neededForCoverage&&e.hasData()}))}},{key:"restartDeclutter",value:function(){Object(O.j)(this._symbolFader)&&this._symbolFader.restartDeclutter()}},{key:"_doRender",value:function(e){var t=e.context,r=this._styleRepository;if(r){var a=r.layers,s=!0;e.drawPhase===Me.c.HITTEST&&(s=!1),r.backgroundBucketIds.length>0&&(e.renderPass="background",this._renderBackgroundLayers(e,r.backgroundBucketIds)),Object(u.a)(Object(f.a)(i.prototype),"renderChildren",this).call(this,e),e.drawPhase===Me.c.MAP&&this._fade(e.displayLevel,e.state);var o=this.children.filter((function(e){return e.visible&&e.hasData()}));if(o&&0!==o.length){var l,h=Object(n.a)(o);try{for(h.s();!(l=h.n()).done;){l.value.triangleCount=0}}catch(v){h.e(v)}finally{h.f()}t.setStencilWriteMask(0),t.setColorMask(!0,!0,!0,!0),t.setStencilOp(7680,7680,7681),t.setStencilTestEnabled(!0),t.setBlendingEnabled(!1),t.setDepthTestEnabled(!0),t.setDepthWriteEnabled(!0),t.setDepthFunction(515),t.setClearDepth(1),t.clear(t.gl.DEPTH_BUFFER_BIT),e.renderPass="opaque";for(var c=a.length-1;c>=0;c--)this._renderStyleLayer(a[c],e,o);t.setDepthWriteEnabled(!1),t.setBlendingEnabled(s),t.setBlendFunctionSeparate(1,771,1,771),e.renderPass="translucent";for(var y=0;y<a.length;y++)this._renderStyleLayer(a[y],e,o);t.setDepthTestEnabled(!1),e.renderPass="symbol";for(var d=0;d<a.length;d++)this._renderStyleLayer(a[d],e,o);t.bindVAO(),t.setStencilTestEnabled(!0),t.setBlendingEnabled(!0)}}}},{key:"_fade",value:function(e,t){Object(O.j)(this._symbolFader)&&(this._symbolFader.update(e,t)||this.requestRender())}},{key:"_renderStyleLayer",value:function(e,t,i){var r=t.painter,a=t.renderPass;if(void 0!==e){var s=e.getLayoutProperty("visibility");if(!s||1!==s.getValue()){var o;switch(e.type){case 0:return;case 1:if("opaque"!==a&&"translucent"!==t.renderPass)return;o="vtlFill";break;case 2:if("translucent"!==a)return;o="vtlLine";break;case 4:if("symbol"!==a)return;o="vtlCircle";break;case 3:if("symbol"!==a)return;o="vtlSymbol"}if(i=3===e.type?i.filter((function(e){return e.decluttered})):i.filter((function(e){return e.neededForCoverage})),"vtlSymbol"!==o){var l=t.displayLevel;if(0===i.length||void 0!==e.minzoom&&e.minzoom>=l+Le||void 0!==e.maxzoom&&e.maxzoom<l-Le)return}var h=e.uid;t.styleLayerUID=h,t.styleLayer=e;var c,u=Object(n.a)(i);try{for(u.s();!(c=u.n()).done;){if(c.value.layerData.has(h)){r.renderObjects(t,i,o);break}}}catch(f){u.e(f)}finally{u.f()}}}}},{key:"_renderBackgroundLayers",value:function(e,t){var i,r=e.context,a=e.displayLevel,s=e.painter,o=e.state,l=this._styleRepository,h=!1,c=Object(n.a)(t);try{for(c.s();!(i=c.n()).done;){var u=i.value;if(Re(l.getLayerById(u),a)){h=!0;break}}}catch(B){c.e(B)}finally{c.f()}if(h){var f=this._tileInfoView.getTileCoverage(e.state,0,"smallest"),y=f.spans,d=f.lodInfo,v=d.level,p=Object(C.h)(),_=[];if(this._renderPasses){var b=this._renderPasses[0];Object(O.j)(this._clippingInfos)&&(b.brushes[0].prepareState(e,this._clippingInfos[0]),b.brushes[0].drawMany(e,this._clippingInfos))}var g,m,x=this._backgroundTiles,k=0,j=Object(n.a)(y);try{for(j.s();!(m=j.n()).done;)for(var w=m.value,P=w.row,S=w.colFrom,M=w.colTo,I=S;I<=M;I++){if(k<x.length)(g=x[k]).key.set(v,P,d.normalizeCol(I),d.getWorldForColumn(I)),this._tileInfoView.getTileBounds(p,g.key,!1),g.x=p[0],g.y=p[3];else{var T=new Q.a(v,P,d.normalizeCol(I),d.getWorldForColumn(I)),L=this._tileInfoView.getTileBounds(Object(C.h)(),T);g=new Ie(T,L[0],L[3],512,512,4096,4096),x.push(g)}g.setTransform(o,this._tileInfoView.getTileResolution(g.key)),_.push(g),k++}}catch(B){j.e(B)}finally{j.f()}r.setStencilWriteMask(0),r.setColorMask(!0,!0,!0,!0),r.setStencilOp(7680,7680,7681),r.setStencilFunction(514,0,255);var R=!0;e.drawPhase===Me.c.HITTEST&&(R=!1),r.setStencilTestEnabled(R);var A,D=Object(n.a)(t);try{for(D.s();!(A=D.n()).done;){var V=A.value,z=l.getLayerById(V);Re(z,a)&&(e.styleLayerUID=z.uid,e.styleLayer=z,s.renderObjects(e,_,"vtlBackground"))}}catch(B){D.e(B)}finally{D.f()}te.a.pool.release(f)}}}]),i}(Te.a),De=i(467),Ve=i(674),ze=i(17),Be=i(721),Fe=function(e){Object(y.a)(i,e);var t=Object(d.a)(i);function i(e){var r;return Object(h.a)(this,i),(r=t.call(this)).requestRender=r.requestRender.bind(Object(ze.a)(r)),r._layerView=e,r._canvas=document.createElement("canvas"),r._context=r._canvas.getContext("2d"),r._bitmap=new Be.a(null,"standard",!1),r.addChild(r._bitmap),r}return Object(c.a)(i,[{key:"doRender",value:function(e){var t=e.state,r=this._createCustomRenderParams(e),a=r.pixelRatio,n=this._canvas,s=this._bitmap;n.width=t.size[0]*a,n.height=t.size[1]*a,s.resolution=t.resolution,s.pixelRatio=a,s.x=t.viewpoint.targetGeometry.x-Math.abs(t.extent.xmax-t.extent.xmin)/2,s.y=t.viewpoint.targetGeometry.y+Math.abs(t.extent.ymax-t.extent.ymin)/2,this._layerView.render(r),s.source=n,s.rotation=t.rotation,Object(u.a)(Object(f.a)(i.prototype),"doRender",this).call(this,e)}},{key:"_createCustomRenderParams",value:function(e){var t=window.devicePixelRatio,i=Object(M.a)(Object(M.a)({},e.state),{},{pixelRatio:t});return Object(M.a)(Object(M.a)({},e),{},{pixelRatio:t,context:this._context,state:i})}}]),i}(i(746).a),Ee=i(102),Ue=function(e){Object(y.a)(i,e);var t=Object(d.a)(i);function i(){var e;return Object(h.a)(this,i),(e=t.apply(this,arguments))._fullCacheLodInfos=null,e._levelByScale={},e}return Object(c.a)(i,[{key:"getTileParentId",value:function(e){var t=Q.a.pool.acquire(e),i=0===t.level?null:Q.a.getId(t.level-1,t.row>>1,t.col>>1,t.world);return Q.a.pool.release(t),i}},{key:"getTileCoverage",value:function(e,t,r){var a=Object(u.a)(Object(f.a)(i.prototype),"getTileCoverage",this).call(this,e,t,r);if(!a)return a;var n=1<<a.lodInfo.level;return a.spans=a.spans.filter((function(e){return e.row>=0&&e.row<n})),a}},{key:"scaleToLevel",value:function(e){if(this._fullCacheLodInfos||this._initializeFullCacheLODs(this._lodInfos),this._levelByScale[e])return this._levelByScale[e];var t,i,r=this._fullCacheLodInfos;if(e>r[0].scale)return r[0].level;for(var a=0;a<r.length-1;a++)if(e>(i=r[a+1]).scale)return(t=r[a]).level+(t.scale-e)/(t.scale-i.scale);return r[r.length-1].level}},{key:"_initializeFullCacheLODs",value:function(e){var t;if(0===e[0].level)t=e.map((function(e){return{level:e.level,resolution:e.resolution,scale:e.scale}}));else{var i=this.tileInfo.size[0],r=this.tileInfo.spatialReference;t=Ee.a.create({size:i,spatialReference:r}).lods.map((function(e){return{level:e.level,resolution:e.resolution,scale:e.scale}}))}for(var a=0;a<t.length;a++)this._levelByScale[t[a].scale]=t[a].level;this._fullCacheLodInfos=t}}]),i}(i(433).a),He=i(526),qe=i(673),Ge=m.a.getLogger("esri.views.2d.layers.VectorTileLayerView2D"),Ne=function(e){Object(y.a)(i,e);var t=Object(d.a)(i);function i(){var e;return Object(h.a)(this,i),(e=t.apply(this,arguments))._styleChanges=[],e._handles=new b.a,e._fetchQueue=null,e._parseQueue=null,e._isTileHandlerReady=!1,e.fading=!1,e}return Object(c.a)(i,[{key:"initialize",value:function(){var e=this,t=this.layer.tileInfo;if((t&&t.spatialReference).equals(this.view.spatialReference)){var i=this.layer.currentStyleInfo,r=i.style,a=i.spriteUrl,n=i.glyphsUrl;this._styleRepository=new De.a(r,{spriteUrl:a,glyphsUrl:n}),this._tileInfoView=new Ue(this.layer.tileInfo,this.layer.fullExtent),this._vectorTileContainer=new Ae(this._tileInfoView),this._tileHandler=new $(this.layer,this._styleRepository,window.devicePixelRatio||1),this.container.addChild(this._vectorTileContainer),this.handles.add([this._vectorTileContainer.on("fade-start",(function(){e.fading=!0,e.notifyChange("updating"),e.requestUpdate()})),this._vectorTileContainer.on("fade-complete",(function(){e._collisionBoxesDisplay&&e._collisionBoxesDisplay.requestRender(),e.fading=!1,e.notifyChange("updating"),e.requestUpdate()})),Object(k.a)(this.layer,"symbolCollisionBoxesVisible",(function(t){t?(e._collisionBoxesDisplay=new Fe({render:function(t){return e._renderCollisionBoxes(t.context)}}),e.container.addChild(e._collisionBoxesDisplay)):(e.container.removeChild(e._collisionBoxesDisplay),e._collisionBoxesDisplay=null)}))])}else this.addResolvingPromise(Promise.reject(new _.a("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer})))}},{key:"destroy",value:function(){var e;this._stop(),this.container.removeAllChildren(),this._vectorTileContainer&&(this._vectorTileContainer.destroy(),this._vectorTileContainer=null),null==(e=this._tileHandler)||e.destroy(),this._tileHandler=null}},{key:"hitTest",value:function(){var e=Object(l.a)(o.a.mark((function e(t,i){var r,a,n,s,l,h;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.suspended&&this._tileHandlerPromise){e.next=2;break}return e.abrupt("return",null);case 2:return e.next=4,this._tileHandlerPromise;case 4:return e.next=6,this._vectorTileContainer.hitTest(t,i);case 6:if((r=e.sent)&&0!==r.length){e.next=9;break}return e.abrupt("return",null);case 9:if(a=r[0]-1,n=this._styleRepository,s=n.getStyleLayerByUID(a)){e.next=12;break}return e.abrupt("return",null);case 12:return l=n.getStyleLayerIndex(s.id),h=new p.a({attributes:{layerId:l,layerName:s.id,layerUID:a}}),e.abrupt("return",(h.layer=this.layer,h.sourceLayer=this.layer,h));case 14:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"update",value:function(e){if(this._tileHandlerPromise&&this._isTileHandlerReady)return e.pixelRatio!==this._tileHandler.devicePixelRatio?(this._start(),void(this._tileHandler.devicePixelRatio=e.pixelRatio)):void(this._styleChanges.length>0?this._tileHandlerPromise=this._applyStyleChanges():(this._fetchQueue.pause(),this._parseQueue.pause(),this._fetchQueue.state=e.state,this._parseQueue.state=e.state,this._tileManager.update(e)||this.requestUpdate(),this._parseQueue.resume(),this._fetchQueue.resume()))}},{key:"attach",value:function(){var e=this;this._start(),this._handles.add([this.layer.on("paint-change",(function(t){if(t.isDataDriven)e._styleChanges.push({type:0,data:t}),e.notifyChange("updating"),e.requestUpdate();else{var i=e._styleRepository,r=i.getLayerById(t.layer);if(!r)return;var a=3===r.type;i.setPaintProperties(t.layer,t.paint),a&&e._vectorTileContainer.restartDeclutter(),e._vectorTileContainer.requestRender()}})),this.layer.on("layout-change",(function(t){var i=e._styleRepository,r=i.getLayerById(t.layer);if(r){var a=Object(S.a)(r.layout,t.layout);if(!Object(O.i)(a)){if(Object(S.b)(a,"visibility")&&1===function(e){if(Object(O.i)(e))return 0;switch(e.type){case"partial":return Object.keys(e.diff).length;case"complete":return Math.max(Object.keys(e.oldValue).length,Object.keys(e.newValue).length);case"collection":return Object.keys(e.added).length+Object.keys(e.changed).length+Object.keys(e.removed).length}}(a))return i.setLayoutProperties(t.layer,t.layout),3===r.type&&e._vectorTileContainer.restartDeclutter(),void e._vectorTileContainer.requestRender();e._styleChanges.push({type:1,data:t}),e.notifyChange("updating"),e.requestUpdate()}}})),this.layer.on("style-layer-visibility-change",(function(t){var i=e._styleRepository,r=i.getLayerById(t.layer);r&&(i.setStyleLayerVisibility(t.layer,t.visibility),3===r.type&&e._vectorTileContainer.restartDeclutter(),e._vectorTileContainer.requestRender())})),this.layer.on("style-layer-change",(function(t){e._styleChanges.push({type:2,data:t}),e.notifyChange("updating"),e.requestUpdate()})),this.layer.on("delete-style-layer",(function(t){e._styleChanges.push({type:3,data:t}),e.notifyChange("updating"),e.requestUpdate()})),this.layer.on("load-style",(function(){return e._loadStyle()}))])}},{key:"detach",value:function(){this._stop(),this._handles.removeAll()}},{key:"moveStart",value:function(){this.requestUpdate()}},{key:"viewChange",value:function(){this.requestUpdate()}},{key:"moveEnd",value:function(){this._collisionBoxesDisplay&&this._vectorTileContainer.restartDeclutter(),this.requestUpdate()}},{key:"canResume",value:function(){var e=Object(u.a)(Object(f.a)(i.prototype),"canResume",this).call(this),t=this.layer;if(e&&t.currentStyleInfo){var r=this.view.scale,a=t.currentStyleInfo;if(a&&a.layerDefinition){var n=a.layerDefinition;n.minScale&&n.minScale<r&&(e=!1),n.maxScale&&n.maxScale>r&&(e=!1)}}return e}},{key:"isUpdating",value:function(){var e=this._vectorTileContainer.children;return!this._isTileHandlerReady||!this._fetchQueue||!this._parseQueue||this._fetchQueue.updating||this._parseQueue.updating||e.length>0&&e.filter((function(e){return e.invalidating})).length>0||this.fading}},{key:"acquireTile",value:function(e){var t=this,i=this._createVectorTile(e);return this._tileHandlerPromise.then((function(){t._fetchQueue.push(i.key).then((function(e){return t._parseQueue.push({key:i.key,data:e})})).then((function(e){i.once("attach",(function(){return t.requestUpdate()})),e&&(i.setData(e.tileData),t.requestUpdate(),t.notifyChange("updating"))})).catch((function(e){t.notifyChange("updating"),Object(x.m)(e)||Ge.error(e)}))})),i}},{key:"releaseTile",value:function(e){var t=e.key.id;this._fetchQueue.abort(t),this._parseQueue.abort(t),this.requestUpdate()}},{key:"_start",value:function(){var e=this;if(this._stop(),this._tileManager=new re({acquireTile:function(t){return e.acquireTile(t)},releaseTile:function(t){return e.releaseTile(t)},tileInfoView:this._tileInfoView},this._vectorTileContainer),this.layer.currentStyleInfo){var t=new AbortController,i=this._tileHandler.start({signal:t.signal}).then((function(){e._fetchQueue=new He.a({tileInfoView:e._tileInfoView,process:function(t,i){return e._getTileData(t,i)},concurrency:15}),e._parseQueue=new He.a({tileInfoView:e._tileInfoView,process:function(t,i){return e._parseTileData(t,i)},concurrency:8}),e.requestUpdate(),e._isTileHandlerReady=!0}));this._tileHandler.spriteMosaic.then((function(t){e._vectorTileContainer.setStyleResources(t,e._tileHandler.glyphMosaic,e._styleRepository),e.requestUpdate()})),this._tileHandlerAbortController=t,this._tileHandlerPromise=i}}},{key:"_stop",value:function(){if(this._tileHandlerAbortController&&this._vectorTileContainer){var e=this._tileHandlerAbortController;e&&e.abort(),this._tileHandlerPromise=null,this._isTileHandlerReady=!1,this._fetchQueue&&(this._fetchQueue.destroy(),this._fetchQueue=null),this._parseQueue&&(this._parseQueue.destroy(),this._parseQueue=null),this._tileManager&&(this._tileManager.destroy(),this._tileManager=null),this._vectorTileContainer.removeAllChildren()}}},{key:"_getTileData",value:function(){var e=Object(l.a)(o.a.mark((function e(t,i){var r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._tileHandler.fetchTileData(t,i);case 2:return r=e.sent,e.abrupt("return",(this.notifyChange("updating"),r));case 4:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"_parseTileData",value:function(){var e=Object(l.a)(o.a.mark((function e(t,i){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._tileHandler.parseTileData(t,i));case 1:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"_applyStyleChanges",value:function(){var e=Object(l.a)(o.a.mark((function e(){var t,i,r,a,s,l,h,c,u,f,y,d,v=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._isTileHandlerReady=!1,this._fetchQueue.pause(),this._parseQueue.pause(),this._fetchQueue.clear(),this._parseQueue.clear(),this._tileManager.clearCache(),t=this._styleChanges,e.prev=2,e.next=5,this._tileHandler.updateStyle(t);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),Ge.error("error applying vector-tiles style update",e.t0.message),this._fetchQueue.resume(),this._parseQueue.resume(),this._isTileHandlerReady=!0;case 10:if(i=this._styleRepository,r=[],t.forEach((function(e){if(3===e.type){var t=e.data,a=i.getLayerById(t.layer);a&&r.push(a.uid)}})),a=[],t.forEach((function(e){var t=e.type,r=e.data;switch(t){case 0:i.setPaintProperties(r.layer,r.paint),s=r.layer;break;case 1:i.setLayoutProperties(r.layer,r.layout),s=r.layer;break;case 3:return void i.deleteStyleLayer(r.layer);case 2:i.setStyleLayer(r.layer,r.index),s=r.layer.id}var n=i.getLayerById(s);n&&a.push(n.uid)})),l=this._vectorTileContainer.children,r.length>0){this._vectorTileContainer.deleteStyleLayers(r),h=Object(n.a)(l);try{for(h.s();!(c=h.n()).done;)c.value.deleteLayerData(r)}catch(o){h.e(o)}finally{h.f()}}if(this._fetchQueue.resume(),this._parseQueue.resume(),!(a.length>0)){e.next=22;break}u=[],f=Object(n.a)(l);try{for(d=function(){var e=y.value,t=v._fetchQueue.push(e.key).then((function(t){return v._parseQueue.push({key:e.key,data:t,styleLayerUIDs:a})})).then((function(t){return e.setData(t.tileData)}));u.push(t)},f.s();!(y=f.n()).done;)d()}catch(o){f.e(o)}finally{f.f()}return e.next=22,Promise.all(u);case 22:this._styleChanges=[],this._isTileHandlerReady=!0,this.notifyChange("updating"),this.requestUpdate();case 23:case"end":return e.stop()}}),e,this,[[2,7]])})));return function(){return e.apply(this,arguments)}}()},{key:"_loadStyle",value:function(){var e=Object(l.a)(o.a.mark((function e(){var t,i,r,a,n,s,l;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.currentStyleInfo,i=t.style,r=t.spriteUrl,a=t.glyphsUrl,n=Object(g.a)(i),this._isTileHandlerReady=!1,this._fetchQueue.pause(),this._parseQueue.pause(),this._fetchQueue.clear(),this._parseQueue.clear(),this.notifyChange("updating"),this._styleRepository=new De.a(n,{spriteUrl:r,glyphsUrl:a}),this._vectorTileContainer.destroy(),this._tileManager.clear(),this._tileHandlerAbortController.abort(),this._tileHandlerAbortController=Object(x.d)(),s=this._tileHandlerAbortController.signal,e.prev=3,this._tileHandlerPromise=this._tileHandler.setStyle(this._styleRepository,n),e.next=7,this._tileHandlerPromise;case 7:e.next=13;break;case 9:if(e.prev=9,e.t0=e.catch(3),Object(x.m)(e.t0)){e.next=13;break}throw e.t0;case 13:if(!s.aborted){e.next=15;break}return e.abrupt("return",(this._fetchQueue.resume(),this._parseQueue.resume(),this._isTileHandlerReady=!0,this.notifyChange("updating"),void this.requestUpdate()));case 15:return e.next=17,this._tileHandler.spriteMosaic;case 17:l=e.sent,this._vectorTileContainer.setStyleResources(l,this._tileHandler.glyphMosaic,this._styleRepository),this._fetchQueue.resume(),this._parseQueue.resume(),this._isTileHandlerReady=!0,this.notifyChange("updating"),this.requestUpdate();case 19:case"end":return e.stop()}}),e,this,[[3,9]])})));return function(){return e.apply(this,arguments)}}()},{key:"_createVectorTile",value:function(e){var t=this._tileInfoView.getTileBounds(Object(C.h)(),e);return new ge(e,t[0],t[3],512,512,this._styleRepository)}},{key:"_renderCollisionBoxes",value:function(e){var t,i=Object(n.a)(this._vectorTileContainer.children);try{for(i.s();!(t=i.n()).done;){var s=t.value;if(s.symbols){var o,l=[],h=Object(n.a)(s.symbols);try{for(h.s();!(o=h.n()).done;){var c=Object(a.a)(o.value,2),u=(c[0],c[1]);l.push.apply(l,Object(r.a)(u))}}catch(f){h.e(f)}finally{h.f()}J(e,l)}}}catch(f){i.e(f)}finally{i.f()}}}]),i}(Object(Ve.a)(qe.a));Object(v.a)([Object(j.b)()],Ne.prototype,"_fetchQueue",void 0),Object(v.a)([Object(j.b)()],Ne.prototype,"_parseQueue",void 0),Object(v.a)([Object(j.b)()],Ne.prototype,"_isTileHandlerReady",void 0),Object(v.a)([Object(j.b)()],Ne.prototype,"suspended",void 0),Object(v.a)([Object(j.b)()],Ne.prototype,"fading",void 0),Object(v.a)([Object(j.b)()],Ne.prototype,"updating",void 0);var Xe=Ne=Object(v.a)([Object(P.a)("esri.views.2d.layers.VectorTileLayerView2D")],Ne)},639:function(e,t,i){"use strict";i.d(t,"a",(function(){return x})),i.d(t,"b",(function(){return O})),i.d(t,"c",(function(){return h})),i.d(t,"d",(function(){return d})),i.d(t,"e",(function(){return _})),i.d(t,"f",(function(){return g})),i.d(t,"g",(function(){return b})),i.d(t,"h",(function(){return v})),i.d(t,"i",(function(){return p})),i.d(t,"j",(function(){return m}));var r=i(2),a=i(4),n=i(13),s=i(23),o=i(73),l=i(652);function h(e){var t,i=Object(s.a)(e);return(t=i)&&(Object(o.g)(t)?y(t.rings):Object(o.h)(t)?y(t.paths):Object(o.e)(t)&&f(t.points)),i}function c(e){if(e)for(var t=e.length-1;t>0;--t)e[t][0]-=e[t-1][0],e[t][1]-=e[t-1][1]}function u(e){if(e){var t,i=Object(n.a)(e);try{for(i.s();!(t=i.n()).done;){c(t.value)}}catch(r){i.e(r)}finally{i.f()}}}function f(e){if(e)for(var t=e.length,i=1;i<t;++i)e[i][0]+=e[i-1][0],e[i][1]+=e[i-1][1]}function y(e){if(e){var t,i=Object(n.a)(e);try{for(i.s();!(t=i.n()).done;){f(t.value)}}catch(r){i.e(r)}finally{i.f()}}}function d(e){e&&(Object(o.g)(e)?u(e.rings):Object(o.h)(e)?u(e.paths):Object(o.e)(e)&&c(e.points))}function v(e){if(e){var t,i=Object(n.a)(e);try{for(i.s();!(t=i.n()).done;){p(t.value)}}catch(r){i.e(r)}finally{i.f()}}}function p(e){e&&e.reverse()}function _(e,t,i){return[e[0]+(t[0]-e[0])*i,e[1]+(t[1]-e[1])*i]}function b(e){return!(!e||0===e.length)&&e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]}function g(e){return e[4]}function m(e,t){e[4]=t}var O=function(){function e(t,i,a,n){Object(r.a)(this,e),this.acceptPolygon=i,this.acceptPolyline=a,this.geomUnitsPerPoint=n,this.pathCount=-1,this.pathIndex=-1,this.iteratePath=!1,t&&(Object(o.g)(t)?i&&(this.multiPath=t.rings,this.isClosed=!0):Object(o.h)(t)?a&&(this.multiPath=t.paths,this.isClosed=!1):Object(o.d)(t)&&i&&(this.multiPath=k(t).rings,this.isClosed=!0),this.multiPath&&(this.pathCount=this.multiPath.length)),this.internalPlacement=new l.a}return Object(a.a)(e,[{key:"next",value:function(){if(!this.multiPath)return null;for(;this.iteratePath||this.pathIndex<this.pathCount-1;){this.iteratePath||this.pathIndex++;var e=this.processPath(this.multiPath[this.pathIndex]);if(e)return e}return this.pathCount=-1,this.pathIndex=-1,this.multiPath=null,null}}]),e}(),x=function(){function e(t,i,a,n){Object(r.a)(this,e),this.inputGeometries=t,this.acceptPolygon=i,this.acceptPolyline=a,this.geomUnitsPerPoint=n,this.pathCount=-1,this.pathIndex=-1,this.iteratePath=!1}return Object(a.a)(e,[{key:"next",value:function(){for(;;){if(!this.multiPath){for(var e=this.inputGeometries.next();e;){if(Object(o.g)(e)?this.acceptPolygon&&(this.multiPath=e.rings,this.isClosed=!0):Object(o.h)(e)?this.acceptPolyline&&(this.multiPath=e.paths,this.isClosed=!1):Object(o.d)(e)&&this.acceptPolygon&&(this.multiPath=k(e).rings,this.isClosed=!0),this.multiPath){this.pathCount=this.multiPath.length,this.pathIndex=-1;break}e=this.inputGeometries.next()}if(!this.multiPath)return null}for(;this.iteratePath||this.pathIndex<this.pathCount-1;){this.iteratePath||this.pathIndex++;var t=this.processPath(this.multiPath[this.pathIndex]);if(t)return t}this.pathCount=-1,this.pathIndex=-1,this.multiPath=null}}}]),e}();function k(e){return{rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]}}},652:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i(2),a=i(4),n=function(){function e(){Object(r.a)(this,e),this.setIdentity()}return Object(a.a)(e,[{key:"getAngle",value:function(){return(null==this.rz||0===this.rz&&1!==this.rz_c&&0!==this.rz_s)&&(this.rz=Math.atan2(this.rz_s,this.rz_c)),this.rz}},{key:"setIdentity",value:function(){this.tx=0,this.ty=0,this.tz=0,this.s=1,this.rx=0,this.ry=0,this.rz=0,this.rz_c=1,this.rz_s=0}},{key:"setTranslate",value:function(e,t){this.tx=e,this.ty=t}},{key:"setTranslateZ",value:function(e){this.tz=e}},{key:"setRotateCS",value:function(e,t){this.rz=void 0,this.rz_c=e,this.rz_s=t}},{key:"setRotate",value:function(e){this.rz=e,this.rz_c=void 0,this.rz_s=void 0}},{key:"setRotateY",value:function(e){this.ry=e}},{key:"setScale",value:function(e){this.s=e}},{key:"setMeasure",value:function(e){this.m=e}}]),e}()},660:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i(2),a=i(4),n=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Object(r.a)(this,e),this.x=t,this.y=i,this.width=a,this.height=n}return Object(a.a)(e,[{key:"isEmpty",get:function(){return this.width<=0||this.height<=0}},{key:"union",value:function(e){this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.width=Math.max(this.width,e.width),this.height=Math.max(this.height,e.height)}}]),e}()},662:function(e,t,i){"use strict";i.d(t,"a",(function(){return L})),i.d(t,"b",(function(){return A})),i.d(t,"c",(function(){return R}));var r=i(29),a=i(12),n=i(13),s=i(2),o=i(4),l=i(35),h=i(15),c=i(63),u=i(652),f=i(6),y=i(7),d=i(94),v=i(320),p=i(73),_=i(676),b=i(663),g=i(660),m=Math.PI/180,O=h.a.getLogger("esri.symbols.cim.CIMSymbolDrawHelper"),x=function(){function e(t){Object(s.a)(this,e),this._t=t}return Object(o.a)(e,[{key:"clone",value:function(){return new e(this._t.slice())}},{key:"transform",value:function(e){var t=this._t;return[t[0]*e[0]+t[1]*e[1]+t[2],t[3]*e[0]+t[4]*e[1]+t[5]]}},{key:"scale",value:function(e,t){var i=this._t;return i[0]*=e,i[1]*=e,i[2]*=e,i[3]*=t,i[4]*=t,i[5]*=t,this}},{key:"scaleRatio",value:function(){return Math.sqrt(this._t[0]*this._t[0]+this._t[1]*this._t[1])}},{key:"translate",value:function(e,t){var i=this._t;return i[2]+=e,i[5]+=t,this}},{key:"rotate",value:function(t){return this.multiply(e.createRotate(t))}},{key:"multiply",value:function(e){var t=this._t,i=e._t,r=t[0]*i[0]+t[3]*i[1],a=t[1]*i[0]+t[4]*i[1],n=t[2]*i[0]+t[5]*i[1]+i[2],s=t[0]*i[3]+t[3]*i[4],o=t[1]*i[3]+t[4]*i[4],l=t[2]*i[3]+t[5]*i[4]+i[5];return t[0]=r,t[1]=a,t[2]=n,t[3]=s,t[4]=o,t[5]=l,this}}],[{key:"createIdentity",value:function(){return new e([1,0,0,0,1,0])}},{key:"createScale",value:function(t,i){return new e([t,0,0,0,i,0])}},{key:"createTranslate",value:function(t,i){return new e([0,0,t,0,0,i])}},{key:"createRotate",value:function(t){var i=Math.cos(t),r=Math.sin(t);return new e([i,-r,0,r,i,0])}}]),e}(),k=function(){function e(t){Object(s.a)(this,e),this._transfos=[],this._sizeTransfos=[],this._transfos.push(t||x.createIdentity()),this._sizeTransfos.push(t?t.scaleRatio():1)}return Object(o.a)(e,[{key:"transformPt",value:function(e){return this._transfos[this._transfos.length-1].transform(e)}},{key:"transformSize",value:function(e){return e*this._sizeTransfos[this._sizeTransfos.length-1]}},{key:"back",value:function(){return this._transfos[this._transfos.length-1]}},{key:"push",value:function(e,t){var i=t?e.scaleRatio():1;e.multiply(this.back()),this._transfos.push(e),this._sizeTransfos.push(this._sizeTransfos[this._sizeTransfos.length-1]*i)}},{key:"pop",value:function(){this._transfos.splice(-1,1),this._sizeTransfos.splice(-1,1)}},{key:"drawSymbol",value:function(e,t){if(e)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":this.drawMultiLayerSymbol(e,t)}}},{key:"drawMultiLayerSymbol",value:function(e,t){if(e){var i=e.symbolLayers;if(i){var r=e.effects;if(r){var a=this.executeEffects(r,t);if(a)for(var n=a.next();n;)this.drawSymbolLayers(i,n),n=a.next()}else this.drawSymbolLayers(i,t)}}}},{key:"executeEffects",value:function(e,t){var i,r=new _.a(t),a=Object(n.a)(e);try{for(a.s();!(i=a.n()).done;){var s=i.value,o=Object(b.a)(s);o&&(r=o.execute(r,s,1))}}catch(l){a.e(l)}finally{a.f()}return r}},{key:"drawSymbolLayers",value:function(e,t){for(var i=e.length;i--;){var r=e[i];if(r&&!1!==r.enable){var a=r.effects;if(a){var n=this.executeEffects(a,t);if(n)for(var s=n.next();s;)this.drawSymbolLayer(r,s),s=n.next()}else this.drawSymbolLayer(r,t)}}}},{key:"drawSymbolLayer",value:function(e,t){switch(e.type){case"CIMSolidFill":this.drawSolidFill(t,e.color);break;case"CIMHatchFill":this.drawHatchFill(e,t);break;case"CIMSolidStroke":this.drawSolidStroke(t,e.color,e.width,e.capStyle,e.joinStyle,e.miterLimit);break;case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":this.drawMarkerLayer(e,t)}}},{key:"drawHatchFill",value:function(e,t){var i=this._buildHatchPolyline(e,t,1);i&&(this.pushClipPath(t),this.drawMultiLayerSymbol(e.lineSymbol,i),this.popClipPath())}},{key:"drawMarkerLayer",value:function(e,t){var i=e.markerPlacement;if(i){var r=Object(b.b)(i);if(r){var a="CIMMarkerPlacementInsidePolygon"===i.type;a&&this.pushClipPath(t);var n=r.execute(t,i,1);if(n)for(var s=n.next();s;)this.drawMarker(e,s),s=n.next();a&&this.popClipPath()}}else{var o=new u.a;o.tx=t.x,o.ty=t.y,this.drawMarker(e,o)}}},{key:"drawMarker",value:function(e,t){switch(e.type){case"CIMCharacterMarker":case"CIMPictureMarker":this.drawPictureMarker(e,t);break;case"CIMVectorMarker":this.drawVectorMarker(e,t)}}},{key:"drawPictureMarker",value:function(e,t){if(e){var i=e.size||10,r=x.createIdentity(),a=e.anchorPoint;if(a){var n=a.x,s=a.y;"Absolute"!==e.anchorPointUnits&&(n*=i,s*=i),r.translate(-n,-s)}e.rotation&&r.rotate(e.rotation*m),r.translate(e.offsetX||0,e.offsetY||0),r.translate(t.tx,t.ty),this.push(r,!1),this.drawImage(e.url,i,e.scaleX),this.pop()}}},{key:"drawVectorMarker",value:function(e,t){if(e){var i=e.markerGraphics;if(i){var r=e.size,a=e.frame,s=a?a.ymax-a.ymin:0,o=r&&s?r/s:1,l=x.createIdentity();a&&l.translate(.5*-(a.xmax+a.xmin),.5*-(a.ymax+a.ymin));var h=e.anchorPoint;if(h){var c=h.x,u=h.y;"Absolute"!==e.anchorPointUnits?a&&(c*=a.xmax-a.xmin,u*=a.ymax-a.ymin):(c/=o,u/=o),l.translate(-c,-u)}1!==o&&l.scale(o,o),e.rotation&&l.rotate(e.rotation*m),l.translate(e.offsetX||0,e.offsetY||0),l.translate(t.tx,t.ty),this.push(l,e.scaleSymbolsProportionally);var f,y=Object(n.a)(i);try{for(y.s();!(f=y.n()).done;){var d=f.value;d&&d.symbol&&d.geometry||O.error("Invalid marker graphic",d),this.drawSymbol(d.symbol,d.geometry)}}catch(v){y.e(v)}finally{y.f()}this.pop()}}}},{key:"_buildHatchPolyline",value:function(e,t,i){var r=(void 0!==e.separation?e.separation:4)*i,a=void 0!==e.rotation?e.rotation:0;if(0===r)return null;r<0&&(r=-r);for(var n=0,s=.5*r;n>s;)n-=r;for(;n<-s;)n+=r;var o=Object(d.h)();Object(v.a)(o,t),o[0]-=s,o[1]-=s,o[2]+=s,o[3]+=s;for(var l=[[o[0],o[1]],[o[0],o[3]],[o[2],o[3]],[o[2],o[1]]];a>180;)a-=180;for(;a<0;)a+=180;var h,c,u,f,y=Math.cos(a*m),p=Math.sin(a*m),_=-r*p,b=r*y;n=(void 0!==e.offsetX?e.offsetX*i:0)*p-(void 0!==e.offsetY?e.offsetY*i:0)*y,h=u=Number.MAX_VALUE,c=f=-Number.MAX_VALUE;for(var g=0,O=l;g<O.length;g++){var x=O[g],k=x[0],j=x[1],w=y*k+p*j,P=-p*k+y*j;h=Math.min(h,w),u=Math.min(u,P),c=Math.max(c,w),f=Math.max(f,P)}for(var S=y*h-p*(u=Math.floor(u/r)*r)-_*n/r,C=p*h+y*u-b*n/r,M=y*c-p*u-_*n/r,I=p*c+y*u-b*n/r,T=1+Math.round((f-u)/r),L=[],R=0;R<T;R++)S+=_,C+=b,M+=_,I+=b,L.push([[S,C],[M,I]]);return{paths:L}}}]),e}(),j=function(e){Object(f.a)(i,e);var t=Object(y.a)(i);function i(){var e;return Object(s.a)(this,i),(e=t.call(this)).reset(),e}return Object(o.a)(i,[{key:"reset",value:function(){this._xmin=this._ymin=1/0,this._xmax=this._ymax=-1/0,this._clipCount=0}},{key:"envelope",value:function(){return new g.a(this._xmin,this._ymin,this._xmax-this._xmin,this._ymax-this._ymin)}},{key:"drawSolidFill",value:function(e){if(e&&!(this._clipCount>0))if(Object(p.g)(e))this._processPath(e.rings,0);else if(Object(p.h)(e))this._processPath(e.paths,0);else if(Object(p.d)(e)){var t=P(e);t&&this._processPath(t.rings,0)}}},{key:"drawSolidStroke",value:function(e,t,i){if(e&&!(this._clipCount>0)){var r=.5*this.transformSize(i);if(Object(p.g)(e))this._processPath(e.rings,r);else if(Object(p.h)(e))this._processPath(e.paths,r);else if(Object(p.d)(e)){var a=P(e);a&&this._processPath(a.rings,r)}}}},{key:"pushClipPath",value:function(e){this.drawSolidFill(e),++this._clipCount}},{key:"popClipPath",value:function(){--this._clipCount}},{key:"drawImage",value:function(e,t,i){var r=t/2;this._merge(this.transformPt([0,0]),r)}},{key:"_processPath",value:function(e,t){if(e){var i,r=Object(n.a)(e);try{for(r.s();!(i=r.n()).done;){var a=i.value,s=a?a.length:0;if(s>1){this._merge(this.transformPt(a[0]),t);for(var o=1;o<s;++o)this._merge(this.transformPt(a[o]),t)}}}catch(l){r.e(l)}finally{r.f()}}}},{key:"_merge",value:function(e,t){e[0]-t<this._xmin&&(this._xmin=e[0]-t),e[0]+t>this._xmax&&(this._xmax=e[0]+t),e[1]-t<this._ymin&&(this._ymin=e[1]-t),e[1]+t>this._ymax&&(this._ymax=e[1]+t)}}]),i}(k),w=function(e){Object(f.a)(i,e);var t=Object(y.a)(i);function i(e,r){var a;return Object(s.a)(this,i),(a=t.call(this,r))._ctx=e,a}return Object(o.a)(i,[{key:"drawSolidFill",value:function(e,t){if(e){if(Object(p.g)(e))this._buildPath(e.rings,!0);else if(Object(p.h)(e))this._buildPath(e.paths,!0);else{if(!Object(p.d)(e))return;this._buildPath(P(e).rings,!0)}var i=this._ctx;i.fillStyle="string"==typeof t?t:"rgba("+Math.round(t[0])+","+Math.round(t[1])+","+Math.round(t[2])+","+t[3]/255+")",i.fill("evenodd")}}},{key:"drawSolidStroke",value:function(e,t,i,r,a,n){if(e&&t&&0!==i){if(Object(p.g)(e))this._buildPath(e.rings,!0);else if(Object(p.h)(e))this._buildPath(e.paths,!1);else{if(!Object(p.d)(e))return;this._buildPath(P(e).rings,!0)}var s=this._ctx;s.strokeStyle="string"==typeof t?t:"rgba("+Math.round(t[0])+","+Math.round(t[1])+","+Math.round(t[2])+","+t[3]/255+")",s.lineWidth=this.transformSize(i)+.5,this._setCapStyle(r),this._setJoinStyle(a),s.miterLimit=n,s.stroke()}}},{key:"pushClipPath",value:function(e){if(this._ctx.save(),Object(p.g)(e))this._buildPath(e.rings,!0);else if(Object(p.h)(e))this._buildPath(e.paths,!0);else{if(!Object(p.d)(e))return;this._buildPath(P(e).rings,!0)}this._ctx.clip("evenodd")}},{key:"popClipPath",value:function(){this._ctx.restore()}},{key:"drawImage",value:function(e,t,i){}},{key:"_buildPath",value:function(e,t){var i=this._ctx;if(i.beginPath(),e){var r,a=Object(n.a)(e);try{for(a.s();!(r=a.n()).done;){var s=r.value,o=s?s.length:0;if(o>1){var l=this.transformPt(s[0]);i.moveTo(l[0],l[1]);for(var h=1;h<o;++h)l=this.transformPt(s[h]),i.lineTo(l[0],l[1]);t&&i.closePath()}}}catch(c){a.e(c)}finally{a.f()}}}},{key:"_setCapStyle",value:function(e){switch(e){case"Butt":this._ctx.lineCap="butt";break;case"Round":this._ctx.lineCap="round";break;case"Square":this._ctx.lineCap="square"}}},{key:"_setJoinStyle",value:function(e){switch(e){case"Bevel":this._ctx.lineJoin="bevel";break;case"Round":this._ctx.lineJoin="round";break;case"Miter":this._ctx.lineJoin="miter"}}}]),i}(k),P=function(e){return e?{spatialReference:e.spatialReference,rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]}:null},S=i(677),C=Math.PI,M=C/2,I=h.a.getLogger("esri.symbols.cim.CIMSymbolHelper");function T(e,t){switch(t.type){case"CIMSymbolReference":e.drawSymbol(t.symbol,{type:"point",x:0,y:0});break;case"CIMPointSymbol":e.drawSymbol(t,{type:"point",x:0,y:0});break;case"CIMTextSymbol":break;case"CIMVectorMarker":var i=new u.a;e.drawMarker(t,i)}return e.envelope()}var L=function(){function e(){Object(s.a)(this,e)}return Object(o.a)(e,null,[{key:"getEnvelope",value:function(e){var t=new j;if(Array.isArray(e)){var i,r,a=Object(n.a)(e);try{for(a.s();!(r=a.n()).done;){var s=r.value;i?i.union(T(t,s)):i=T(t,s)}}catch(o){a.e(o)}finally{a.f()}return i}return T(t,e)}},{key:"getTextureAnchor",value:function(e){var t=this.getEnvelope(e);if(!t||t.width<=0||t.height<=0)return[0,0,0];var i=96/72,r=(t.x+.5*t.width)*i,a=-(t.y+.5*t.height)*i,n=t.width*i+2,s=t.height*i+2;return[r/n,a/s,s]}},{key:"rasterize",value:function(e,t,i){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=i||this.getEnvelope(t);if(!a||a.width<=0||a.height<=0)return[null,0,0,0,0];var n=96/72,s=(a.x+.5*a.width)*n,o=(a.y+.5*a.height)*n;e.width=a.width*n,e.height=a.height*n,i||(e.width+=2,e.height+=2);var l=e.getContext("2d"),h=x.createScale(n,-n);h.translate(.5*e.width-s,.5*e.height+o);var c=new w(l,h);switch(t.type){case"CIMPointSymbol":var f={type:"point",x:0,y:0};c.drawSymbol(t,f);break;case"CIMVectorMarker":var y=new u.a;c.drawMarker(t,y)}var d=l.getImageData(0,0,e.width,e.height),v=new Uint8Array(d.data);if(r)for(var p,_=0;_<v.length;_+=4)p=v[_+3]/255,v[_]=v[_]*p,v[_+1]=v[_+1]*p,v[_+2]=v[_+2]*p;return[v,e.width,e.height,-s/e.width,-o/e.height]}},{key:"fromSimpleMarker",value:function(e){var t,i,r,a=50,n=e.style;if("circle"===n||"esriSMSCircle"===n){var s=Math.acos(.995),o=Math.ceil(C/s/4);0===o&&(o=1),s=M/o,o*=4;var l=[];l.push([a,0]);for(var h=1;h<o;h++)l.push([a*Math.cos(h*s),-a*Math.sin(h*s)]);l.push([a,0]),t={rings:[l]},i={xmin:-a,ymin:-a,xmax:a,ymax:a}}else if("cross"===n||"esriSMSCross"===n){t={rings:[[[0,a],[0,0],[a,0],[a,-0],[0,-0],[0,-a],[-0,-a],[-0,-0],[-a,-0],[-a,0],[-0,0],[-0,a],[0,a]]]},i={xmin:-a,ymin:-a,xmax:a,ymax:a}}else if("diamond"===n||"esriSMSDiamond"===n)t={rings:[[[-a,0],[0,a],[a,0],[0,-a],[-a,0]]]},i={xmin:-a,ymin:-a,xmax:a,ymax:a};else if("square"===n||"esriSMSSquare"===n)t={rings:[[[-a,-a],[-a,a],[a,a],[a,-a],[-a,-a]]]},i={xmin:-a,ymin:-a,xmax:a,ymax:a};else if("x"===n||"esriSMSX"===n){t={rings:[[[0,0],[50,a],[a,50],[0,0],[a,-50],[50,-a],[0,-0],[-50,-a],[-a,-50],[-0,0],[-a,50],[-50,a],[0,0]]]},i={xmin:-a,ymin:-a,xmax:a,ymax:a}}else if("triangle"===n||"esriSMSTriangle"===n){var c=57.735026918962575,u=-c,f=2/3*100,y=f-100;t={rings:[[[u,y],[0,f],[c,y],[u,y]]]},i={xmin:u,ymin:y,xmax:c,ymax:f}}else"arrow"!==n&&"esriSMSArrow"!==n||(t={rings:[[[-50,50],[50,0],[-50,-50],[-33,-20],[-33,20],[-50,50]]]},i={xmin:-a,ymin:-a,xmax:a,ymax:a});if(t&&i){var d=[{type:"CIMSolidFill",enable:!0,color:e.color}];e.outline&&d.push({type:"CIMSolidStroke",enable:!0,width:e.outline.width,color:e.outline.color});var v={type:"CIMPolygonSymbol",symbolLayers:d};r={type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:e.angle,size:e.size,offsetX:e.xoffset,offsetY:e.yoffset,frame:i,markerGraphics:[{type:"CIMMarkerGraphic",geometry:t,symbol:v}]}]}}return r}},{key:"fromCIMHatchFill",value:function(e){for(var t=void 0!==e.separation?e.separation:4,i=t/2,r=this._getLineSymbolPeriod(e.lineSymbol)||4;r<4;)r*=2;var a=r/2;return{type:"CIMVectorMarker",frame:{xmin:-a,xmax:a,ymin:-i,ymax:i},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[-a,0],[a,0]]]},symbol:e.lineSymbol}],size:t}}},{key:"_getLineSymbolPeriod",value:function(e){if(e){var t=this._getEffectsRepeat(e.effects);if(t)return t;if(e.symbolLayers){var i,r=Object(n.a)(e.symbolLayers);try{for(r.s();!(i=r.n()).done;){var a=i.value,s=this._getEffectsRepeat(a.effects);if(s)return s;if(a){var o=this._getPlacementRepeat(a.markerPlacement);if(o)return o}}}catch(l){r.e(l)}finally{r.f()}}}return 0}},{key:"_getEffectsRepeat",value:function(e){if(e){var t,i=Object(n.a)(e);try{for(i.s();!(t=i.n()).done;){var r=t.value;if(r)switch(r.type){case"CIMGeometricEffectDashes":var a=r.dashTemplate;if(a&&a.length){var s,o=0,l=Object(n.a)(a);try{for(l.s();!(s=l.n()).done;){o+=s.value}}catch(h){l.e(h)}finally{l.f()}return 1&a.length&&(o*=2),o}break;case"CIMGeometricEffectWave":return r.period;default:I.error("unsupported geometric effect type ".concat(r.type))}}}catch(h){i.e(h)}finally{i.f()}}return 0}},{key:"_getPlacementRepeat",value:function(e){if(e)switch(e.type){case"CIMMarkerPlacementAlongLineSameSize":case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineVariableSize":var t=e.placementTemplate;if(t&&t.length){var i,r=0,a=Object(n.a)(t);try{for(a.s();!(i=a.n()).done;){r+=i.value}}catch(s){a.e(s)}finally{a.f()}return 1&t.length&&(r*=2),r}}return 0}},{key:"fromCIMInsidePolygon",value:function(e){var t,i,r,n,s=e.markerPlacement,o=Object(a.a)({type:e.type},e);return o.markerPlacement=null,o.anchorPoint=null,!0===s.shiftOddRows?(i=s.stepX/2,r=s.stepY,n=2*s.stepY,t=[{x:-i,y:0},{x:i,y:0},{x:0,y:r},{x:0,y:-r}].map((function(e){return{type:"CIMMarkerGraphic",geometry:e,symbol:{type:"CIMPointSymbol",symbolLayers:[o]}}}))):(i=s.stepX/2,r=s.stepY/2,n=s.stepY,t=[{type:"CIMMarkerGraphic",geometry:{x:0,y:0},symbol:{type:"CIMPointSymbol",symbolLayers:[o]}}]),{type:"CIMVectorMarker",frame:{xmin:-i,xmax:i,ymin:-r,ymax:r},markerGraphics:t,size:n}}},{key:"getFillColor",value:function(t){if(!t)return null;switch(t.type){case"CIMPolygonSymbol":if(t.symbolLayers){var i,r=Object(n.a)(t.symbolLayers);try{for(r.s();!(i=r.n()).done;){var a=i.value,s=e.getFillColor(a);if(null!=s)return s}}catch(o){r.e(o)}finally{r.f()}}break;case"CIMTextSymbol":return e.getFillColor(t.symbol);case"CIMSolidFill":return t.color}}},{key:"getStrokeColor",value:function(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(t.symbolLayers){var i,r=Object(n.a)(t.symbolLayers);try{for(r.s();!(i=r.n()).done;){var a=i.value,s=e.getStrokeColor(a);if(void 0!==s)return s}}catch(o){r.e(o)}finally{r.f()}}break;case"CIMTextSymbol":return e.getStrokeColor(t.symbol);case"CIMSolidStroke":return t.color}}},{key:"getStrokeWidth",value:function(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(t.symbolLayers){var i,r=Object(n.a)(t.symbolLayers);try{for(r.s();!(i=r.n()).done;){var a=i.value,s=e.getStrokeWidth(a);if(void 0!==s)return s}}catch(o){r.e(o)}finally{r.f()}}break;case"CIMTextSymbol":return e.getStrokeWidth(t.symbol);case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return t.width}}},{key:"getSize",value:function(t){if(t)switch(t.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":var i=0;if(t.symbolLayers){var r,a=Object(n.a)(t.symbolLayers);try{for(a.s();!(r=a.n()).done;){var s=r.value,o=e.getSize(s);o>i&&(i=o)}}catch(l){a.e(l)}finally{a.f()}}return i;case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":return t.width;case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":return t.size}}},{key:"getMarkerScaleRatio",value:function(e){if(e&&"CIMVectorMarker"===e.type&&!1!==e.scaleSymbolsProportionally&&e.frame){var t=e.frame.ymax-e.frame.ymin;return e.size/t}return 1}}]),e}(),R=function(){function e(){Object(s.a)(this,e)}return Object(o.a)(e,null,[{key:"rasterizeSimpleFill",value:function(e,t,i){"solid"!==t&&"none"!==t&&"esriSFSSolid"!==t&&"esriSFSNull"!==t||console.error("Unexpected: style does not require rasterization");var r=Object(c.o)(Math.ceil(i)),a=this._isHorizontalOrVertical(t)?8*r:16*r,n=2*r;e.width=a,e.height=a;var s=e.getContext("2d");s.strokeStyle="#FFFFFF",s.lineWidth=r,s.beginPath(),"vertical"!==t&&"cross"!==t&&"esriSFSCross"!==t&&"esriSFSVertical"!==t||(s.moveTo(a/2,-n),s.lineTo(a/2,a+n)),"horizontal"!==t&&"cross"!==t&&"esriSFSCross"!==t&&"esriSFSHorizontal"!==t||(s.moveTo(-n,a/2),s.lineTo(a+n,a/2)),"forward-diagonal"!==t&&"diagonal-cross"!==t&&"esriSFSDiagonalCross"!==t&&"esriSFSForwardDiagonal"!==t||(s.moveTo(-n,-n),s.lineTo(a+n,a+n),s.moveTo(a-n,-n),s.lineTo(a+n,n),s.moveTo(-n,a-n),s.lineTo(n,a+n)),"backward-diagonal"!==t&&"diagonal-cross"!==t&&"esriSFSBackwardDiagonal"!==t&&"esriSFSDiagonalCross"!==t||(s.moveTo(a+n,-n),s.lineTo(-n,a+n),s.moveTo(n,-n),s.lineTo(-n,n),s.moveTo(a+n,a-n),s.lineTo(a-n,a+n)),s.stroke();for(var o,l=s.getImageData(0,0,e.width,e.height),h=new Uint8Array(l.data),u=0;u<h.length;u+=4)o=h[u+3]/255,h[u]=h[u]*o,h[u+1]=h[u+1]*o,h[u+2]=h[u+2]*o;return[h,e.width,e.height]}},{key:"rasterizeSimpleLine",value:function(e,t){var i;switch(t){case"butt":i="Butt";break;case"square":i="Square";break;default:i="Round"}var r,a="Butt"===i;switch(e){case"dash":case"esriSLSDash":r=a?[4,3]:[3,4];break;case"dash-dot":case"esriSLSDashDot":r=a?[4,3,1,3]:[3,4,0,4];break;case"dot":case"esriSLSDot":r=a?[1,3]:[0,4];break;case"long-dash":case"esriSLSLongDash":r=a?[8,3]:[7,4];break;case"long-dash-dot":case"esriSLSLongDashDot":r=a?[8,3,1,3]:[7,4,0,4];break;case"long-dash-dot-dot":case"esriSLSDashDotDot":r=a?[8,3,1,3,1,3]:[7,4,0,4,0,4];break;case"short-dash":case"esriSLSShortDash":r=a?[4,1]:[3,2];break;case"short-dash-dot":case"esriSLSShortDashDot":r=a?[4,1,1,1]:[3,2,0,2];break;case"short-dash-dot-dot":case"esriSLSShortDashDotDot":r=a?[4,1,1,1,1,1]:[3,2,0,2,0,2];break;case"short-dot":case"esriSLSShortDot":r=a?[1,1]:[0,2];break;case"solid":case"esriSLSSolid":case"none":I.error("Unexpected: style does not require rasterization"),r=[0,0];break;default:I.error("Tried to rasterize SLS, but found an unexpected style: ".concat(e,"!")),r=[0,0]}return this.rasterizeDash(r,i)}},{key:"rasterizeDash",value:function(e,t){var i="Butt"===t,a="Square"===t,s=!i&&!a;e.length%2==1&&(e=[].concat(Object(r.a)(e),Object(r.a)(e)));var o,l=15.5,h=0,c=Object(n.a)(e);try{for(c.s();!(o=c.n()).done;){h+=o.value}}catch(M){c.e(M)}finally{c.f()}var u,f=Math.round(h*l),y=new Float32Array(31*f),d=7.75,v=0,p=0,_=.5,b=!0,g=Object(n.a)(e);try{for(g.s();!(u=g.n()).done;){var m=u.value;for(v=p,p+=m*l;_<=p;){for(var O=.5;O<31;){var x=(O-.5)*f+_-.5,k=s?(O-l)*(O-l):Math.abs(O-l);y[x]=b?i?Math.max(Math.max(v+d-_,k),Math.max(_-p+d,k)):k:s?Math.min((_-v)*(_-v)+k,(_-p)*(_-p)+k):a?Math.min(Math.max(_-v,k),Math.max(p-_,k)):Math.min(Math.max(_-v+d,k),Math.max(p+d-_,k)),O++}_++}b=!b}}catch(M){g.e(M)}finally{g.f()}for(var j=y.length,w=new Uint8Array(4*j),P=0;P<j;++P){var C=(s?Math.sqrt(y[P]):y[P])/l;Object(S.a)(C,w,4*P)}return[w,f,31]}},{key:"_isHorizontalOrVertical",value:function(e){return"vertical"===e||"horizontal"===e||"cross"===e||"esriSFSCross"===e||"esriSFSVertical"===e||"esriSFSHorizontal"===e}}]),e}(),A=function(){function e(){Object(s.a)(this,e)}return Object(o.a)(e,null,[{key:"findApplicableOverrides",value:function(t,i,r){if(i){if(t.primitiveName){var a,s=!1,o=Object(n.a)(r);try{for(o.s();!(a=o.n()).done;){if(a.value.primitiveName===t.primitiveName){s=!0;break}}}catch(k){o.e(k)}finally{o.f()}if(!s){var l,h=Object(n.a)(i);try{for(h.s();!(l=h.n()).done;){var c=l.value;c.primitiveName===t.primitiveName&&r.push(c)}}catch(k){h.e(k)}finally{h.f()}}}switch(t.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(t.effects){var u,f=Object(n.a)(t.effects);try{for(f.s();!(u=f.n()).done;){var y=u.value;e.findApplicableOverrides(y,i,r)}}catch(k){f.e(k)}finally{f.f()}}if(t.symbolLayers){var d,v=Object(n.a)(t.symbolLayers);try{for(v.s();!(d=v.n()).done;){var p=d.value;e.findApplicableOverrides(p,i,r)}}catch(k){v.e(k)}finally{v.f()}}break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":case"CIMSolidFill":case"CIMPictureFill":case"CIMHatchFill":case"CIMGradientFill":case"CIMVectorMarker":case"CIMCharacterMarker":case"CIMPictureMarker":if(t.effects){var _,b=Object(n.a)(t.effects);try{for(b.s();!(_=b.n()).done;){var g=_.value;e.findApplicableOverrides(g,i,r)}}catch(k){b.e(k)}finally{b.f()}}if(t.markerPlacement&&e.findApplicableOverrides(t.markerPlacement,i,r),"CIMVectorMarker"===t.type){if(t.markerGraphics){var m,O=Object(n.a)(t.markerGraphics);try{for(O.s();!(m=O.n()).done;){var x=m.value;e.findApplicableOverrides(x,i,r),e.findApplicableOverrides(x.symbol,i,r)}}catch(k){O.e(k)}finally{O.f()}}}else"CIMCharacterMarker"===t.type?e.findApplicableOverrides(t.symbol,i,r):"CIMHatchFill"===t.type&&e.findApplicableOverrides(t.lineSymbol,i,r)}}}},{key:"applyOverrides",value:function(t,i,r,a){if(i){var s=function(e){return e?e.charAt(0).toLowerCase()+e.substr(1):e};if(t.primitiveName){var o,l=Object(n.a)(i);try{for(l.s();!(o=l.n()).done;){var h=o.value;if(h.primitiveName===t.primitiveName){var c=s(h.propertyName);if(a&&a.push({cim:t,nocapPropertyName:c,value:t[c]}),h.expression&&(h.value=e.toValue(h.propertyName,h.expression)),r){var u,f=!1,y=Object(n.a)(r);try{for(y.s();!(u=y.n()).done;){u.value.primitiveName===t.primitiveName&&(f=!0)}}catch(P){y.e(P)}finally{y.f()}f||r.push(h)}t[c]=h.value}}}catch(P){l.e(P)}finally{l.f()}}switch(t.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(t.effects){var d,v=Object(n.a)(t.effects);try{for(v.s();!(d=v.n()).done;){var p=d.value;e.applyOverrides(p,i,r,a)}}catch(P){v.e(P)}finally{v.f()}}if(t.symbolLayers){var _,b=Object(n.a)(t.symbolLayers);try{for(b.s();!(_=b.n()).done;){var g=_.value;e.applyOverrides(g,i,r,a)}}catch(P){b.e(P)}finally{b.f()}}break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMSolidFill":case"CIMVectorMarker":if(t.effects){var m,O=Object(n.a)(t.effects);try{for(O.s();!(m=O.n()).done;){var x=m.value;e.applyOverrides(x,i,r,a)}}catch(P){O.e(P)}finally{O.f()}}if("CIMVectorMarker"===t.type&&t.markerGraphics){var k,j=Object(n.a)(t.markerGraphics);try{for(j.s();!(k=j.n()).done;){var w=k.value;e.applyOverrides(w,i,r,a),e.applyOverrides(w.symbol,i,r,a)}}catch(P){j.e(P)}finally{j.f()}}}}}},{key:"restoreOverrides",value:function(e){var t,i=Object(n.a)(e);try{for(i.s();!(t=i.n()).done;){var r=t.value;r.cim[r.nocapPropertyName]=r.value}}catch(a){i.e(a)}finally{i.f()}}},{key:"buildOverrideKey",value:function(e){var t,i="",r=Object(n.a)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;void 0!==a.value&&(i+="".concat(a.primitiveName).concat(a.propertyName).concat(JSON.stringify(a.value)))}}catch(s){r.e(s)}finally{r.f()}return i}},{key:"toValue",value:function(e,t){if("DashTemplate"===e)return t.split(" ").map((function(e){return Number(e)}));if("Color"===e){var i=new l.a(t).toRgba();return i[3]*=255,i}return t}}]),e}()},663:function(e,t,i){"use strict";i.d(t,"a",(function(){return fe})),i.d(t,"b",(function(){return ye}));var r=i(13),a=i(2),n=i(4),s=i(23),o=i(73),l=i(639),h=function(){function e(){Object(a.a)(this,e)}return Object(n.a)(e,[{key:"execute",value:function(e,t,i){return new c(e,t,i)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();h.instance=null;var c=function(){function e(t,i,r){Object(a.a)(this,e),this._inputGeometries=t,this._angleTolerance=void 0!==i.angleTolerance?i.angleTolerance:120,this._maxCosAngle=Math.cos((1-Math.abs(this._angleTolerance)/180)*Math.PI)}return Object(n.a)(e,[{key:"next",value:function(){for(var e=this._inputGeometries.next();e;){if(Object(o.g)(e)){this._isClosed=!0;var t=Object(s.a)(e);return this._processMultipath(t.rings),t}if(Object(o.h)(e)){this._isClosed=!1;var i=Object(s.a)(e);return this._processMultipath(i.paths),i}if(Object(o.d)(e)){if(this._maxCosAngle)return e;this._isClosed=!0;var r=[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]];return this._processPath(r),{rings:[r]}}e=this._inputGeometries.next()}return null}},{key:"_processMultipath",value:function(e){if(e){var t,i=Object(r.a)(e);try{for(i.s();!(t=i.n()).done;){var a=t.value;this._processPath(a)}}catch(n){i.e(n)}finally{i.f()}}}},{key:"_processPath",value:function(e){if(e){var t,i,r,a,n,s,o=e.length,h=e[0];this._isClosed&&++o;for(var c=1;c<o;++c){var u,f=(u=this._isClosed&&c===o-1?e[0]:e[c])[0]-h[0],y=u[1]-h[1],d=Math.sqrt(f*f+y*y);c>1&&d>0&&r>0&&(t*f+i*y)/d/r<=this._maxCosAngle&&Object(l.j)(h,1),1===c&&(a=f,n=y,s=d),d>0&&(h=u,t=f,i=y,r=d)}this._isClosed&&r>0&&s>0&&(t*a+i*n)/s/r<=this._maxCosAngle&&Object(l.j)(e[0],1)}}}]),e}(),u=i(6),f=i(7),y=.03,d=function(){function e(){Object(a.a)(this,e),this._path=[]}return Object(n.a)(e,[{key:"path",value:function(){return this._path}},{key:"addPath",value:function(e,t){t||e.reverse(),Array.prototype.push.apply(this._path,e),t||e.reverse()}},{key:"startPath",value:function(e){this._path.push(e)}},{key:"lineTo",value:function(e){this._path.push(e)}},{key:"close",value:function(){var e=this._path;e.length>1&&(e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]||e.push([e[0][0],e[0][1]]))}}],[{key:"mergePath",value:function(e,t){t&&Array.prototype.push.apply(e,t)}}]),e}(),v=function(){function e(){Object(a.a)(this,e)}return Object(n.a)(e,[{key:"normalize",value:function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]);e[0]/=t,e[1]/=t}},{key:"calculateLength",value:function(e,t){var i=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(i*i+r*r)}},{key:"calculateSegLength",value:function(e,t){return this.calculateLength(e[t],e[t+1])}},{key:"calculatePathLength",value:function(e){for(var t=0,i=e?e.length:0,r=0;r<i-1;++r)t+=this.calculateSegLength(e,r);return t}},{key:"calculatePathArea",value:function(e){for(var t=0,i=e?e.length:0,r=0;r<i-1;++r)t+=(e[r+1][0]-e[r][0])*(e[r+1][1]+e[r][1]);return t/2}},{key:"getCoord2D",value:function(e,t,i){return[e[0]+(t[0]-e[0])*i,e[1]+(t[1]-e[1])*i]}},{key:"getSegCoord2D",value:function(e,t,i){return this.getCoord2D(e[t],e[t+1],i)}},{key:"getAngle",value:function(e,t,i){var r=t[0]-e[0],a=t[1]-e[1];return Math.atan2(a,r)}},{key:"getSegAngle",value:function(e,t,i){return this.getAngle(e[t],e[t+1],i)}},{key:"getAngleCS",value:function(e,t,i){var r=t[0]-e[0],a=t[1]-e[1],n=Math.sqrt(r*r+a*a);return n>0?[r/n,a/n]:[1,0]}},{key:"getSegAngleCS",value:function(e,t,i){return this.getAngleCS(e[t],e[t+1],i)}},{key:"cut",value:function(e,t,i,r){return[i<=0?e[t]:this.getSegCoord2D(e,t,i),r>=1?e[t+1]:this.getSegCoord2D(e,t,r)]}},{key:"addSegment",value:function(e,t,i){i&&e.push(t[0]),e.push(t[1])}},{key:"getSubCurve",value:function(e,t,i){var r=[];return this.appendSubCurve(r,e,t,i)?r:null}},{key:"appendSubCurve",value:function(e,t,i,r){for(var a=t?t.length-1:0,n=0,s=!0,o=0;o<a;){var l=this.calculateSegLength(t,o);if(0!==l){if(s){if(n+l>i){var h=(i-n)/l,c=1,u=!1;n+l>=r&&(c=(r-n)/l,u=!0);var f=this.cut(t,o,h,c);if(f&&this.addSegment(e,f,s),u)break;s=!1}}else{if(n+l>r){var y=this.cut(t,o,0,(r-n)/l);y&&this.addSegment(e,y,s);break}this.addSegment(e,[t[o],t[o+1]],s)}n+=l,++o}else++o}return!0}},{key:"getCIMPointAlong",value:function(e,t){for(var i=e?e.length-1:0,r=0,a=-1;a<i;){++a;var n=this.calculateSegLength(e,a);if(0!==n){if(r+n>t){var s=(t-r)/n;return this.getCoord2D(e[a],e[a+1],s)}r+=n}}return null}},{key:"isEmpty",value:function(e,t){if(!e||e.length<=1)return!0;for(var i=e?e.length-1:0,r=-1;r<i;){if(e[++r+1][0]!==e[r][0]||e[r+1][1]!==e[r][1])return!1;if(t&&e[r+1][2]!==e[r][2])return!1}return!0}},{key:"offset",value:function(e,t,i,r,a){if(!e||e.length<2)return null;var n=e.length,s=e[0][0]===e[n-1][0]&&e[0][1]===e[n-1][1];if(s){if(e.length<3)return null;--n}for(var o=[],l=s?e[n-1]:null,h=e[0],c=0;c<n;c++){var u=c===n-1?s?e[0]:null:e[c+1];if(l)if(u){var f=[u[0]-h[0],u[1]-h[1]];this.normalize(f);var y=[h[0]-l[0],h[1]-l[1]];this.normalize(y);var d=y[0]*f[1]-y[1]*f[0],v=y[0]*f[0]+y[1]*f[1];if(d>=0==t<=0){var p=[f[0]-y[0],f[1]-y[1]];this.normalize(p);var _=Math.sqrt((1+v)/2);if(_>1/r){var b=-Math.abs(t)/_;o.push([h[0]-p[0]*b,h[1]-p[1]*b])}}else switch(i){case"Mitered":var g=Math.sqrt((1+v)/2);if(g>0&&1/g<r){var m=[f[0]-y[0],f[1]-y[1]];this.normalize(m);var O=Math.abs(t)/g;o.push([h[0]-m[0]*O,h[1]-m[1]*O]);break}case"Bevelled":o.push([h[0]+y[1]*t,h[1]-y[0]*t]),o.push([h[0]+f[1]*t,h[1]-f[0]*t]);break;case"Rounded":o.push([h[0]+y[1]*t,h[1]-y[0]*t]);for(var x=.2,k=1;k<5;k++,x+=.2){var j=[y[1]*(1-x)+f[1]*x,-y[0]*(1-x)-f[0]*x];this.normalize(j),o.push([h[0]+j[0]*t,h[1]+j[1]*t])}o.push([h[0]+f[1]*t,h[1]-f[0]*t]);break;default:if(d<0)o.push([h[0]+(y[1]+y[0])*t,h[1]+(y[1]-y[0])*t]),o.push([h[0]+(f[1]-f[0])*t,h[1]-(f[0]+f[1])*t]);else{var w=Math.sqrt((1+Math.abs(v))/2),P=[f[0]-y[0],f[1]-y[1]];this.normalize(P);var S=t/w;o.push([h[0]-P[0]*S,h[1]-P[1]*S])}}}else{var C=[h[0]-l[0],h[1]-l[1]];this.normalize(C),o.push([h[0]+C[1]*t,h[1]-C[0]*t])}else{var M=[u[0]-h[0],u[1]-h[1]];this.normalize(M),o.push([h[0]+M[1]*t,h[1]-M[0]*t])}l=h,h=u}return s&&o.push([o[0][0],o[0][1]]),o}}]),e}(),p=1.7320508075688772,_=function(){function e(){Object(a.a)(this,e)}return Object(n.a)(e,[{key:"execute",value:function(e,t,i){return new b(e,t,i)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();_.instance=null;var b=function(e){Object(u.a)(i,e);var t=Object(f.a)(i);function i(e,r,n){var s;return Object(a.a)(this,i),(s=t.call(this,e,!1,!0))._curveHelper=new v,s._width=(void 0!==r.width?r.width:5)*n,s._arrowType=void 0!==r.geometricEffectArrowType?r.geometricEffectArrowType:"OpenEnded",s._offsetFlattenError=y*n,s}return Object(n.a)(i,[{key:"processPath",value:function(e){switch(this._arrowType){default:return this._constructSimpleArrow(e,!0);case"Block":return this._constructSimpleArrow(e,!1);case"Crossed":return this._constructCrossedArrow(e)}}},{key:"_constructSimpleArrow",value:function(e,t){var i=this._curveHelper.calculatePathLength(e),r=this._width;i<2*r&&(r=i/2);var a=this._curveHelper.getSubCurve(e,0,i-r);if(!a)return null;var n=r/2;if(this._curveHelper.isEmpty(a,!1))return null;var s=this._constructOffset(a,-n);if(!s)return null;var o=this._constructOffset(a,n);if(!o)return null;var l=this._constructArrowBasePoint(s,-n/2);if(!l)return null;var h=this._constructArrowBasePoint(o,n/2);if(!h)return null;var c=e[e.length-1];t||(this._makeControlPoint(o,!0),this._makeControlPoint(s,!0));var u=new d;return u.addPath(o,!0),u.lineTo(h),this._makeControlPoint(u.path()),u.lineTo(c),this._makeControlPoint(u.path()),u.lineTo(l),this._makeControlPoint(u.path()),u.addPath(s,!1),t?{paths:[u.path()]}:(u.close(),{rings:[u.path()]})}},{key:"_constructCrossedArrow",value:function(e){var t=this._curveHelper.calculatePathLength(e),i=this._width;t<3.732050807568877*i&&(i=t/3.732050807568877);var r=this._curveHelper.getSubCurve(e,0,t-i*(1+p));if(!r)return null;var a=i/2;if(this._curveHelper.isEmpty(r,!1))return null;var n=this._constructOffset(r,a);if(!n)return null;var s=this._constructOffset(r,-a);if(!s)return null;var o=this._curveHelper.getSubCurve(e,0,t-i);if(!o)return null;if(this._curveHelper.isEmpty(o,!1))return null;var l=this._constructOffset(o,a);if(!l)return null;var h=this._constructOffset(o,-a);if(!h)return null;var c=l[l.length-1],u=this._constructArrowBasePoint(l,a/2);if(!u)return null;var f=h[h.length-1],y=this._constructArrowBasePoint(h,-a/2);if(!y)return null;var v=e[e.length-1];this._makeControlPoint(n,!1),this._makeControlPoint(s,!1);var _=new d;return _.addPath(n,!0),this._makeControlPoint(_.path()),_.lineTo(f),_.lineTo(y),this._makeControlPoint(_.path()),_.lineTo(v),this._makeControlPoint(_.path()),_.lineTo(u),this._makeControlPoint(_.path()),_.lineTo(c),this._makeControlPoint(_.path()),_.addPath(s,!1),{paths:[_.path()]}}},{key:"_constructOffset",value:function(e,t){return this._curveHelper.offset(e,t,"Rounded",4,this._offsetFlattenError)}},{key:"_constructArrowBasePoint",value:function(e,t){if(!e||e.length<2)return null;var i=e[e.length-2],r=e[e.length-1],a=[r[0]-i[0],r[1]-i[1]];return this._curveHelper.normalize(a),[r[0]+a[1]*t,r[1]-a[0]*t]}},{key:"_makeControlPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object(l.j)(t?e[0]:e[e.length-1],1)}}]),i}(l.a),g=function(){function e(){Object(a.a)(this,e)}return Object(n.a)(e,[{key:"execute",value:function(e,t,i){return new m(e,t,i)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();g.instance=null;var m=function(){function e(t,i,r){Object(a.a)(this,e),this._inputGeometries=t,this._curveHelper=new v,this._size=(void 0!==i.size?i.size:1)*r,this._offsetFlattenError=y*r}return Object(n.a)(e,[{key:"next",value:function(){for(var e=this._inputGeometries.next();e;){if(Object(o.d)(e))if(this._size>0){var t=[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]],i=this._curveHelper.offset(t,this._size,"Rounded",4,this._offsetFlattenError);if(i)return{rings:[i]}}else{if(!(this._size<0))return e;if(Math.min(e.xmax-e.xmin,e.ymax-e.ymin)+2*this._size>0)return{xmin:e.xmin-this._size,xmax:e.xmax+this._size,ymin:e.ymin-this._size,ymax:e.ymax+this._size}}if(Object(o.g)(e)){if(0===this._size)return e;var a,n=[],s=Object(r.a)(e.rings);try{for(s.s();!(a=s.n()).done;){var l=a.value,h=this._curveHelper.offset(l,this._size,"Rounded",4,this._offsetFlattenError);h&&n.push(h)}}catch(_){s.e(_)}finally{s.f()}if(n.length)return{rings:n}}if(Object(o.h)(e)&&this._size>0){var c,u=[],f=Object(r.a)(e.paths);try{for(f.s();!(c=f.n()).done;){var y=c.value;if(y&&y.length>1){var d=this._curveHelper.offset(y,this._size,"Rounded",4,this._offsetFlattenError),v=this._curveHelper.offset(y,-this._size,"Rounded",4,this._offsetFlattenError);if(d&&v){for(var p=v.length-1;p>=0;p--)d.push(v[p]);d.push([d[0][0],d[0][1]]),u.push(d)}}}}catch(_){f.e(_)}finally{f.f()}if(u.length)return{rings:u}}Object(o.f)(e)&&this._size,e=this._inputGeometries.next()}return null}}]),e}(),O=function(){function e(){Object(a.a)(this,e)}return Object(n.a)(e,[{key:"execute",value:function(e,t,i){return new x(e,t,i)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();O.instance=null;var x=function(e){Object(u.a)(i,e);var t=Object(f.a)(i);function i(e,r,n){var s;return Object(a.a)(this,i),(s=t.call(this,e,!0,!0))._curveHelper=new v,s._beginCut=(void 0!==r.beginCut?r.beginCut:1)*n,s._endCut=(void 0!==r.endCut?r.endCut:1)*n,s._middleCut=(void 0!==r.middleCut?r.middleCut:0)*n,s._invert=void 0!==r.invert&&r.invert,s._beginCut<0&&(s._beginCut=0),s._endCut<0&&(s._endCut=0),s._middleCut<0&&(s._middleCut=0),s}return Object(n.a)(i,[{key:"processPath",value:function(e){var t=this._beginCut,i=this._endCut,r=this._middleCut,a=this._curveHelper.calculatePathLength(e),n=[];if(this._invert)if(0===t&&0===i&&0===r);else if(t+i+r>=a)n.push(e);else{var s=this._curveHelper.getSubCurve(e,0,t);s&&n.push(s),(s=this._curveHelper.getSubCurve(e,.5*(a-r),.5*(a+r)))&&n.push(s),(s=this._curveHelper.getSubCurve(e,a-i,i))&&n.push(s)}else if(0===t&&0===i&&0===r)n.push(e);else if(t+i+r>=a);else if(0===r){var o=this._curveHelper.getSubCurve(e,t,a-i);o&&n.push(o)}else{var l=this._curveHelper.getSubCurve(e,t,.5*(a-r));l&&n.push(l),(l=this._curveHelper.getSubCurve(e,.5*(a+r),a-i))&&n.push(l)}return 0===n.length?null:{paths:n}}}]),i}(l.a),k=i(20),j=1e-7,w=function(){function e(){Object(a.a)(this,e),this._values=[],this.extPtGap=0,this.ctrlPtGap=0,this._length=0,this._currentValue=0}return Object(n.a)(e,[{key:"isEmpty",value:function(){return 0===this._values.length}},{key:"size",value:function(){return this._values.length}},{key:"init",value:function(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._setEmpty(),!e||0===e.length)return!1;for(var r=0;r<e.length;r++){var a=Math.abs(e[r]);i&&a<j&&(a=j),this._values.push(a),this._length+=a}return t&&1&e.length&&(this._length*=2),0!==this._length&&(this.ctrlPtGap=this.extPtGap=0,this._currentValue=-1,!0)}},{key:"scale",value:function(e){for(var t=this._values?this._values.length:0,i=0;i<t;++i)this._values[i]*=e;this._length*=e,this.extPtGap*=e,this.ctrlPtGap*=e}},{key:"addValue",value:function(e){this._length+=e,this._values.push(e)}},{key:"firstValue",value:function(){return this._values[0]}},{key:"lastValue",value:function(){return this._values[this._values.length-1]}},{key:"nextValue",value:function(){return this._currentValue++,this._currentValue===this._values.length&&(this._currentValue=0),this._values[this._currentValue]}},{key:"reset",value:function(){this._currentValue=-1}},{key:"length",value:function(){return this._length}},{key:"_setEmpty",value:function(){this.extPtGap=this.ctrlPtGap=this._length=0,this._currentValue=-1,this._values.length=0}}]),e}(),P=function(){function e(){Object(a.a)(this,e),this.reset()}return Object(n.a)(e,[{key:"reset",value:function(){this.segment=-1,this.segmentLength=0,this.abscissa=0,this.isPathEnd=!1,this.isPartEnd=!1}},{key:"isValid",value:function(){return-1!==this.segment}},{key:"copyTo",value:function(e){e.segment=this.segment,e.segmentLength=this.segmentLength,e.abscissa=this.abscissa,e.isPathEnd=this.isPathEnd,e.isPartEnd=this.isPartEnd}}]),e}(),S=function(e){Object(u.a)(i,e);var t=Object(f.a)(i);function i(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Object(a.a)(this,i),(e=t.call(this,r,n))._tolerance=y,e._currentPosition=new P,e}return Object(n.a)(i,[{key:"updateTolerance",value:function(e){this._tolerance=y*e}},{key:"init",value:function(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return i?(this._patternLength=t.length(),this._partExtPtGap=t.extPtGap,this._partCtrlPtGap=t.ctrlPtGap):(this._patternLength=0,this._partExtPtGap=0,this._partCtrlPtGap=0),this._currentPosition.reset(),this._partSegCount=0,this._path=e,this._seg=-1,this.setPosAtNextPart()}},{key:"curPositionIsValid",value:function(){return this._currentPosition.isValid()}},{key:"nextPosition",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=new P;return!!this._nextPosition(e,i,null,t)&&(i.copyTo(this._currentPosition),!0)}},{key:"curPointAndAngle",value:function(e){e.pt=this._getPoint(this._currentPosition);var t=this._getAngle(this._currentPosition),i=Object(k.a)(t,2),r=i[0],a=i[1];e.ca=r,e.sa=a}},{key:"nextPointAndAngle",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=new P;if(!this._nextPosition(e,r,null,i))return!1;r.copyTo(this._currentPosition),t.pt=this._getPoint(r);var a=this._getAngle(r),n=Object(k.a)(a,2),s=n[0],o=n[1];return t.ca=s,t.sa=o,!0}},{key:"nextCurve",value:function(e){if(0===e)return null;var t=[],i=new P;return this._nextPosition(e,i,t,1)?(i.copyTo(this._currentPosition),t):null}},{key:"isPathEnd",value:function(){return this._currentPosition.isPathEnd}},{key:"getPathEnd",value:function(){if(-1===this._currentPosition.segment)throw new Error("missing segment");return this._path[this._currentPosition.segment+1]}},{key:"_nextPosition",value:function(e,t,i,r){if(this._currentPosition.isPathEnd)return!1;var a=this._currentPosition.abscissa;for(this._currentPosition.segmentLength>0&&(a/=this._currentPosition.segmentLength),this._currentPosition.copyTo(t);t.abscissa+e*this._partLengthRatio>t.segmentLength+this._tolerance;){if(i){if(0===i.length)if(0===a){var n=this._path[t.segment];i.push([n[0],n[1]])}else i.push(this.getSegCoord2D(this._path,t.segment,a));var s=this._path[t.segment+1];i.push([s[0],s[1]])}if(a=0,e-=(t.segmentLength-t.abscissa)/this._partLengthRatio,this._partSegCount)t.segment=this.nextSegment(),t.segmentLength=this.calculateSegLength(this._path,t.segment),t.abscissa=0,this._partSegCount--;else{if(!this.setPosAtNextPart())return 0!==r&&(t.segmentLength=this.calculateSegLength(this._path,t.segment),t.isPartEnd=!0,1===r?(t.abscissa=t.segmentLength,t.isPathEnd=!0):t.abscissa=t.segmentLength+e,!0);this._currentPosition.copyTo(t)}}if(t.abscissa+=e*this._partLengthRatio,i){if(0===i.length)if(0===a){var o=this._path[t.segment];i.push([o[0],o[1]])}else i.push(this.getSegCoord2D(this._path,t.segment,a));var l=t.abscissa/t.segmentLength;if(1===l){var h=this._path[t.segment+1];i.push([h[0],h[1]])}else i.push(this.getSegCoord2D(this._path,t.segment,l))}return this._partSegCount||Math.abs(t.abscissa-t.segmentLength)<this._tolerance&&(t.isPathEnd=this._partIsLast,t.isPartEnd=!0),!0}},{key:"_getPoint",value:function(e){if(-1===e.segment)throw new Error("missing segment");var t=e.segmentLength<=0?0:e.abscissa/e.segmentLength;return this.getSegCoord2D(this._path,e.segment,t)}},{key:"_getAngle",value:function(e){if(-1===e.segment)throw new Error("missing segment");var t=e.segmentLength<=0?0:e.abscissa/e.segmentLength;return this.getSegAngleCS(this._path,e.segment,t)}},{key:"setPosAtNextPart",value:function(){for(;this._partSegCount;)this.hasNextSegment()&&this.nextSegment(),this._partSegCount--;if(!this.hasNextSegment())return!1;for(this._partLength=0,this._partIsLast=!0,this._partSegCount=0;this.hasNextSegment();)if(this._partLength+=this.calculateSegLength(this._path,this.nextSegment()),this._partSegCount++,1===Object(l.f)(this._path[this.getEndPointIndex()])){this._partIsLast=!this.hasNextSegment();break}for(var e=this._partSegCount;e;)this.previousSegment(),--e;this._currentPosition.segment=this.nextSegment(),this._currentPosition.segmentLength=this.calculateSegLength(this._path,this._currentPosition.segment),this._currentPosition.abscissa=0,this._currentPosition.isPathEnd=this._currentPosition.isPartEnd=!1,--this._partSegCount;var t=this.getStartPointIndex();this._ctrlPtBegin=1===Object(l.f)(this._path[t]);var i=t+this._partSegCount+1;if(i>=this._path.length&&(i=0),this._ctrlPtEnd=1===Object(l.f)(this._path[i]),this._patternLength>0){var r=this._ctrlPtBegin?this._partCtrlPtGap:this._partExtPtGap,a=this._ctrlPtEnd?this._partCtrlPtGap:this._partExtPtGap,n=Math.round((this._partLength-(r+a))/this._patternLength);n<=0&&(n=r+a>0?0:1),this._partLengthRatio=this._partLength/(r+a+n*this._patternLength),this._partLengthRatio<.01&&(this._partLengthRatio=1)}else this._partLengthRatio=1;return!0}},{key:"hasNextSegment",value:function(){return this._seg<this._path.length-2}},{key:"previousSegment",value:function(){return--this._seg}},{key:"nextSegment",value:function(){return++this._seg}},{key:"getStartPointIndex",value:function(){return this._seg}},{key:"getEndPointIndex",value:function(){return this._seg+1}}]),i}(v),C=function(){function e(){Object(a.a)(this,e)}return Object(n.a)(e,[{key:"execute",value:function(e,t,i){return new M(e,t,i)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();C.instance=null;var M=function(e){Object(u.a)(i,e);var t=Object(f.a)(i);function i(e,r,n){var s;return Object(a.a)(this,i),(s=t.call(this,e,!0,!0))._walker=new S,s._walker.updateTolerance(n),s._endings=r.lineDashEnding,s._customDashPos=void 0!==r.offsetAlongLine?r.offsetAlongLine*n:0,s._offsetAtEnd=void 0!==r.customEndingOffset?r.customEndingOffset*n:0,s._pattern=new w,s._pattern.init(r.dashTemplate,!0),s._pattern.scale(n),s}return Object(n.a)(i,[{key:"processPath",value:function(e){if(0===this._pattern.length())return this.iteratePath=!1,{paths:[e]};if(!this.iteratePath){var t=!0;switch(this._endings){default:this._pattern.extPtGap=0;break;case"FullPattern":this.isClosed||(this._pattern.extPtGap=.5*this._pattern.firstValue());break;case"FullGap":this.isClosed||(this._pattern.extPtGap=.5*this._pattern.lastValue());break;case"NoConstraint":this.isClosed||(t=!1);break;case"Custom":this.isClosed||(this._pattern.extPtGap=.5*this._offsetAtEnd)}var i=this._walker.calculatePathLength(e);if(this._pattern.isEmpty()||i<.1*this._pattern.length())return{paths:[e]};if(!this._walker.init(e,this._pattern,t))return{paths:[e]}}var r;if(this.iteratePath)r=this._pattern.nextValue();else{var a;switch(this._endings){default:a=.5*this._pattern.firstValue();break;case"HalfGap":a=.5*-this._pattern.lastValue();break;case"FullGap":a=-this._pattern.lastValue();break;case"FullPattern":a=0;break;case"NoConstraint":case"Custom":a=-this._customDashPos}var n=a/this._pattern.length();a=(n-=Math.floor(n))*this._pattern.length(),this._pattern.reset(),r=this._pattern.nextValue();for(var s=!1;a>=r;)a-=r,r=this._pattern.nextValue(),s=!s;r-=a,s?(this._walker.nextPosition(r),r=this._pattern.nextValue()):this.isClosed&&(this._firstCurve=this._walker.nextCurve(r),r=this._pattern.nextValue(),this._walker.nextPosition(r),r=this._pattern.nextValue())}var o=this._walker.nextCurve(r);return o?this._walker.isPathEnd()?(this.iteratePath=!1,this._firstCurve&&(this._firstCurve.splice(0,1),d.mergePath(o,this._firstCurve),this._firstCurve=null)):(r=this._pattern.nextValue(),!this._walker.nextPosition(r)||this._walker.isPathEnd()?(this.iteratePath=!1,this._firstCurve&&(o=this._firstCurve,this._firstCurve=null)):this.iteratePath=!0):(this.iteratePath=!1,o=this._firstCurve,this._firstCurve=null),{paths:[o]}}}]),i}(l.a),I=function(){function e(){Object(a.a)(this,e)}return Object(n.a)(e,[{key:"execute",value:function(e,t,i){return new T(e,t,i)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();I.instance=null;var T=function(){function e(t,i,r){switch(Object(a.a)(this,e),this._inputGeometries=t,this._curveHelper=new v,this._width=(void 0!==i.width?i.width:2)*r,i.method){default:this._method="Mitered";break;case"Bevelled":this._method="Bevelled";break;case"Rounded":case"TrueBuffer":this._method="Rounded";break;case"Square":this._method="Square"}this._option=i.option,this._offsetFlattenError=y*r}return Object(n.a)(e,[{key:"next",value:function(){for(var e=this._inputGeometries.next();e;){if(Object(o.d)(e)&&this._width>0){if(Math.min(e.xmax-e.xmin,e.ymax-e.ymin)-2*this._width<0)return e;var t=[];return t.push([[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]),t.push([[e.xmin+this._width,e.ymin+this._width],[e.xmax-this._width,e.ymin+this._width],[e.xmax-this._width,e.ymax-this._width],[e.xmin+this._width,e.ymax-this._width],[e.xmin+this._width,e.ymin+this._width]]),{rings:t}}if(Object(o.g)(e)&&this._width>0){var i,a=[],n=Object(r.a)(e.rings);try{for(n.s();!(i=n.n()).done;){var s=i.value,l=this._curveHelper.calculatePathLength(s),h=this._curveHelper.offset(s,this._width,this._method,4,this._offsetFlattenError);h&&(l<0&&h.reverse(),a.push(h))}}catch(c){n.e(c)}finally{n.f()}if(a.length)return{rings:a}}e=this._inputGeometries.next()}return null}}]),e}(),L=function(){function e(){Object(a.a)(this,e)}return Object(n.a)(e,[{key:"execute",value:function(e,t,i){return new R(e,t,i)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();L.instance=null;var R=function(e){Object(u.a)(i,e);var t=Object(f.a)(i);function i(e,r,n){var s;return Object(a.a)(this,i),(s=t.call(this,e,!1,!0))._curveHelper=new v,s._length=(void 0!==r.length?r.length:20)*n,s._angle=void 0!==r.angle?r.angle:225,s._position=void 0!==r.position?r.position:50,s._length<0&&(s._length=-s._length),s._position<20&&(s._position=20),s._position>80&&(s._position=80),s._mirror=!1,s}return Object(n.a)(i,[{key:"processPath",value:function(e){if(this._curveHelper.isEmpty(e,!1))return null;var t=e[0],i=e[e.length-1],r=[i[0]-t[0],i[1]-t[1]];this._curveHelper.normalize(r);var a=[t[0]+(i[0]-t[0])*this._position/100,t[1]+(i[1]-t[1])*this._position/100],n=Math.cos((90-this._angle)/180*Math.PI),s=Math.sin((90-this._angle)/180*Math.PI);return this._mirror&&(s=-s),this._mirror=!this._mirror,{paths:[[t,[a[0]-this._length/2*n,a[1]-this._length/2*s],[a[0]+this._length/2*n,a[1]+this._length/2*s],i]]}}}]),i}(l.a),A=function(){function e(){Object(a.a)(this,e)}return Object(n.a)(e,[{key:"execute",value:function(e,t,i){return new D(e,t,i)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();A.instance=null;var D=function(){function e(t,i,r){Object(a.a)(this,e),this._inputGeometries=t,this._offsetX=void 0!==i.offsetX?i.offsetX*r:0,this._offsetY=void 0!==i.offsetY?-i.offsetY*r:0}return Object(n.a)(e,[{key:"next",value:function(){for(var e=this._inputGeometries.next();e;){if(Object(o.d)(e))return{xmin:e.xmin+this._offsetX,xmax:e.xmax+this._offsetX,ymin:e.ymin+this._offsetY,ymax:e.ymax+this._offsetY};if(Object(o.g)(e)){var t=Object(s.a)(e);return this._moveMultipath(t.rings,this._offsetX,this._offsetY),t}if(Object(o.h)(e)){var i=Object(s.a)(e);return this._moveMultipath(i.paths,this._offsetX,this._offsetY),i}if(Object(o.e)(e)){var r=Object(s.a)(e);return this._movePath(r.points,this._offsetX,this._offsetY),r}if(Object(o.f)(e))return{x:e.x+this._offsetX,y:e.y+this._offsetY};e=this._inputGeometries.next()}return null}},{key:"_moveMultipath",value:function(e,t,i){if(e){var a,n=Object(r.a)(e);try{for(n.s();!(a=n.n()).done;){var s=a.value;this._movePath(s,t,i)}}catch(o){n.e(o)}finally{n.f()}}}},{key:"_movePath",value:function(e,t,i){if(e){var a,n=Object(r.a)(e);try{for(n.s();!(a=n.n()).done;){var s=a.value;s[0]+=t,s[1]+=i}}catch(o){n.e(o)}finally{n.f()}}}}]),e}(),V=function(){function e(){Object(a.a)(this,e)}return Object(n.a)(e,[{key:"execute",value:function(e,t,i){return new z(e,t,i)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();V.instance=null;var z=function(){function e(t,i,r){Object(a.a)(this,e),this._inputGeometries=t,this._curveHelper=new v,this._offset=(void 0!==i.offset?i.offset:1)*r,this._method=i.method,this._option=i.option,this._offsetFlattenError=y*r}return Object(n.a)(e,[{key:"next",value:function(){for(var e=this._inputGeometries.next();e;){if(0===this._offset)return e;if(Object(o.d)(e)){if("Rounded"===this._method&&this._offset>0){var t=[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]],i=this._curveHelper.offset(t,this._offset,this._method,4,this._offsetFlattenError);return i?{rings:[i]}:null}if(Math.min(e.xmax-e.xmin,e.ymax-e.ymin)+2*this._offset>0)return{xmin:e.xmin-this._offset,xmax:e.xmax+this._offset,ymin:e.ymin-this._offset,ymax:e.ymax+this._offset}}if(Object(o.g)(e)){var a,n=[],s=Object(r.a)(e.rings);try{for(s.s();!(a=s.n()).done;){var l=a.value,h=this._curveHelper.offset(l,this._offset,this._method,4,this._offsetFlattenError);h&&n.push(h)}}catch(v){s.e(v)}finally{s.f()}if(n.length)return{rings:n}}if(Object(o.h)(e)){var c,u=[],f=Object(r.a)(e.paths);try{for(f.s();!(c=f.n()).done;){var y=c.value,d=this._curveHelper.offset(y,this._offset,this._method,4,this._offsetFlattenError);d&&u.push(d)}}catch(v){f.e(v)}finally{f.f()}if(u.length)return{paths:u}}e=this._inputGeometries.next()}return null}}]),e}(),B=function(){function e(){Object(a.a)(this,e)}return Object(n.a)(e,[{key:"execute",value:function(e,t,i){return new F(e,t,i)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();B.instance=null;var F=function(){function e(t,i,r){Object(a.a)(this,e),this._inputGeometries=t,this._reverse=void 0===i.reverse||i.reverse}return Object(n.a)(e,[{key:"next",value:function(){for(var e=this._inputGeometries.next();e;){if(!this._reverse)return e;if(Object(o.h)(e)){var t=Object(s.a)(e);return Object(l.h)(t.paths),t}e=this._inputGeometries.next()}return null}}]),e}(),E=i(94),U=i(320),H=function(){function e(){Object(a.a)(this,e)}return Object(n.a)(e,[{key:"execute",value:function(e,t,i){return new q(e,t,i)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();H.instance=null;var q=function(){function e(t,i,r){Object(a.a)(this,e),this._inputGeometries=t,this._rotateAngle=void 0!==i.angle?-i.angle*Math.PI/180:0}return Object(n.a)(e,[{key:"next",value:function(){for(var e=this._inputGeometries.next();e;){if(0===this._rotateAngle)return e;var t=Object(E.h)();Object(U.a)(t,e);var i=(t[2]+t[0])/2,r=(t[3]+t[1])/2;if(Object(o.d)(e)){var a={rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]};return this._rotateMultipath(a.rings,i,r),a}if(Object(o.g)(e)){var n=Object(s.a)(e);return this._rotateMultipath(n.rings,i,r),n}if(Object(o.h)(e)){var l=Object(s.a)(e);return this._rotateMultipath(l.paths,i,r),l}if(Object(o.e)(e)){var h=Object(s.a)(e);return this._rotatePath(h.points,i,r),h}if(Object(o.f)(e))return e;e=this._inputGeometries.next()}return null}},{key:"_rotateMultipath",value:function(e,t,i){if(e){var a,n=Object(r.a)(e);try{for(n.s();!(a=n.n()).done;){var s=a.value;this._rotatePath(s,t,i)}}catch(o){n.e(o)}finally{n.f()}}}},{key:"_rotatePath",value:function(e,t,i){if(e){var a,n=Math.cos(this._rotateAngle),s=Math.sin(this._rotateAngle),o=Object(r.a)(e);try{for(o.s();!(a=o.n()).done;){var l=a.value,h=l[0]-t,c=l[1]-i;l[0]=t+h*n-c*s,l[1]=i+h*s+c*n}}catch(u){o.e(u)}finally{o.f()}}}}]),e}(),G=function(){function e(){Object(a.a)(this,e)}return Object(n.a)(e,[{key:"execute",value:function(e,t,i){return new N(e,t,i)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();G.instance=null;var N=function(){function e(t,i,r){Object(a.a)(this,e),this._inputGeometries=t,this._xFactor=void 0!==i.xScaleFactor?i.xScaleFactor:1.15,this._yFactor=void 0!==i.yScaleFactor?i.yScaleFactor:1.15}return Object(n.a)(e,[{key:"next",value:function(){for(var e=this._inputGeometries.next();e;){if(1===this._xFactor&&1===this._yFactor)return e;var t=Object(E.h)();Object(U.a)(t,e);var i=(t[2]+t[0])/2,r=(t[3]+t[1])/2;if(Object(o.d)(e)){var a={rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]};return this._scaleMultipath(a.rings,i,r),a}if(Object(o.g)(e)){var n=Object(s.a)(e);return this._scaleMultipath(n.rings,i,r),n}if(Object(o.h)(e)){var l=Object(s.a)(e);return this._scaleMultipath(l.paths,i,r),l}if(Object(o.e)(e)){var h=Object(s.a)(e);return this._scalePath(h.points,i,r),h}if(Object(o.f)(e))return e;e=this._inputGeometries.next()}return null}},{key:"_scaleMultipath",value:function(e,t,i){if(e){var a,n=Object(r.a)(e);try{for(n.s();!(a=n.n()).done;){var s=a.value;this._scalePath(s,t,i)}}catch(o){n.e(o)}finally{n.f()}}}},{key:"_scalePath",value:function(e,t,i){if(e){var a,n=Object(r.a)(e);try{for(n.s();!(a=n.n()).done;){var s=a.value,o=(s[0]-t)*this._xFactor,l=(s[1]-i)*this._yFactor;s[0]=t+o,s[1]=i+l}}catch(h){n.e(h)}finally{n.f()}}}}]),e}(),X=function(){function e(){Object(a.a)(this,e)}return Object(n.a)(e,[{key:"execute",value:function(e,t,i){return new J(e,t,i)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();X.instance=null;var Y,W,J=function(){function e(t,i,r){Object(a.a)(this,e),this._inputGeometries=t,this._height=(void 0!==i.amplitude?i.amplitude:2)*r,this._period=(void 0!==i.period?i.period:3)*r,this._style=i.waveform,this._height<=0&&(this._height=Math.abs(this._height)),this._period<=0&&(this._period=Math.abs(this._period)),this._pattern=new w,this._pattern.addValue(this._period),this._pattern.addValue(this._period),this._walker=new S,this._walker.updateTolerance(r)}return Object(n.a)(e,[{key:"next",value:function(){for(var e=this._inputGeometries.next();e;){if(0===this._height||0===this._period)return e;if(Object(o.h)(e)){var t=this._processGeom(e.paths);if(t.length)return{paths:t}}if(Object(o.g)(e)){var i=this._processGeom(e.rings);if(i.length)return{rings:i}}e=this._inputGeometries.next()}return null}},{key:"_processGeom",value:function(e){var t,i=[],a=Object(r.a)(e);try{for(a.s();!(t=a.n()).done;){var n=t.value;if(this._walker.init(n,this._pattern))switch(this._style){default:i.push(this._constructCurve(n,!1));break;case"Square":i.push(this._constructSquare(n));break;case"Triangle":i.push(this._constructTriangle(n));break;case"Random":i.push(this._constructCurve(n,!0))}else i.push(n)}}catch(s){a.e(s)}finally{a.f()}return i}},{key:"_constructCurve",value:function(e,t){var i=new d,r=this._walker.calculatePathLength(e),a=Math.round(r/this._period);0===a&&(a=1);var n=16*a+1,s=r/a,o=this._period/16,l=1/n,h=2*Math.PI*r/s,c=2*Math.PI*Math.random(),u=2*Math.PI*Math.random(),f=2*Math.PI*Math.random(),y=.75-Math.random()/2,v=.75-Math.random()/2,p={};this._walker.curPointAndAngle(p),i.startPath(p.pt);for(var _=0;;){if(!this._walker.nextPointAndAngle(o,p)){i.lineTo(e[e.length-1]);break}var b=_,g=void 0;if(_+=l,t){var m=this._height/2*(1+.3*Math.sin(y*h*b+c));g=m*Math.sin(h*b+u),g+=m*Math.sin(v*h*b+f),g/=2}else g=.5*this._height*Math.sin(.5*h*b);i.lineTo([p.pt[0]-g*p.sa,p.pt[1]+g*p.ca])}return i.path()}},{key:"_constructSquare",value:function(e){var t=new d,i=this._walker.calculatePathLength(e);Math.round(i/this._period);for(var r=!0;;){var a=!1;if(this._walker.curPositionIsValid()){var n={};this._walker.curPointAndAngle(n);var s={};if(this._walker.nextPointAndAngle(this._period,s)){var o={};this._walker.nextPointAndAngle(this._period,o)&&(r?(t.startPath(n.pt),r=!1):t.lineTo(n.pt),t.lineTo([n.pt[0]-this._height/2*n.sa,n.pt[1]+this._height/2*n.ca]),t.lineTo([s.pt[0]-this._height/2*s.sa,s.pt[1]+this._height/2*s.ca]),t.lineTo([s.pt[0]+this._height/2*s.sa,s.pt[1]-this._height/2*s.ca]),t.lineTo([o.pt[0]+this._height/2*o.sa,o.pt[1]-this._height/2*o.ca]),a=!0)}}if(!a){t.lineTo(this._walker.getPathEnd());break}}return t.path()}},{key:"_constructTriangle",value:function(e){var t=new d,i=this._walker.calculatePathLength(e);Math.round(i/this._period);for(var r=!0;;){var a=!1;if(this._walker.curPositionIsValid()){var n={};this._walker.curPointAndAngle(n);var s={};if(this._walker.nextPointAndAngle(this._period/2,s)){var o={};this._walker.nextPointAndAngle(this._period,o)&&(this._walker.nextPosition(this._period/2)&&(r?(t.startPath(n.pt),r=!1):t.lineTo(n.pt),t.lineTo([s.pt[0]-this._height/2*s.sa,s.pt[1]+this._height/2*s.ca]),t.lineTo([o.pt[0]+this._height/2*o.sa,o.pt[1]-this._height/2*o.ca])),a=!0)}}if(!a){t.lineTo(this._walker.getPathEnd());break}}return t.path()}}]),e}();(W=Y||(Y={})).NoConstraint="NoConstraint",W.WithMarkers="WithMarkers",W.WithFullGap="WithFullGap",W.WithHalfGap="WithHalfGap",W.Custom="Custom";var Q=function(){function e(){Object(a.a)(this,e)}return Object(n.a)(e,[{key:"execute",value:function(e,t,i){return new K(e,t,i)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();Q.instance=null;var K=function(e){Object(u.a)(i,e);var t=Object(f.a)(i);function i(e,r,n){var s;return Object(a.a)(this,i),(s=t.call(this,e,!0,!0))._grometryWalker=new S,s._grometryWalker.updateTolerance(n),s._angleToLine=void 0===r.angleToLine||r.angleToLine,s._offset=void 0!==r.offset?r.offset*n:0,s._originalEndings=r.endings,s._offsetAtEnd=void 0!==r.customEndingOffset?r.customEndingOffset*n:0,s._position=void 0!==r.offsetAlongLine?r.offsetAlongLine*n:0,s._pattern=new w,s._pattern.init(r.placementTemplate,!1),s._pattern.scale(n),s._endings=s._originalEndings,s}return Object(n.a)(i,[{key:"processPath",value:function(e){if(this._pattern.isEmpty())return null;var t;if(this.iteratePath)t=this._pattern.nextValue();else{this._originalEndings===Y.WithFullGap&&this.isClosed?this._endings=Y.WithMarkers:this._endings=this._originalEndings,this._pattern.extPtGap=0;var i,r=!0;switch(this._endings){case Y.NoConstraint:i=-this._position,i=this._adjustPosition(i),r=!1;break;case Y.WithHalfGap:default:i=-this._pattern.lastValue()/2;break;case Y.WithFullGap:i=-this._pattern.lastValue(),this._pattern.extPtGap=this._pattern.lastValue();break;case Y.WithMarkers:i=0;break;case Y.Custom:i=-this._position,i=this._adjustPosition(i),this._pattern.extPtGap=.5*this._offsetAtEnd}if(!this._grometryWalker.init(e,this._pattern,r))return null;this._pattern.reset();for(var a=0;i>a;)i-=a,a=this._pattern.nextValue();t=a-=i,this.iteratePath=!0}var n={};return this._grometryWalker.nextPointAndAngle(t,n)?this._endings===Y.WithFullGap&&this._grometryWalker.isPathEnd()?(this.iteratePath=!1,null):this._endings===Y.WithMarkers&&this._grometryWalker.isPathEnd()&&(this.iteratePath=!1,this.isClosed)?null:(this.internalPlacement.setTranslate(n.pt[0]+this._offset*n.sa,n.pt[1]-this._offset*n.ca),this._angleToLine&&this.internalPlacement.setRotateCS(n.ca,n.sa),this.internalPlacement):(this.iteratePath=!1,null)}},{key:"_adjustPosition",value:function(e){var t=e/this._pattern.length();return(t-=Math.floor(t))*this._pattern.length()}}]),i}(l.b),Z=function(){function e(){Object(a.a)(this,e)}return Object(n.a)(e,[{key:"execute",value:function(e,t,i){return new $(e,t,i)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();Z.instance=null;var $=function(e){Object(u.a)(i,e);var t=Object(f.a)(i);function i(e,r,n){var s;return Object(a.a)(this,i),(s=t.call(this,e,!1,!0))._curveHelper=new v,s._angleToLine=void 0===r.angleToLine||r.angleToLine,s._offset=void 0!==r.offset?r.offset*n:0,s._type=r.extremityPlacement,s._position=void 0!==r.offsetAlongLine?r.offsetAlongLine*n:0,s._beginProcessed=!1,s}return Object(n.a)(i,[{key:"processPath",value:function(e){var t;switch(this._type){default:this._beginProcessed?(t=this._atExtremities(e,this._position,!1),this._beginProcessed=!1,this.iteratePath=!1):(t=this._atExtremities(e,this._position,!0),this._beginProcessed=!0,this.iteratePath=!0);break;case"JustBegin":t=this._atExtremities(e,this._position,!0);break;case"JustEnd":t=this._atExtremities(e,this._position,!1);case"None":}return t}},{key:"_atExtremities",value:function(e,t,i){var r=e.length;if(r<2)return null;for(var a,n=i?1:r-2,s=i?r:-1,o=i?1:-1,h=0,c=i?e[0]:e[r-1],u=n;u!==s;u+=o){a=c,c=e[u];var f=this._curveHelper.calculateLength(a,c);if(h+f>t){var y=(t-h)/f,d=this._curveHelper.getAngleCS(a,c,y),v=Object(k.a)(d,2),p=v[0],_=v[1],b=Object(l.e)(a,c,y);return this.internalPlacement.setTranslate(b[0]-this._offset*_,b[1]+this._offset*p),this._angleToLine&&this.internalPlacement.setRotateCS(-p,-_),this.internalPlacement}h+=f}return null}}]),i}(l.b),ee=function(){function e(){Object(a.a)(this,e)}return Object(n.a)(e,[{key:"execute",value:function(e,t,i){return new te(e,t,i)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();ee.instance=null;var te=function(e){Object(u.a)(i,e);var t=Object(f.a)(i);function i(e,r,n){var s;return Object(a.a)(this,i),(s=t.call(this,e,!0,!0))._walker=new S,s._walker.updateTolerance(n),s._angleToLine=void 0===r.angleToLine||r.angleToLine,s._offset=void 0!==r.offset?r.offset*n:0,s._beginGap=void 0!==r.beginPosition?r.beginPosition*n:0,s._endGap=void 0!==r.endPosition?r.endPosition*n:0,s._flipFirst=void 0===r.flipFirst||r.flipFirst,s._pattern=new w,s._pattern.init(r.positionArray,!1,!1),s._subPathLen=0,s._posCount=s._pattern.size(),s._isFirst=!0,s._prevPos=0,s}return Object(n.a)(i,[{key:"processPath",value:function(e){if(this._pattern.isEmpty())return null;var t;if(this.iteratePath){var i=this._pattern.nextValue()*this._subPathLen,r=this._beginGap+i;t=r-this._prevPos,this._prevPos=r}else{if(this._posCount=this._pattern.size(),this._isFirst=!0,this._prevPos=0,this._subPathLen=this._walker.calculatePathLength(e)-this._beginGap-this._endGap,this._subPathLen<0)return this.iteratePath=!1,null;if(!this._walker.init(e,this._pattern,!1))return null;this._pattern.reset();var a=this._pattern.nextValue()*this._subPathLen,n=this._beginGap+a;t=n-this._prevPos,this._prevPos=n,this.iteratePath=!0}var s={};if(!this._walker.nextPointAndAngle(t,s,1))return this.iteratePath=!1,null;this.internalPlacement.setTranslate(s.pt[0]+this._offset*s.sa,s.pt[1]-this._offset*s.ca);var o,l,h=this._isFirst&&this._flipFirst;return this._angleToLine?(o=s.ca,l=s.sa):(o=1,l=0),h&&(o=-o,l=-l),this.internalPlacement.setRotateCS(o,l),this._isFirst=!1,this._posCount--,0===this._posCount&&(this.iteratePath=!1),this.internalPlacement}}]),i}(l.b),ie=i(652);var re=function(){function e(){Object(a.a)(this,e)}return Object(n.a)(e,[{key:"execute",value:function(e,t,i){return new ae(e,t,i)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();re.instance=null;var ae=function(){function e(t,i,r){if(Object(a.a)(this,e),this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,this._currentX=0,this._currentY=0,this._stepX=(void 0!==i.stepX?Math.abs(i.stepX):16)*r,this._stepY=(void 0!==i.stepY?Math.abs(i.stepY):16)*r,0!==this._stepX&&0!==this._stepY&&t&&function(e){return void 0!==e.rings}(t)&&t.rings){if(this._gridType=void 0!==i.gridType?i.gridType:"Fixed","Random"===this._gridType)this._randomness=void 0!==i.randomness?i.randomness/100:1,this._gridAngle=0,this._shiftOddRows=!1,this._cosAngle=1,this._sinAngle=0,this._offsetX=0,this._offsetY=0;else{if(this._randomness=0,this._gridAngle=void 0!==i.gridAngle?i.gridAngle:0,this._shiftOddRows=void 0!==i.shiftOddRows&&i.shiftOddRows,this._offsetX=void 0!==i.offsetX?i.offsetX*r:0,this._offsetY=void 0!==i.offsetY?i.offsetY*r:0,this._cosAngle=Math.cos(this._gridAngle/180*Math.PI),this._sinAngle=-Math.sin(this._gridAngle/180*Math.PI),this._stepX)if(this._offsetX<0)for(;this._offsetX<-.5*this._stepX;)this._offsetX+=this._stepX;else for(;this._offsetX>=.5*this._stepX;)this._offsetX-=this._stepX;if(this._stepY)if(this._offsetY<0)for(;this._offsetY<-.5*this._stepY;)this._offsetY+=this._stepY;else for(;this._offsetY>=.5*this._stepY;)this._offsetY-=this._stepY}this._graphicOriginX=0,this._graphicOriginY=0,this._internalPlacement=new ie.a,this._calculateMinMax(t),this._geometry=t}}return Object(n.a)(e,[{key:"next",value:function(){return this._geometry?this._nextInside():null}},{key:"_calculateMinMax",value:function(e){var t,i,a,n,s,o,l,h;this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,s=o=Number.MAX_VALUE,l=h=-Number.MAX_VALUE;var c,u=Object(r.a)(e.rings);try{for(u.s();!(c=u.n()).done;)for(var f=c.value,y=f?f.length:0,d=0;d<y;++d)t=f[d][0]-this._graphicOriginX-this._offsetX,i=f[d][1]-this._graphicOriginY-this._offsetY,a=this._cosAngle*t-this._sinAngle*i,n=this._sinAngle*t+this._cosAngle*i,s=Math.min(s,a),l=Math.max(l,a),o=Math.min(o,n),h=Math.max(h,n)}catch(v){u.e(v)}finally{u.f()}s+=this._graphicOriginX,l+=this._graphicOriginX,o+=this._graphicOriginY,h+=this._graphicOriginY,this._xMin=Math.round(s/this._stepX),this._xMax=Math.round(l/this._stepX),this._yMin=Math.round(o/this._stepY),this._yMax=Math.round(h/this._stepY),this._currentX=this._xMax+1,this._currentY=this._yMin-1}},{key:"_nextInside",value:function(){for(;;){if(this._currentX>this._xMax){if(this._currentY++,this._currentY>this._yMax)return null;this._currentX=this._xMin,this._shiftOddRows&&this._currentY%2&&this._currentX--}var e=this._currentX*this._stepX+this._offsetX;this._shiftOddRows&&this._currentY%2&&(e+=.5*this._stepX);var t=this._currentY*this._stepY+this._offsetY,i=void 0,r=void 0;return this._currentX++,"Random"===this._gridType?(i=this._graphicOriginX+e+this._stepX*this._randomness*(.5-Math.random())*2/3,r=this._graphicOriginY+t+this._stepY*this._randomness*(.5-Math.random())*2/3):(i=this._graphicOriginX+this._cosAngle*e+this._sinAngle*t,r=this._graphicOriginY-this._sinAngle*e+this._cosAngle*t),this._internalPlacement.setTranslate(i,r),this._internalPlacement}}}]),e}(),ne=function(){function e(){Object(a.a)(this,e)}return Object(n.a)(e,[{key:"execute",value:function(e,t,i){return new se(e,t,i)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();ne.instance=null;var se=function(e){Object(u.a)(i,e);var t=Object(f.a)(i);function i(e,r,n){var s;return Object(a.a)(this,i),(s=t.call(this,e,!0,!0))._curveHelper=new v,s._angleToLine=void 0===r.angleToLine||r.angleToLine,s._offset=void 0!==r.offset?r.offset*n:0,s._relativeTo=r.relativeTo,s._position=void 0!==r.startPointOffset?r.startPointOffset*n:0,s._epsilon=.001*n,s}return Object(n.a)(i,[{key:"processPath",value:function(e){var t=this._position;if("SegmentMidpoint"===this._relativeTo){for(this.iteratePath||(this._segmentCount=e.length,this._curSegment=1,this.iteratePath=!0);this._curSegment<this._segmentCount;){var i=this._curSegment;this._curSegment++;var r=e[i-1],a=e[i],n=this._curveHelper.calculateLength(r,a);if(!(n<this._epsilon)){var s=.5+this._position/n,o=this._curveHelper.getAngleCS(r,a,s),h=Object(k.a)(o,2),c=h[0],u=h[1],f=Object(l.e)(r,a,s);return this.internalPlacement.setTranslate(f[0]-this._offset*u,f[1]+this._offset*c),this._angleToLine&&this.internalPlacement.setRotateCS(c,u),this.internalPlacement}}return this.iteratePath=!1,null}"LineEnd"===this._relativeTo&&Object(l.i)(e);var y=this.onLine(e,t);return"LineEnd"===this._relativeTo&&Object(l.i)(e),y}},{key:"onLine",value:function(e,t){var i,r=!1;switch(this._relativeTo){default:i=this._curveHelper.calculatePathLength(e)/2+t;break;case"LineBeginning":i=t;break;case"LineEnd":i=t,r=!0}for(var a,n=e.length,s=0,o=e[0],h=1;h<n;++h){a=o,o=e[h];var c=this._curveHelper.calculateLength(a,o);if(s+c>i){var u=(i-s)/c,f=this._curveHelper.getAngleCS(a,o,u),y=Object(k.a)(f,2),d=y[0],v=y[1],p=Object(l.e)(a,o,u),_=r?this._offset:-this._offset;return this.internalPlacement.setTranslate(p[0]-_*v,p[1]+_*d),this._angleToLine&&(r?this.internalPlacement.setRotateCS(-d,-v):this.internalPlacement.setRotateCS(d,v)),this.internalPlacement}s+=c}return null}}]),i}(l.b),oe=function(){function e(){Object(a.a)(this,e)}return Object(n.a)(e,[{key:"execute",value:function(e,t,i){return new le(e,t,i)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();oe.instance=null;var le=function(e){Object(u.a)(i,e);var t=Object(f.a)(i);function i(e,r,n){var s;return Object(a.a)(this,i),(s=t.call(this,e,!0,!0))._curveHelper=new v,s._angleToLine=void 0===r.angleToLine||r.angleToLine,s._offset=void 0!==r.offset?r.offset*n:0,s._endPoints=void 0===r.placeOnEndPoints||r.placeOnEndPoints,s._controlPoints=void 0===r.placeOnControlPoints||r.placeOnControlPoints,s._regularVertices=void 0===r.placeOnRegularVertices||r.placeOnRegularVertices,s._tags=[],s._tagIterator=0,s}return Object(n.a)(i,[{key:"processPath",value:function(e){if(this.iteratePath||(this._preparePath(e),this.iteratePath=!0),this._tagIterator>=this._tags.length)return this._tags.length=0,this._tagIterator=0,this.iteratePath=!1,null;var t=this._tags[this._tagIterator];this._angleToLine&&this.internalPlacement.setRotate(t[2]);var i=t[0],r=t[1];if(0!==this._offset){var a=Math.cos(t[2]),n=Math.sin(t[2]);i-=this._offset*n,r+=this._offset*a}return this.internalPlacement.setTranslate(i,r),this._tagIterator++,this.internalPlacement}},{key:"_preparePath",value:function(e){this._tags.length=0,this._tagIterator=0;for(var t,i,r=Object(l.g)(e),a=e.length-1,n=0,s=0,o=0,h=0,c=0;n<a;){t=e[++n-1],i=e[n];var u=Object(l.f)(t),f=Object(l.f)(i);(this._angleToLine||0!==this._offset)&&(h=this._curveHelper.getAngle(t,i,0)),1===n?r?(s=h,o=u):this._endPoints&&this._tags.push([t[0],t[1],h]):1===u?this._controlPoints&&this._tags.push([t[0],t[1],he(c,h)]):this._regularVertices&&this._tags.push([t[0],t[1],he(c,h)]),(this._angleToLine||0!==this._offset)&&(c=this._curveHelper.getAngle(t,i,1)),n===a&&(r?1===f||1===o?this._controlPoints&&this._tags.push([i[0],i[1],he(c,s)]):this._regularVertices&&this._tags.push([i[0],i[1],he(c,s)]):this._endPoints&&this._tags.push([i[0],i[1],c]))}this._tagIterator=0}}]),i}(l.b);function he(e,t){for(var i=Math.PI;Math.abs(t-e)>i+2e-15;)t-e>i?t-=2*i:t+=2*i;return(e+t)/2}var ce=function(){function e(){Object(a.a)(this,e)}return Object(n.a)(e,[{key:"execute",value:function(e,t,i){return new ue(e,t,i)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();ce.instance=null;var ue=function(){function e(t,i,r){Object(a.a)(this,e),this._geometry=t,this._offsetX=void 0!==i.offsetX?i.offsetX*r:0,this._offsetY=void 0!==i.offsetY?i.offsetY*r:0,this._method=void 0!==i.method?i.method:"OnPolygon",this._internalPlacement=new ie.a}return Object(n.a)(e,[{key:"next",value:function(){var e=this._geometry;return this._geometry=null,e&&function(e){return void 0!==e.rings}(e)?this._polygonCenter(e):null}},{key:"_polygonCenter",value:function(e){this._method;var t=Object(E.h)();return Object(U.a)(t,e),this._internalPlacement.setTranslate((t[2]+t[0])/2+this._offsetX,(t[3]+t[1])/2-this._offsetY),!0?this._internalPlacement:null}}]),e}();function fe(e){if(!e)return null;switch(e.type){case"CIMGeometricEffectAddControlPoints":return h.local();case"CIMGeometricEffectArrow":return _.local();case"CIMGeometricEffectBuffer":return g.local();case"CIMGeometricEffectCut":return O.local();case"CIMGeometricEffectDashes":return C.local();case"CIMGeometricEffectDonut":return I.local();case"CIMGeometricEffectJog":return L.local();case"CIMGeometricEffectMove":return A.local();case"CIMGeometricEffectOffset":return V.local();case"CIMGeometricEffectReverse":return B.local();case"CIMGeometricEffectRotate":return H.local();case"CIMGeometricEffectScale":return G.local();case"CIMGeometricEffectWave":return X.local()}return null}function ye(e){if(!e)return null;switch(e.type){case"CIMMarkerPlacementAlongLineSameSize":return Q.local();case"CIMMarkerPlacementAtExtremities":return Z.local();case"CIMMarkerPlacementAtRatioPositions":return ee.local();case"CIMMarkerPlacementInsidePolygon":return re.local();case"CIMMarkerPlacementOnLine":return ne.local();case"CIMMarkerPlacementOnVertices":return oe.local();case"CIMMarkerPlacementPolygonCenter":return ce.local()}return null}},671:function(e,t,i){"use strict";i.d(t,"a",(function(){return u}));var r=i(20),a=i(2),n=i(4),s=i(6),o=i(7),l=i(240),h=i(675),c=i(138),u=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e,r,n,s,o){var l,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:s,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:o;return Object(a.a)(this,i),(l=t.call(this)).triangleCountReportedInDebug=0,l.triangleCount=0,l.texture=null,l.key=new c.a(e),l.x=r,l.y=n,l.width=s,l.height=o,l.rangeX=h,l.rangeY=u,l}return Object(n.a)(i,[{key:"destroy",value:function(){this.texture&&(this.texture.dispose(),this.texture=null)}},{key:"setTransform",value:function(e,t){var i=t/(e.resolution*e.pixelRatio),a=this.transforms.tileMat3,n=e.toScreenNoRotation([0,0],[this.x,this.y]),s=Object(r.a)(n,2),o=s[0],h=s[1],c=this.width/this.rangeX*i,u=this.height/this.rangeY*i;Object(l.k)(a,c,0,0,0,u,0,o,h,1),Object(l.h)(this.transforms.dvs,e.displayViewMat3,a)}}]),i}(h.a)},673:function(e,t,i){"use strict";i.d(t,"a",(function(){return b}));var r=i(2),a=i(4),n=i(6),s=i(7),o=i(0),l=i(33),h=i(105),c=i(136),u=i(325),f=i(15),y=i(11),d=i(156),v=i(1),p=(i(16),i(18),i(10)),_=function(e){Object(n.a)(i,e);var t=Object(s.a)(i);function i(e){var a;return Object(r.a)(this,i),(a=t.call(this,e)).layer=null,a.parent=null,a}return Object(a.a)(i,[{key:"initialize",value:function(){var e=this;this.when().catch((function(t){if("layerview:create-error"!==t.name){var i=e.layer&&e.layer.id||"no id",r=e.layer&&e.layer.title||"no title";throw f.a.getLogger(e.declaredClass).error("#resolve()","Failed to resolve layer view (layer title: '".concat(r,"', id: '").concat(i,"')"),t),t}}))}},{key:"fullOpacity",get:function(){return Object(y.r)(this.get("layer.opacity"),1)*Object(y.r)(this.get("parent.fullOpacity"),1)}},{key:"suspended",get:function(){return!this.canResume()}},{key:"suspendInfo",get:function(){return this.getSuspendInfo()}},{key:"legendEnabled",get:function(){return!this.suspended&&!0===this.layer.legendEnabled}},{key:"updating",get:function(){return!!(this.updatingHandles&&this.updatingHandles.updating||this.isUpdating())}},{key:"updatingProgress",get:function(){return this.updating?0:1}},{key:"visible",get:function(){return!0===this.get("layer.visible")},set:function(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")}},{key:"canResume",value:function(){return!this.get("parent.suspended")&&this.get("view.ready")&&this.get("layer.loaded")&&this.visible||!1}},{key:"getSuspendInfo",value:function(){var e=this.parent&&this.parent.suspended?this.parent.suspendInfo:{};return this.view&&this.view.ready||(e.viewNotReady=!0),this.layer&&this.layer.loaded||(e.layerNotLoaded=!0),this.visible||(e.layerInvisible=!0),e}},{key:"isUpdating",value:function(){return!1}}]),i}(Object(c.b)(Object(u.a)(Object(d.b)(h.a.EventedMixin(l.a)))));Object(o.a)([Object(v.b)()],_.prototype,"fullOpacity",null),Object(o.a)([Object(v.b)()],_.prototype,"layer",void 0),Object(o.a)([Object(v.b)()],_.prototype,"parent",void 0),Object(o.a)([Object(v.b)({readOnly:!0})],_.prototype,"suspended",null),Object(o.a)([Object(v.b)({readOnly:!0})],_.prototype,"suspendInfo",null),Object(o.a)([Object(v.b)({readOnly:!0})],_.prototype,"legendEnabled",null),Object(o.a)([Object(v.b)({type:Boolean,readOnly:!0})],_.prototype,"updating",null),Object(o.a)([Object(v.b)({readOnly:!0})],_.prototype,"updatingProgress",null),Object(o.a)([Object(v.b)()],_.prototype,"visible",null);var b=_=Object(o.a)([Object(p.a)("esri.views.layers.LayerView")],_)},674:function(e,t,i){"use strict";i.d(t,"a",(function(){return L}));var r,a=i(2),n=i(4),s=i(46),o=i(42),l=i(6),h=i(7),c=i(0),u=i(36),f=i(133),y=i(31),d=i(1),v=(i(16),i(18),i(15),i(10)),p=i(704),_=function(e){Object(l.a)(i,e);var t=Object(h.a)(i);function i(){return Object(a.a)(this,i),t.apply(this,arguments)}return i}(i(24).a),b=_=Object(c.a)([Object(v.a)("esri.views.layers.support.ClipArea")],_),g=r=function(e){Object(l.a)(i,e);var t=Object(h.a)(i);function i(){var e;return Object(a.a)(this,i),(e=t.apply(this,arguments)).type="rect",e.left=null,e.right=null,e.top=null,e.bottom=null,e}return Object(n.a)(i,[{key:"clone",value:function(){return new r({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}},{key:"version",get:function(){return(this._get("version")||0)+1}}]),i}(b);Object(c.a)([Object(d.b)({type:[Number,String],json:{write:!0}})],g.prototype,"left",void 0),Object(c.a)([Object(d.b)({type:[Number,String],json:{write:!0}})],g.prototype,"right",void 0),Object(c.a)([Object(d.b)({type:[Number,String],json:{write:!0}})],g.prototype,"top",void 0),Object(c.a)([Object(d.b)({type:[Number,String],json:{write:!0}})],g.prototype,"bottom",void 0),Object(c.a)([Object(d.b)({readOnly:!0})],g.prototype,"version",null);var m,O=g=r=Object(c.a)([Object(v.a)("esri.views.layers.support.ClipRect")],g),x=(i(81),i(109)),k=i(73),j=i(51),w=i(119),P={base:x.a,key:"type",typeMap:{extent:j.a,polygon:w.a}},S=m=function(e){Object(l.a)(i,e);var t=Object(h.a)(i);function i(){var e;return Object(a.a)(this,i),(e=t.apply(this,arguments)).type="geometry",e.geometry=null,e}return Object(n.a)(i,[{key:"version",get:function(){return(this._get("version")||0)+1}},{key:"clone",value:function(){return new m({geometry:this.geometry.clone()})}}]),i}(b);Object(c.a)([Object(d.b)({types:P,json:{read:k.a,write:!0}})],S.prototype,"geometry",void 0),Object(c.a)([Object(d.b)({readOnly:!0})],S.prototype,"version",null);var C=S=m=Object(c.a)([Object(v.a)("esri.views.layers.support.Geometry")],S),M=function(e){Object(l.a)(i,e);var t=Object(h.a)(i);function i(){var e;return Object(a.a)(this,i),(e=t.apply(this,arguments)).type="path",e.path=[],e}return Object(n.a)(i,[{key:"version",get:function(){return(this._get("version")||0)+1}}]),i}(b);Object(c.a)([Object(d.b)({type:[[[Number]]],json:{write:!0}})],M.prototype,"path",void 0),Object(c.a)([Object(d.b)({readOnly:!0})],M.prototype,"version",null);var I=M=Object(c.a)([Object(v.a)("esri.views.layers.support.Path")],M),T=u.a.ofType({key:"type",base:b,typeMap:{rect:O,path:I,geometry:C}}),L=function(e){var t=function(e){Object(l.a)(i,e);var t=Object(h.a)(i);function i(){var e;return Object(a.a)(this,i),(e=t.apply(this,arguments)).clips=new T,e.moving=!1,e.attached=!1,e.lastUpdateId=-1,e.updateRequested=!1,e}return Object(n.a)(i,[{key:"initialize",value:function(){var e,t=this;this.container||(this.container=new p.a),this.container.fadeTransitionEnabled=!0,this.container.opacity=0,this.container.clips=this.clips,this.handles.add([Object(y.a)(this,"suspended",(function(e){t.container&&(t.container.visible=!e),t.view&&!e&&t.updateRequested&&t.view.requestUpdate()}),!0),Object(y.a)(this,["layer.opacity","container"],(function(){var e,i;t.container&&(t.container.opacity=null!=(e=null==(i=t.layer)?void 0:i.opacity)?e:1)}),!0),Object(y.a)(this,["layer.blendMode"],(function(e){t.container&&(t.container.blendMode=e)}),!0),Object(y.a)(this,["layer.effect"],(function(e){t.container&&(t.container.effect=e)}),!0),this.clips.on("change",(function(){t.container.clips=t.clips,t.notifyChange("clips")}))]),null!=(e=this.view)&&e.whenLayerView?this.view.whenLayerView(this.layer).then((function(e){e!==t||t.attached||t.destroyed||(t.attach(),t.requestUpdate(),t.attached=!0)}),(function(){})):this.when().then((function(){t.attached||t.destroyed||(t.attach(),t.requestUpdate(),t.attached=!0)}),(function(){}))}},{key:"destroy",value:function(){this.attached&&(this.detach(),this.attached=!1),this.handles.remove("initialize"),this.updateRequested=!1}},{key:"updating",get:function(){return!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())}},{key:"isVisibleAtScale",value:function(e){var t=!0,i=this.layer,r=i.minScale,a=i.maxScale;if(null!=r&&null!=a){var n=!r,s=!a;!n&&e<=r&&(n=!0),!s&&e>=a&&(s=!0),t=n&&s}return t}},{key:"requestUpdate",value:function(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())}},{key:"processUpdate",value:function(e){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",e),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(e))):this.updateRequested=!1}},{key:"isUpdating",value:function(){return!1}},{key:"isRendering",value:function(){return!1}},{key:"canResume",value:function(){return!!Object(s.a)(Object(o.a)(i.prototype),"canResume",this).call(this)&&this.isVisibleAtScale(this.view.scale)}}]),i}(e);return Object(c.a)([Object(d.b)({type:T,set:function(e){var t=Object(f.b)(e,this._get("clips"),T);this._set("clips",t)}})],t.prototype,"clips",void 0),Object(c.a)([Object(d.b)()],t.prototype,"moving",void 0),Object(c.a)([Object(d.b)()],t.prototype,"attached",void 0),Object(c.a)([Object(d.b)()],t.prototype,"container",void 0),Object(c.a)([Object(d.b)()],t.prototype,"suspended",void 0),Object(c.a)([Object(d.b)({readOnly:!0})],t.prototype,"updateParameters",void 0),Object(c.a)([Object(d.b)()],t.prototype,"updateRequested",void 0),Object(c.a)([Object(d.b)()],t.prototype,"updating",null),Object(c.a)([Object(d.b)()],t.prototype,"view",void 0),t=Object(c.a)([Object(v.a)("esri.views.2d.layers.LayerView2D")],t)}},676:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i(2),a=i(4),n=(i(23),function(){function e(t){Object(r.a)(this,e),this._geometry=t}return Object(a.a)(e,[{key:"next",value:function(){var e=this._geometry;return this._geometry=null,e}}]),e}())},677:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r=[1,256,65536,16777216],a=[1/256,1/65536,1/16777216,1/4294967296],n=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=0,r=0;r<4;r++)i+=e[t+r]*a[r];return i}(new Uint8ClampedArray([255,255,255,255]));function s(e,t){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=o(e,0,n),s=0;s<4;s++)t[i+s]=Math.floor(256*l(a*r[s]))}function o(e,t,i){return e<t?t:e>i?i:e}function l(e){return e-Math.floor(e)}},680:function(e,t,i){"use strict";i.d(t,"a",(function(){return p}));var r=i(13),a=i(2),n=i(4),s=i(46),o=i(42),l=i(6),h=i(7),c=i(16),u=i(638),f=i(700),y=i(734),d=i(728),v=function(e,t){return e.key.level-t.key.level!=0?e.key.level-t.key.level:e.key.row-t.key.row!=0?e.key.row-t.key.row:e.key.col-t.key.col},p=function(e){Object(l.a)(i,e);var t=Object(h.a)(i);function i(e){var r;return Object(a.a)(this,i),(r=t.call(this))._tileInfoView=e,r}return Object(n.a)(i,[{key:"requiresDedicatedFBO",get:function(){return!1}},{key:"renderChildren",value:function(e){this.sortChildren(v),this.setStencilReference(),Object(s.a)(Object(o.a)(i.prototype),"renderChildren",this).call(this,e)}},{key:"createRenderParams",value:function(e){var t=e.state,r=Object(s.a)(Object(o.a)(i.prototype),"createRenderParams",this).call(this,e);return r.requiredLevel=this._tileInfoView.getClosestInfoForScale(t.scale).level,r.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(t.scale),r}},{key:"prepareRenderPasses",value:function(e){var t=this,r=Object(s.a)(Object(o.a)(i.prototype),"prepareRenderPasses",this).call(this,e);return r.push(e.registerRenderPass({name:"stencil",brushes:[d.a],drawPhase:u.c.DEBUG|u.c.MAP|u.c.HIGHLIGHT,target:function(){return t.getStencilTarget()}})),Object(c.a)("esri-tiles-debug")&&r.push(e.registerRenderPass({name:"tileInfo",brushes:[y.a],drawPhase:u.c.DEBUG,target:function(){return t.children}})),r}},{key:"getStencilTarget",value:function(){return this.children}},{key:"updateTransforms",value:function(e){var t,i=Object(r.a)(this.children);try{for(i.s();!(t=i.n()).done;){var a=t.value,n=this._tileInfoView.getTileResolution(a.key);a.setTransform(e,n)}}catch(s){i.e(s)}finally{i.f()}}},{key:"setStencilReference",value:function(){var e,t=1,i=Object(r.a)(this.children);try{for(i.s();!(e=i.n()).done;){e.value.stencilRef=t++}}catch(a){i.e(a)}finally{i.f()}}}]),i}(f.a)},685:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i(2),a=i(4),n=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Object(r.a)(this,e),this.x=t,this.y=i,this.width=a,this.height=n}return Object(a.a)(e,[{key:"isEmpty",get:function(){return this.width<=0||this.height<=0}},{key:"union",value:function(e){this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.width=Math.max(this.width,e.width),this.height=Math.max(this.height,e.height)}}]),e}()},714:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r=i(2),a=i(4),n=i(11),s=function(){function e(t,i,a){Object(r.a)(this,e),this.pixelBlock=t,this.extent=i,this.originalPixelBlock=a}return Object(a.a)(e,[{key:"width",get:function(){return Object(n.j)(this.pixelBlock)?this.pixelBlock.width:0}},{key:"height",get:function(){return Object(n.j)(this.pixelBlock)?this.pixelBlock.height:0}},{key:"render",value:function(e){var t=this.pixelBlock;if(!Object(n.i)(t)){var i=this.filter({pixelBlock:t});if(!Object(n.i)(i.pixelBlock)){var r=i.pixelBlock.getAsRGBA(),a=e.createImageData(i.pixelBlock.width,i.pixelBlock.height);a.data.set(r),e.putImageData(a,0,0)}}}},{key:"getRenderedRasterPixels",value:function(){var e=this.filter({pixelBlock:this.pixelBlock});return Object(n.i)(e.pixelBlock)?null:{width:e.pixelBlock.width,height:e.pixelBlock.height,renderedRasterPixels:new Uint8Array(e.pixelBlock.getAsRGBA().buffer)}}}]),e}()},721:function(e,t,i){"use strict";i.d(t,"a",(function(){return g}));var r=i(20),a=i(2),n=i(4),s=i(17),o=i(46),l=i(42),h=i(6),c=i(7),u=i(11),f=i(240),y=i(321),d=i(397),v=(i(648),i(649),i(16),i(647),i(646),i(653),i(651),i(645)),p=(i(650),i(675)),_=i(714);function b(e,t,i){var r={target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071};return t&&i&&(r.width=t,r.height=i),new v.a(e,r)}var g=function(e){Object(h.a)(i,e);var t=Object(c.a)(i);function i(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1?arguments[1]:void 0,o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return Object(a.a)(this,i),(e=t.call(this)).requestRenderOnSourceChangedEnabled=o,e._textureInvalidated=!0,e.stencilRef=0,e.coordScale=[1,1],e._height=void 0,e.pixelRatio=1,e.resolution=0,e.rotation=0,e._source=null,e._width=void 0,e.x=0,e.y=0,e.blendFunction=n,e.source=r,e.requestRender=e.requestRender.bind(Object(s.a)(e)),e}return Object(n.a)(i,[{key:"destroy",value:function(){this._texture&&(this._texture.dispose(),this._texture=null)}},{key:"isSourceScaled",get:function(){return this.width!==this.sourceWidth||this.height!==this.sourceHeight}},{key:"height",get:function(){return void 0!==this._height?this._height:this.sourceHeight},set:function(e){this._height=e}},{key:"source",get:function(){return this._source},set:function(e){this._source=e,this.invalidateTexture()}},{key:"sourceHeight",get:function(){return this._source instanceof HTMLImageElement?this._source.naturalHeight:this._source.height}},{key:"sourceWidth",get:function(){return this._source instanceof HTMLImageElement?this._source.naturalWidth:this._source.width}},{key:"width",get:function(){return void 0!==this._width?this._width:this.sourceWidth},set:function(e){this._width=e}},{key:"beforeRender",value:function(e){Object(o.a)(Object(l.a)(i.prototype),"beforeRender",this).call(this,e),this.updateTexture(e.context)}},{key:"invalidateTexture",value:function(){this._textureInvalidated||(this._textureInvalidated=!0,this.requestRenderOnSourceChangedEnabled&&this.requestRender())}},{key:"_createTransforms",value:function(){return{dvs:Object(y.b)()}}},{key:"setTransform",value:function(e){var t=Object(f.b)(this.transforms.dvs),i=e.toScreenNoRotation([0,0],[this.x,this.y]),a=Object(r.a)(i,2),n=a[0],s=a[1],o=this.resolution/this.pixelRatio/e.resolution,l=o*this.width,h=o*this.height,c=Math.PI*this.rotation/180;Object(f.c)(t,t,Object(d.b)(n,s)),Object(f.c)(t,t,Object(d.b)(l/2,h/2)),Object(f.j)(t,t,-c),Object(f.c)(t,t,Object(d.b)(-l/2,-h/2)),Object(f.g)(t,t,Object(d.b)(l,h)),Object(f.h)(this.transforms.dvs,e.displayViewMat3,t)}},{key:"setSamplingProfile",value:function(e){this._texture&&(e.mips&&!this._texture.descriptor.hasMipmap&&this._texture.generateMipmap(),this._texture.setSamplingMode(e.samplingMode))}},{key:"bind",value:function(e,t){this._texture&&e.bindTexture(this._texture,t)}},{key:"updateTexture",value:function(e){var t;if(!this.stage)return null==(t=this._texture)||t.dispose(),void(this._texture=null);if(this._textureInvalidated){this._textureInvalidated=!1,this._texture||(this.source?this._texture=b(e,this.sourceWidth,this.sourceHeight):this._texture=b(e));var i,r=this.source;if(r){if(this._texture.resize(this.sourceWidth,this.sourceHeight),(i=r)&&"render"in i)if(r instanceof _.a){var a=r.getRenderedRasterPixels();this._texture.setData(Object(u.j)(a)?a.renderedRasterPixels:null)}else this._texture.setData(function(e){var t=document.createElement("canvas");return t.width=e.width,t.height=e.height,e.render(t.getContext("2d")),t}(r));else(function(e){return e&&!("render"in e)})(r)&&this._texture.setData(r);this.ready()}else this._texture.setData(null)}}},{key:"onAttach",value:function(){this.invalidateTexture()}},{key:"onDetach",value:function(){this.invalidateTexture()}}]),i}(p.a)},746:function(e,t,i){"use strict";i.d(t,"a",(function(){return f}));var r=i(29),a=i(2),n=i(4),s=i(46),o=i(42),l=i(6),h=i(7),c=i(739),u=i(638),f=function(e){Object(l.a)(i,e);var t=Object(h.a)(i);function i(){return Object(a.a)(this,i),t.apply(this,arguments)}return Object(n.a)(i,[{key:"requiresDedicatedFBO",get:function(){return this.children.some((function(e){return"additive"===e.blendFunction}))}},{key:"prepareRenderPasses",value:function(e){var t=this,a=e.registerRenderPass({name:"bitmap",brushes:[c.a.bitmap],target:function(){return t.children},drawPhase:u.c.MAP});return[].concat(Object(r.a)(Object(s.a)(Object(o.a)(i.prototype),"prepareRenderPasses",this).call(this,e)),[a])}}]),i}(i(700).a)}}]);
//# sourceMappingURL=54.e4466aa6.chunk.js.map