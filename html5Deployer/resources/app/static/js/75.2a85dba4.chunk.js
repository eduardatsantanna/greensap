(this["webpackJsonpgreen-sap"]=this["webpackJsonpgreen-sap"]||[]).push([[75],{764:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return S}));var n=r(8),i=r.n(n),a=r(14),s=r(13),u=r(2),o=r(4),l=r(22),c=r(15),f=r(11),h=r(94),p=r(320),d=r(918),b=r(829),y=r(778),v=r(99),m=r(933),O=c.a.getLogger("esri.views.2d.layers.features.support.whereUtils"),j={getAttribute:function(e,t){return e.field(t)}};function g(e,t){return w.apply(this,arguments)}function w(){return(w=Object(a.a)(i.a.mark((function e(t,n){var a,s,u;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.e(4).then(r.bind(null,748));case 2:return a=e.sent,e.prev=3,(s=a.WhereClause.create(t,n)).isStandardized||(u=new l.a("mapview - bad input","Unable to apply filter's definition expression, as expression is not standardized.",s),O.error(u)),e.abrupt("return",(function(e){var t=e.readArcadeFeature();return s.testFeature(t,j)}));case 9:return e.prev=9,e.t0=e.catch(3),e.abrupt("return",(O.warn("mapview-bad-where-clause","Encountered an error when evaluating where clause",t),function(e){return!0}));case 12:case"end":return e.stop()}}),e,null,[[3,9]])})))).apply(this,arguments)}var _=c.a.getLogger("esri.views.2d.layers.features.controllers.FeatureFilter"),S=function(){function e(t){Object(u.a)(this,e),this._geometryBounds=Object(h.h)(),this._idToVisibility=new Map,this._serviceInfo=t}return Object(o.a)(e,[{key:"hash",get:function(){return this._hash}},{key:"check",value:function(e){return this._applyFilter(e)}},{key:"clear",value:function(){var e=this._resetAllHiddenIds();return this.update(),{show:e,hide:[]}}},{key:"invalidate",value:function(){var e=this;this._idToVisibility.forEach((function(t,r){e._idToVisibility.set(r,0)}))}},{key:"setKnownIds",value:function(e){var t,r=Object(s.a)(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;this._idToVisibility.set(n,1)}}catch(i){r.e(i)}finally{r.f()}}},{key:"setTrue",value:function(e){var t=this,r=[],n=[],i=new Set(e);return this._idToVisibility.forEach((function(e,a){var s=!!(1&t._idToVisibility.get(a)),u=i.has(a);!s&&u?r.push(a):s&&!u&&n.push(a),t._idToVisibility.set(a,u?3:0)})),{show:r,hide:n}}},{key:"createQuery",value:function(){var e=this.geometry,t=this.spatialRel,r=this.where,n=this.timeExtent,i=this.objectIds;return v.a.fromJSON({geometry:e,spatialRel:t,where:r,timeExtent:n,objectIds:i})}},{key:"update",value:function(){var e=Object(a.a)(i.a.mark((function e(t,r){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._hash=JSON.stringify(t),e.next=3,Object(y.e)(t,null,r);case 3:return n=e.sent,e.next=6,Promise.all([this._setGeometryFilter(n),this._setIdFilter(n),this._setAttributeFilter(n),this._setTimeFilter(n)]);case 6:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_setAttributeFilter",value:function(){var e=Object(a.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&t.where){e.next=2;break}return e.abrupt("return",(this._clause=null,void(this.where=null)));case 2:return e.next=4,g(t.where,this._serviceInfo.fieldsIndex);case 4:this._clause=e.sent,this.where=t.where;case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_setIdFilter",value:function(e){this._idsToShow=e&&e.objectIds&&new Set(e.objectIds),this._idsToHide=e&&e.hiddenIds&&new Set(e.hiddenIds),this.objectIds=e&&e.objectIds}},{key:"_setGeometryFilter",value:function(){var e=Object(a.a)(i.a.mark((function e(t){var r,n,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&t.geometry){e.next=2;break}return e.abrupt("return",(this._spatialQueryOperator=null,this.geometry=null,void(this.spatialRel=null)));case 2:return r=t.geometry,n=t.spatialRel||"esriSpatialRelIntersects",e.next=6,Object(d.c)(n,r,this._serviceInfo.geometryType,this._serviceInfo.hasZ,this._serviceInfo.hasM);case 6:a=e.sent,Object(p.a)(this._geometryBounds,r),this._spatialQueryOperator=a,this.geometry=r,this.spatialRel=n;case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_setTimeFilter",value:function(e){if(this.timeExtent=this._timeOperator=null,e&&e.timeExtent)if(this._serviceInfo.timeInfo)this.timeExtent=e.timeExtent,this._timeOperator=Object(b.b)(this._serviceInfo.timeInfo,e.timeExtent,m.b);else{var t=new l.a("feature-layer-view:time-filter-not-available","Unable to apply time filter, as layer doesn't have time metadata.",e.timeExtent);_.error(t)}}},{key:"_applyFilter",value:function(e){return this._filterByGeometry(e)&&this._filterById(e)&&this._filterByTime(e)&&this._filterByExpression(e)}},{key:"_filterByExpression",value:function(e){return!this.where||this._clause(e)}},{key:"_filterById",value:function(e){return(!this._idsToHide||!this._idsToHide.size||!this._idsToHide.has(e.getObjectId()))&&(!this._idsToShow||!this._idsToShow.size||this._idsToShow.has(e.getObjectId()))}},{key:"_filterByGeometry",value:function(e){if(!this.geometry)return!0;var t=e.readHydratedGeometry();return!!t&&this._spatialQueryOperator(t)}},{key:"_filterByTime",value:function(e){return!Object(f.j)(this._timeOperator)||this._timeOperator(e)}},{key:"_resetAllHiddenIds",value:function(){var e=this,t=[];return this._idToVisibility.forEach((function(r,n){1&r||(e._idToVisibility.set(n,1),t.push(n))})),t}}]),e}()},778:function(e,t,r){"use strict";r.d(t,"a",(function(){return v})),r.d(t,"b",(function(){return E})),r.d(t,"c",(function(){return _})),r.d(t,"d",(function(){return S})),r.d(t,"e",(function(){return x})),r.d(t,"f",(function(){return w}));var n=r(8),i=r.n(n),a=r(14),s=r(39),u=r(11),o=r(61),l=r(333),c=r(73),f=r(324),h=r(43),p=(r(692),r(396)),d=r(137),b=r(681),y=new s.a({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),v=Object.freeze({}),m=new d.a,O=new d.a,j=new d.a,g={esriGeometryPoint:p.m,esriGeometryPolyline:p.o,esriGeometryPolygon:p.n,esriGeometryMultipoint:p.l};function w(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.hasZ,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:e.hasM;if(Object(u.i)(t))return null;var a=e.hasZ&&n,s=e.hasM&&i;if(r){var o=Object(p.u)(j,t,e.hasZ,e.hasM,"esriGeometryPoint",r,n,i);return Object(p.m)(o,a,s)}return Object(p.m)(t,a,s)}function _(e,t,r,n,i,a){var s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:t,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:r,l=t&&s,c=r&&o,f=Object(u.j)(n)?"coords"in n?n:n.geometry:null;if(Object(u.i)(f))return null;if(i){var h=Object(p.q)(O,f,t,r,e,i,s,o);return a&&(h=Object(p.u)(j,h,l,c,e,a)),g[e](h,l,c)}if(a){var d=Object(p.u)(j,f,t,r,e,a,s,o);return g[e](d,l,c)}return Object(p.x)(m,f,t,r,s,o),g[e](m,l,c)}function S(e,t,r){return R.apply(this,arguments)}function R(){return(R=Object(a.a)(i.a.mark((function e(t,r,n){var a,s,u,o,l,c,f,h;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.outFields,s=t.orderByFields,u=t.groupByFieldsForStatistics,o=t.outStatistics,a)for(l=0;l<a.length;l++)a[l]=a[l].trim();if(s)for(c=0;c<s.length;c++)s[c]=s[c].trim();if(u)for(f=0;f<u.length;f++)u[f]=u[f].trim();if(o)for(h=0;h<o.length;h++)o[h].onStatisticField&&(o[h].onStatisticField=o[h].onStatisticField.trim());return e.abrupt("return",(t.geometry&&!t.outSR&&(t.outSR=t.geometry.spatialReference),x(t,r,n)));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e,t,r){return I.apply(this,arguments)}function I(){return(I=Object(a.a)(i.a.mark((function e(t,r,n){var a,s,o,h,p,d;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",null);case 2:if(a=t.where,t.where=a=a&&a.trim(),(!a||/^1 *= *1$/.test(a)||r&&r===a)&&(t.where=null),t.geometry){e.next=5;break}return e.abrupt("return",t);case 5:return e.next=7,k(t);case 7:return s=e.sent,t.distance=0,t.units=null,"esriSpatialRelEnvelopeIntersects"===t.spatialRel&&(o=t.geometry.spatialReference,(s=Object(l.a)(s)).spatialReference=o),t.geometry=s,e.next=12,Object(b.a)(s.spatialReference,n);case 12:return e.next=14,Object(f.a)(Object(c.a)(s));case 14:if(h=e.sent[0],!Object(u.i)(h)){e.next=17;break}throw v;case 17:return p=h.toJSON(),e.next=20,Object(b.b)(p,p.spatialReference,n);case 20:if(d=e.sent){e.next=23;break}throw v;case 23:return e.abrupt("return",(d.spatialReference=n,t.geometry=d,t));case 24:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return T.apply(this,arguments)}function T(){return(T=Object(a.a)(i.a.mark((function e(t){var r,n,a,s,u,l;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.geometry,n=t.distance,a=t.units,null!=n&&!("vertexAttributes"in r)){e.next=3;break}return e.abrupt("return",r);case 3:if(s=r.spatialReference,u=a?y.fromJSON(a):Object(o.f)(s),!s||!Object(h.h)(s)&&!Object(h.p)(s)){e.next=9;break}e.t0=r,e.next=12;break;case 9:return e.next=11,Object(b.a)(s,h.b).then((function(){return Object(b.b)(r,h.b)}));case 11:e.t0=e.sent;case 12:return l=e.t0,e.next=15,F();case 15:return e.t1=e.sent,e.abrupt("return",(0,e.t1)(l.spatialReference,l,n,u));case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(){return G.apply(this,arguments)}function G(){return(G=Object(a.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([r.e(7),r.e(20)]).then(r.bind(null,807));case 2:return e.abrupt("return",e.sent.geodesicBuffer);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(e){return e&&N in e?JSON.parse(JSON.stringify(e,P)):e}var N="_geVersion",P=function(e,t){return e!==N?t:void 0}},829:function(e,t,r){"use strict";function n(e,t){if(!e)return null;var r=t.featureAdapter,n=e.startTimeField,i=e.endTimeField,a=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;if(n&&i)t.forEach((function(e){var t=r.getAttribute(e,n),u=r.getAttribute(e,i);null==t||isNaN(t)||(a=Math.min(a,t)),null==u||isNaN(u)||(s=Math.max(s,u))}));else{var u=n||i;t.forEach((function(e){var t=r.getAttribute(e,u);null==t||isNaN(t)||(a=Math.min(a,t),s=Math.max(s,t))}))}return{start:a,end:s}}function i(e,t,r){if(!t||!e)return null;var n=e.startTimeField,i=e.endTimeField;if(!n&&!i)return null;var a=t.start,s=t.end;return null===a&&null===s?null:void 0===a&&void 0===s?function(){return!1}:n&&i?function(e,t,r,n,i){return null!=n&&null!=i?function(a){var s=e.getAttribute(a,t),u=e.getAttribute(a,r);return(null==s||s<=i)&&(null==u||u>=n)}:null!=n?function(t){var i=e.getAttribute(t,r);return null==i||i>=n}:null!=i?function(r){var n=e.getAttribute(r,t);return null==n||n<=i}:void 0}(r,n,i,a,s):function(e,t,r,n){return null!=r&&null!=n&&r===n?function(n){return e.getAttribute(n,t)===r}:null!=r&&null!=n?function(i){var a=e.getAttribute(i,t);return a>=r&&a<=n}:null!=r?function(n){return e.getAttribute(n,t)>=r}:null!=n?function(r){return e.getAttribute(r,t)<=n}:void 0}(r,n||i,a,s)}r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return i}))},918:function(e,t,r){"use strict";r.d(t,"a",(function(){return F})),r.d(t,"b",(function(){return k})),r.d(t,"c",(function(){return I}));var n=r(8),i=r.n(n),a=r(13),s=r(14),u=r(22),o=r(112),l=r(323);var c=r(73),f=r(43);function h(e,t){return e?t?4:3:t?3:2}function p(e,t,r,n,i){if(!e)return!1;var s,u=h(t,r),o=e.coords,l=e.lengths,c=!1,f=0,p=Object(a.a)(l);try{for(p.s();!(s=p.n()).done;){var b=s.value;c=d(c,o,u,f,b,n,i),f+=b*u}}catch(y){p.e(y)}finally{p.f()}return c}function d(e,t,r,n,i,a,s){for(var u=e,o=n,l=n,c=n+i*r;l<c;l+=r){(o=l+r)===c&&(o=n);var f=t[l],h=t[l+1],p=t[o],d=t[o+1];(h<s&&d>=s||d<s&&h>=s)&&f+(s-h)/(d-h)*(p-f)<a&&(u=!u)}return u}var b=r(396),y=r(137),v=r(681),m=r(778),O="feature-store:unsupported-query",j={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},g={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},w={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},_={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1};function S(e){return!0===g[e]}function R(e){return!0===w[Object(c.c)(e)]}function x(e){return!0===_[e]}function I(e,t,n,i,a){if(Object(c.g)(t)&&"esriGeometryPoint"===n&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e)){var s=Object(b.g)(new y.a,t,!1,!1);return Promise.resolve((function(e){return function(e,t,r,n){return p(e,t,r,n.coords[0],n.coords[1])}(s,!1,!1,e)}))}if(Object(c.g)(t)&&"esriGeometryMultipoint"===n){var u=Object(b.g)(new y.a,t,!1,!1);if("esriSpatialRelContains"===e)return Promise.resolve((function(e){return function(e,t,r,n,i,a){var s=h(i,a),u=n.coords,o=n.lengths;if(!o)return!1;for(var l=0,c=0;l<o.length;l++,c+=s)if(!p(e,t,r,u[c],u[c+1]))return!1;return!0}(u,!1,!1,e,i,a)}))}if(Object(c.d)(t)&&"esriGeometryPoint"===n&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e))return Promise.resolve((function(e){return Object(o.e)(t,Object(m.c)(n,i,a,e))}));if(Object(c.d)(t)&&"esriGeometryMultipoint"===n&&"esriSpatialRelContains"===e)return Promise.resolve((function(e){return Object(o.d)(t,Object(m.c)(n,i,a,e))}));if(Object(c.d)(t)&&"esriSpatialRelIntersects"===e){var f=function(e){return"mesh"===e?l.a:Object(l.c)(e)}(n);return Promise.resolve((function(e){return f(t,Object(m.c)(n,i,a,e))}))}return Promise.all([r.e(7),r.e(20)]).then(r.bind(null,807)).then((function(r){var s=r[j[e]].bind(null,t.spatialReference,t);return function(e){return s(Object(m.c)(n,i,a,e))}}))}function k(e,t,r){return T.apply(this,arguments)}function T(){return(T=Object(s.a)(i.a.mark((function e(t,r,n){var a,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.spatialRel,!(s=t.geometry)){e.next=11;break}if(S(a)){e.next=4;break}throw new u.a(O,"Unsupported query spatial relationship",{query:t});case 4:if(!Object(f.l)(s.spatialReference)||!Object(f.l)(n)){e.next=11;break}if(R(s)){e.next=7;break}throw new u.a(O,"Unsupported query geometry type",{query:t});case 7:if(x(r)){e.next=9;break}throw new u.a(O,"Unsupported layer geometry type",{query:t});case 9:if(!t.outSR){e.next=11;break}return e.abrupt("return",Object(v.a)(t.geometry&&t.geometry.spatialReference,t.outSR));case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(e){if(Object(c.d)(e))return!0;if(Object(c.g)(e)){var t,r=Object(a.a)(e.rings);try{for(r.s();!(t=r.n()).done;){var n=t.value;if(5!==n.length)return!1;if(n[0][0]!==n[1][0]||n[0][0]!==n[4][0]||n[2][0]!==n[3][0]||n[0][1]!==n[3][1]||n[0][1]!==n[4][1]||n[1][1]!==n[2][1])return!1}}catch(i){r.e(i)}finally{r.f()}return!0}return!1}}}]);
//# sourceMappingURL=75.2a85dba4.chunk.js.map